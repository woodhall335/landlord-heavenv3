{{!--
  ============================================================================
  COMPLIANCE CHECKLIST - PRE-SERVICE CHECKS
  Housing Act 1988, Housing Act 2004
  ============================================================================
  Harmonized design system matching Service Instructions and Form templates
--}}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Compliance Checklist - Pre-Service Checks</title>
  <style>
    {{{print_css}}}

    /* ===== @PAGE OVERRIDE - MATCH FORM 3 MARGINS ===== */
    @page {
      size: A4;
      margin: 10mm;
    }

    body {
      padding: 0;
      margin: 0 auto;
    }

    /* ===== KEEP-TOGETHER UTILITIES ===== */
    .keep-together {
      page-break-inside: avoid !important;
      break-inside: avoid !important;
    }

    .section-header,
    .numbered-badge,
    .step-header {
      page-break-after: avoid !important;
      break-after: avoid-page !important;
    }

    /* ===== HARMONIZED DOCUMENT STYLES ===== */

    /* Document Header */
    .doc-header {
      text-align: center;
      margin-bottom: 1.5em;
      padding-bottom: 1em;
      border-bottom: 2px solid #1a1a1a;
    }

    .doc-header h1 {
      font-size: 14pt;
      font-weight: 600;
      margin: 0 0 0.5em 0;
      line-height: 1.3;
      color: #1a1a1a;
    }

    .doc-badge {
      display: inline-block;
      background: #1a1a1a;
      color: white;
      padding: 0.3em 0.8em;
      font-size: 10pt;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    /* Notice Details Box */
    .notice-details {
      border: 2px solid #1a1a1a;
      padding: 1em;
      margin: 1.5em 0;
      background: #fafafa;
    }

    .notice-details-grid {
      display: grid;
      grid-template-columns: 160px 1fr;
      gap: 0.4em 1em;
      font-size: 10pt;
    }

    .notice-details-grid dt {
      font-weight: 600;
      color: #444;
    }

    .notice-details-grid dd {
      margin: 0;
      color: #1a1a1a;
    }

    /* Alert Boxes */
    .alert-box {
      padding: 1em;
      margin: 1.5em 0;
      border-left: 4px solid;
      page-break-inside: avoid;
    }

    .alert-box.critical {
      background: #fef2f2;
      border-color: #dc2626;
    }

    .alert-box.warning {
      background: #fffbeb;
      border-color: #f59e0b;
    }

    .alert-box.success {
      background: #f0fdf4;
      border-color: #22c55e;
    }

    .alert-box.info {
      background: #f8f8f8;
      border-color: #1a1a1a;
    }

    .alert-box h4 {
      font-size: 10pt;
      font-weight: 700;
      margin: 0 0 0.5em 0;
      display: flex;
      align-items: center;
      gap: 0.5em;
    }

    .alert-box p, .alert-box li {
      font-size: 10pt;
      line-height: 1.5;
      margin: 0.3em 0;
    }

    .alert-box ul {
      margin: 0.5em 0;
      padding-left: 1.25em;
    }

    /* Section Headers */
    .section-header {
      display: flex;
      align-items: center;
      gap: 0.75em;
      margin: 2em 0 1em 0;
      padding-bottom: 0.5em;
      border-bottom: 2px solid #1a1a1a;
    }

    .section-header .num {
      background: #1a1a1a;
      color: white;
      width: 1.75em;
      height: 1.75em;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 11pt;
      flex-shrink: 0;
    }

    .section-header h2 {
      font-size: 12pt;
      font-weight: 600;
      margin: 0;
      color: #1a1a1a;
    }

    /* Checklist Items */
    .checklist-item {
      background: #fff;
      border: 1px solid #e5e7eb;
      padding: 1em;
      margin: 1em 0;
      border-radius: 5px;
      page-break-inside: avoid;
    }

    .checklist-item h3 {
      margin: 0 0 0.5em 0;
      font-size: 11pt;
      font-weight: 600;
      color: #1a1a1a;
    }

    .status-pass {
      color: #22c55e;
      font-weight: bold;
    }

    .status-fail {
      color: #dc2626;
      font-weight: bold;
    }

    .status-unknown {
      color: #f59e0b;
      font-weight: bold;
    }

    /* Checklist Box */
    .checklist-box {
      border: 1px solid #1a1a1a;
      margin: 1.5em 0;
      page-break-inside: avoid;
    }

    .checklist-box h3 {
      font-size: 11pt;
      font-weight: 700;
      margin: 0;
      padding: 0.6em 0.8em;
      background: #1a1a1a;
      color: white;
    }

    .checklist-box .content {
      padding: 1em;
      background: #fff;
    }

    .checklist-box ul {
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .checklist-box li {
      font-size: 10pt;
      line-height: 1.6;
      margin: 0.5em 0;
      padding-left: 1.75em;
      position: relative;
    }

    .checklist-box li::before {
      content: "☐";
      position: absolute;
      left: 0;
      color: #1a1a1a;
      font-weight: 700;
    }

    /* Evidence Box */
    .evidence-box {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      padding: 0.75em;
      margin-top: 0.75em;
      border-radius: 3px;
    }

    .evidence-box p {
      font-size: 9pt;
      margin: 0 0 0.3em 0;
      font-weight: 600;
    }

    .evidence-box ul {
      margin: 0;
      padding-left: 1.25em;
      font-size: 9pt;
    }

    .evidence-box li {
      margin: 0.2em 0;
    }

    /* Document Footer */
    .doc-footer {
      margin-top: 2em;
      padding-top: 1em;
      border-top: 2px solid #e5e7eb;
      font-size: 9pt;
      color: #6b7280;
    }

    .doc-footer p {
      margin: 0.3em 0;
    }

    @media print {
      .checklist-item,
      .alert-box,
      .checklist-box {
        page-break-inside: avoid;
      }
    }
  </style>
</head>
<body>

<!-- Document Header -->
<div class="doc-header">
  <h1>Compliance Checklist - Pre-Service Checks</h1>
  <span class="doc-badge">{{#if (eq selected_notice_route "section_21")}}Section 21{{else}}Section 8{{/if}} Notice</span>
</div>

<!-- Intro Alert -->
<div class="alert-box success">
  <h4>✓ Pre-Service Compliance Check</h4>
  <p>Complete this checklist BEFORE serving your notice. Missing any of these requirements could invalidate your notice and waste months of time and court fees.</p>
</div>

<!-- Notice Details -->
<div class="notice-details">
  <dl class="notice-details-grid">
    <dt>Property:</dt>
    <dd>{{property_address_line1}}{{#if property_address_town}}, {{property_address_town}}{{/if}}</dd>
    <dt>Tenancy Start Date:</dt>
    <dd>{{format_date tenancy_start_date "long"}}</dd>
    <dt>Notice Type:</dt>
    <dd>{{#if (eq selected_notice_route "section_21")}}Section 21 (No-Fault){{else}}Section 8 (Fault-Based){{/if}}</dd>
    <dt>Generated:</dt>
    <dd>{{format_date current_date "long"}}</dd>
  </dl>
</div>

<!-- Critical Compliance Requirements -->
<div class="section-header keep-together">
  <span class="num">1</span>
  <h2>Critical Compliance Requirements</h2>
</div>

{{!-- Deposit Protection --}}
<div class="checklist-item">
  <h3>1. Deposit Protection</h3>
  {{#if deposit_protected}}
    <p class="status-pass">✓ COMPLIANT</p>
    {{#if deposit_amount}}<p><strong>Deposit Amount:</strong> £{{deposit_amount}}</p>{{/if}}
    {{#if deposit_scheme_name}}<p><strong>Protection Scheme:</strong> {{deposit_scheme_name}}</p>{{/if}}
    {{#if deposit_protection_date}}<p><strong>Protection Date:</strong> {{format_date deposit_protection_date "long"}}</p>{{/if}}
    {{#if prescribed_info_given}}<p><strong>Prescribed Info Given:</strong> Yes ✓</p>{{else}}<p><strong>Prescribed Info Given:</strong> No ✗</p>{{/if}}

    {{#if (eq selected_notice_route "section_21")}}
      <div class="alert-box success" style="margin-top: 0.75em;">
        <p>✓ Section 21 requirement met - deposit is protected and prescribed information given within 30 days of receiving deposit.</p>
      </div>
    {{/if}}
  {{else}}
    {{#if (eq selected_notice_route "section_21")}}
      <p class="status-fail">✗ NOT COMPLIANT - BLOCKS SECTION 21</p>
      <div class="alert-box critical">
        <h4>⚠️ CRITICAL ISSUE</h4>
        <p>Section 21 notices are INVALID if the deposit is not protected in an approved scheme (DPS, TDS, or MyDeposits). You MUST:</p>
        <ul>
          <li>Protect the deposit in an approved scheme IMMEDIATELY</li>
          <li>Serve prescribed information to the tenant within 30 days of protection</li>
          <li>Wait 6 months before serving Section 21 (or use Section 8 instead)</li>
        </ul>
      </div>
    {{else}}
      <p class="status-pass">✓ Not a blocker for Section 8</p>
      <p><strong>Note:</strong> Deposit not protected, but this doesn't prevent Section 8 proceedings. However, you should still protect it to avoid fines (up to 3x deposit amount).</p>
    {{/if}}
  {{/if}}

  <div class="evidence-box">
    <p>Evidence Required:</p>
    <ul>
      <li>Certificate of deposit protection from scheme</li>
      <li>Copy of prescribed information served to tenant</li>
      <li>Proof of service (email or letter with proof of posting)</li>
    </ul>
  </div>
</div>

{{!-- Gas Safety Certificate --}}
<div class="checklist-item">
  <h3>2. Gas Safety Certificate</h3>
  {{#if gas_cert_provided}}
    <p class="status-pass">✓ COMPLIANT</p>
    <p><strong>Gas Certificate Provided:</strong> Yes</p>
    {{#if gas_cert_expiry}}<p><strong>Expires:</strong> {{format_date gas_cert_expiry "long"}}</p>{{/if}}

    {{#if (eq selected_notice_route "section_21")}}
      <div class="alert-box success" style="margin-top: 0.75em;">
        <p>✓ Section 21 requirement met - gas safety certificate provided within last 12 months.</p>
      </div>
    {{/if}}
  {{else}}
    {{#if (eq selected_notice_route "section_21")}}
      <p class="status-fail">✗ NOT COMPLIANT - BLOCKS SECTION 21</p>
      <div class="alert-box critical">
        <h4>⚠️ CRITICAL ISSUE</h4>
        <p>Section 21 notices are INVALID if you haven't provided a current gas safety certificate. You MUST:</p>
        <ul>
          <li>Arrange a Gas Safe registered engineer inspection</li>
          <li>Obtain a valid gas safety certificate (valid for 12 months)</li>
          <li>Serve a copy to the tenant</li>
          <li>Keep evidence of service</li>
        </ul>
      </div>
    {{else}}
      <p class="status-unknown">⚠️ Should be compliant</p>
      <p><strong>Note:</strong> Gas safety certificates are legally required regardless of eviction route. Ensure you have one and have served it to the tenant.</p>
    {{/if}}
  {{/if}}

  <div class="evidence-box">
    <p>Evidence Required:</p>
    <ul>
      <li>Copy of gas safety certificate (issued within last 12 months)</li>
      <li>Proof you served it to the tenant (email or letter with proof of posting)</li>
    </ul>
  </div>
</div>

{{!-- Energy Performance Certificate (EPC) --}}
<div class="checklist-item">
  <h3>3. Energy Performance Certificate (EPC)</h3>
  {{#if epc_provided}}
    <p class="status-pass">✓ PROVIDED</p>
    {{#if epc_rating}}<p><strong>EPC Rating:</strong> {{epc_rating}}</p>{{/if}}

    {{#if (contains (array "F" "G") epc_rating)}}
      <div class="alert-box critical" style="margin-top: 0.75em;">
        <h4>⚠️ WARNING</h4>
        <p>Your EPC rating ({{epc_rating}}) is below the minimum energy efficiency standard (E). Letting properties with F or G ratings is illegal unless you have an exemption. This could block your possession claim.</p>
      </div>
    {{/if}}

    {{#if (eq selected_notice_route "section_21")}}
      <div class="alert-box success" style="margin-top: 0.75em;">
        <p>✓ Section 21 requirement met - valid EPC provided.</p>
      </div>
    {{/if}}
  {{else}}
    {{#if (eq selected_notice_route "section_21")}}
      <p class="status-fail">✗ NOT COMPLIANT - BLOCKS SECTION 21</p>
      <div class="alert-box critical">
        <h4>⚠️ CRITICAL ISSUE</h4>
        <p>Section 21 notices are INVALID if you haven't provided a valid EPC. You MUST:</p>
        <ul>
          <li>Arrange an EPC assessment (valid for 10 years)</li>
          <li>Ensure rating is at least E (F and G are illegal)</li>
          <li>Serve a copy to the tenant</li>
        </ul>
      </div>
    {{else}}
      <p class="status-unknown">⚠️ Should have been provided</p>
      <p><strong>Note:</strong> EPCs are legally required before any new tenancy. Ensure you have one.</p>
    {{/if}}
  {{/if}}

  <div class="evidence-box">
    <p>Evidence Required:</p>
    <ul>
      <li>Copy of valid EPC (issued within last 10 years)</li>
      <li>Proof you served it to the tenant</li>
    </ul>
  </div>
</div>

{{!-- How to Rent Guide --}}
<div class="checklist-item">
  <h3>4. "How to Rent" Guide</h3>
  {{#if how_to_rent_given}}
    <p class="status-pass">✓ PROVIDED</p>
    <p><strong>How to Rent Guide Given:</strong> Yes</p>

    {{#if (eq selected_notice_route "section_21")}}
      <div class="alert-box success" style="margin-top: 0.75em;">
        <p>✓ Section 21 requirement met.</p>
      </div>
    {{/if}}
  {{else}}
    {{#if (eq selected_notice_route "section_21")}}
      <p class="status-fail">✗ NOT PROVIDED - BLOCKS SECTION 21</p>
      <div class="alert-box critical">
        <h4>⚠️ CRITICAL ISSUE</h4>
        <p>Section 21 notices are INVALID if you haven't provided the government's "How to Rent" guide. You MUST:</p>
        <ul>
          <li>Download the latest version from gov.uk</li>
          <li>Serve it to the tenant (email or hand delivery)</li>
          <li>Keep proof of service</li>
        </ul>
      </div>
    {{else}}
      <p class="status-unknown">⚠️ Should have been provided</p>
      <p><strong>Note:</strong> The "How to Rent" guide should have been given at the start of the tenancy. Download from: gov.uk</p>
    {{/if}}
  {{/if}}

  <div class="evidence-box">
    <p>Evidence Required:</p>
    <ul>
      <li>Copy of the How to Rent guide (version given to tenant)</li>
      <li>Proof of service (email or letter with proof of posting)</li>
    </ul>
  </div>
</div>

{{!-- HMO License --}}
{{#if hmo_license_required}}
<div class="checklist-item">
  <h3>5. HMO License (Required for This Property)</h3>
  {{#if hmo_license_valid}}
    <p class="status-pass">✓ COMPLIANT</p>
    <p><strong>HMO License:</strong> Valid</p>

    <div class="alert-box success" style="margin-top: 0.75em;">
      <p>✓ HMO requirements met.</p>
    </div>
  {{else}}
    <p class="status-fail">✗ NOT LICENSED - MAY BLOCK PROCEEDINGS</p>
    <div class="alert-box critical">
      <h4>⚠️ CRITICAL ISSUE</h4>
      <p>This property requires an HMO license. Operating without one is a criminal offense and may prevent you from serving valid notices. You MUST:</p>
      <ul>
        <li>Apply for an HMO license from your local council immediately</li>
        <li>Be aware that courts may refuse possession claims for unlicensed HMOs</li>
        <li>Expect fines of up to £30,000 for operating without a license</li>
      </ul>
    </div>
  {{/if}}

  <div class="evidence-box">
    <p>Evidence Required:</p>
    <ul>
      <li>Copy of valid HMO license from local authority</li>
      <li>Proof all HMO conditions are being met</li>
    </ul>
  </div>
</div>
{{/if}}

<!-- Pre-Service Checklist Summary -->
<div class="section-header keep-together">
  <span class="num">2</span>
  <h2>Pre-Service Checklist Summary</h2>
</div>

<div class="checklist-box">
  <h3>Before Serving Your {{#if (eq selected_notice_route "section_21")}}Section 21{{else}}Section 8{{/if}} Notice, Confirm:</h3>
  <div class="content">
    <ul>
      <li>Deposit is protected (and prescribed info served) {{#if (eq selected_notice_route "section_21")}}<strong>(REQUIRED for Section 21)</strong>{{/if}}</li>
      <li>Gas safety certificate is current and served {{#if (eq selected_notice_route "section_21")}}<strong>(REQUIRED for Section 21)</strong>{{/if}}</li>
      <li>EPC is valid (rating E or above) and served {{#if (eq selected_notice_route "section_21")}}<strong>(REQUIRED for Section 21)</strong>{{/if}}</li>
      <li>"How to Rent" guide was served {{#if (eq selected_notice_route "section_21")}}<strong>(REQUIRED for Section 21)</strong>{{/if}}</li>
      {{#if hmo_license_required}}<li>HMO license is valid</li>{{/if}}
      <li>All evidence of service is saved and accessible</li>
      <li>Tenancy agreement is signed and valid</li>
      <li>Notice is filled out correctly with accurate dates</li>
    </ul>
  </div>
</div>

<div class="alert-box critical">
  <h4>⚠️ FINAL CHECK</h4>
  <p>If ANY of the above requirements are not met for Section 21, DO NOT serve the notice. It will be invalid and you'll waste time and court fees. Either fix the compliance issues first, or use Section 8 instead (which has fewer compliance requirements).</p>
</div>

<!-- Footer -->
<div class="doc-footer">
  <p><strong>Legal Basis:</strong> Housing Act 1988, Housing Act 2004 (HMOs), Energy Efficiency Regulations 2015, Tenancy Deposit Protection Regulations 2007</p>
  <p><strong>Generated:</strong> {{format_date current_date "long"}}</p>
  <p><strong>Landlord Heaven Notice Only Pack</strong> | {{#if jurisdiction_display}}{{jurisdiction_display}}{{else}}England{{/if}}</p>
</div>

</body>
</html>
