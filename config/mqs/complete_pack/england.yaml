# config/mqs/complete_pack/england.yaml
#
# ENGLAND-ONLY Eviction Pack (Section 8 + Section 21)
# Split from england-wales.yaml as part of canonical jurisdiction implementation
# Version 2.1.0 - England jurisdiction
# 2.1.0: Added court-ready fields (notice dates, arrears amounts, deposit details)

__meta:
  version: "2.2.0"
  effective_from: "2025-12-16"
  last_updated: "2025-12-26"
  legal_review_date: "2025-12-26"
  jurisdiction: "england"
  product: "complete_pack"
  changelog:
    - version: "2.2.0"
      date: "2025-12-26"
      changes:
        - "Added notice_service_method question (required for N5B field 10a)"
        - "Added court_name question (required for court forms N5, N5B, N119)"
        - "Added arrears_schedule question for Ground 8 (canonical arrears_items)"

id: complete_pack_england_v2
product: complete_pack
jurisdiction: england
version: "2.2.0"

questions:
  # 1. Eviction route selection (England: Section 8 or Section 21)
  - id: eviction_route
    section: Eviction Type
    question: "Which eviction route are you using?"
    inputType: select
    options:
      - value: "section_8"
        label: "Section 8 (fault-based)"
      - value: "section_21"
        label: "Section 21 (no-fault)"
    helperText: "Section 8 requires grounds. Section 21 (England only) does not require a reason."
    validation:
      required: true
    maps_to:
      - selected_notice_route

  # ============================================================
  # NOTICE SERVICE DETAILS (COMMON FOR BOTH ROUTES)
  # ============================================================

  - id: notice_service_details
    section: Notice Service
    question: "When was the notice served?"
    inputType: group
    helperText: "The date you served the eviction notice on the tenant(s)."
    fields:
      - id: notice_served_date
        label: "Date notice was served"
        inputType: date
        validation:
          required: true
        width: half
      - id: notice_expiry_date
        label: "Notice expiry date (if known)"
        inputType: date
        helperText: "Leave blank to auto-calculate based on notice type"
        width: half
    maps_to:
      - notice_served_date
      - notice_expiry_date

  # ============================================================
  # NOTICE SERVICE METHOD (Required for N5B field 10a)
  # ============================================================
  - id: notice_service_method
    section: Notice Service
    question: "How was the notice served on the tenant?"
    inputType: select
    helperText: "Required for court forms. Select how the notice was delivered to the tenant."
    options:
      - value: "first_class_post"
        label: "First class post"
      - value: "recorded_delivery"
        label: "Recorded delivery / signed for"
      - value: "hand_delivered"
        label: "Hand delivered to tenant"
      - value: "left_at_property"
        label: "Left at the property"
      - value: "email"
        label: "Email (if permitted by tenancy)"
      - value: "other"
        label: "Other method"
    validation:
      required: true
    maps_to:
      - notice_service_method

  # ============================================================
  # RENT DETAILS (COMMON FOR BOTH ROUTES)
  # ============================================================

  - id: rent_details
    section: Rent
    question: "Rent details"
    inputType: group
    helperText: "Current rent amount and payment frequency"
    fields:
      - id: rent_amount
        label: "Monthly rent amount (£)"
        inputType: number
        validation:
          required: true
        width: half
      - id: rent_frequency
        label: "Payment frequency"
        inputType: select
        options:
          - "weekly"
          - "fortnightly"
          - "monthly"
        validation:
          required: true
        width: half
    maps_to:
      - rent_amount
      - rent_frequency

  # ============================================================
  # SECTION 8 QUESTIONS
  # ============================================================

  - id: section8_grounds
    section: Section 8 Grounds
    question: "Which grounds for possession are you relying on?"
    inputType: multiselect
    routes:
      - section_8
    dependsOn:
      questionId: eviction_route
      value: "section_8"
    options:
      - "Ground 1 - Landlord occupation"
      - "Ground 2 - Mortgage lender requiring possession"
      - "Ground 7 - Tenant death, no succession"
      - "Ground 7A - Conviction for serious offense"
      - "Ground 8 - 8+ weeks rent arrears"
      - "Ground 10 - Rent arrears"
      - "Ground 11 - Persistent delay in paying rent"
      - "Ground 12 - Breach of tenancy agreement"
      - "Ground 13 - Waste or neglect"
      - "Ground 14 - Nuisance or annoyance"
      - "Ground 14A - Domestic violence"
      - "Ground 15 - Damaged furniture"
      - "Ground 17 - False statement"
    helperText: "Select all grounds that apply. Grounds 8, 10-15, 17 are mandatory; Grounds 1, 2, 7, 7A are discretionary."
    validation:
      required: true
    maps_to:
      - section8_grounds

  - id: section8_details
    section: Section 8 Evidence
    question: "Provide details for your selected grounds"
    inputType: textarea
    routes:
      - section_8
    dependsOn:
      questionId: eviction_route
      value: "section_8"
    helperText: "Describe the facts supporting each ground. Be specific with dates and evidence."
    placeholder: "E.g., Ground 8: Rent arrears currently stand at £3,200, representing 10 weeks of unpaid rent. Last payment received 15/10/2025."
    validation:
      required: true
    maps_to:
      - section8_details

  - id: rent_arrears_amount
    section: Arrears Details
    question: "Total rent arrears amount"
    inputType: group
    routes:
      - section_8
    dependsOn:
      questionId: eviction_route
      value: "section_8"
    helperText: "Enter the total arrears for Forms N5 and N119. Required for arrears grounds (8, 10, 11)."
    fields:
      - id: total_arrears
        label: "Total arrears outstanding (£)"
        inputType: number
        validation:
          required: true
        width: half
      - id: arrears_at_notice_date
        label: "Arrears at date of notice (£)"
        inputType: number
        helperText: "Amount outstanding when notice was served"
        width: half
    maps_to:
      - total_arrears
      - arrears_at_notice_date

  # ============================================================
  # ARREARS SCHEDULE (Required for Ground 8 court proceedings)
  # ============================================================
  # Ground 8 requires authoritative period-by-period arrears data.
  # The court needs to see a detailed schedule of rent due vs paid.
  # This is enforced as a BLOCKER in complete pack validation.
  - id: arrears_schedule
    section: Arrears Details
    question: "Arrears schedule"
    inputType: arrears_schedule
    routes:
      - section_8
    dependsOn:
      questionId: section8_grounds
      contains: "Ground 8"
    helperText: "Required for Ground 8. Enter the rent due and amount paid for each period. Courts require a detailed breakdown to verify the 2-month arrears threshold is met."
    validation:
      required: true
      min_items: 1
    config:
      # UI should use tenancy_start_date and rent_frequency to generate periods
      period_source: "tenancy_start_date"
      frequency_source: "rent_frequency"
      amount_source: "rent_amount"
      # Show columns for period, rent due, rent paid, amount owed
      columns:
        - id: period_start
          label: "Period start"
          type: date
        - id: period_end
          label: "Period end"
          type: date
        - id: rent_due
          label: "Rent due (£)"
          type: number
        - id: rent_paid
          label: "Rent paid (£)"
          type: number
        - id: amount_owed
          label: "Amount owed (£)"
          type: calculated
          formula: "rent_due - rent_paid"
    maps_to:
      - arrears_items

  # ============================================================
  # SECTION 21 QUESTIONS (ENGLAND ONLY)
  # ============================================================

  - id: section21_compliance
    section: Section 21 Compliance
    question: "Section 21 compliance checks"
    inputType: group
    routes:
      - section_21
    dependsOn:
      questionId: eviction_route
      value: "section_21"
    helperText: "All must be YES to use Section 21."
    fields:
      - id: deposit_protected
        label: "Deposit protected within 30 days?"
        inputType: yes_no
        validation:
          required: true
        width: half
      - id: prescribed_info_served
        label: "Prescribed information served?"
        inputType: yes_no
        validation:
          required: true
        width: half
      - id: how_to_rent_served
        label: "'How to Rent' guide served?"
        inputType: yes_no
        validation:
          required: true
        width: half
      - id: epc_gas_cert_served
        label: "EPC & Gas Safety cert served?"
        inputType: yes_no
        validation:
          required: true
        width: half
      - id: no_retaliatory_notice
        label: "No retaliatory eviction (6 months after complaint)?"
        inputType: yes_no
        validation:
          required: true
        width: half
    maps_to:
      - section21.deposit_protected
      - section21.prescribed_info_served
      - section21.how_to_rent_served
      - section21.epc_gas_cert_served
      - section21.no_retaliatory_notice

  - id: deposit_details
    section: Deposit Information
    question: "Deposit protection details"
    inputType: group
    routes:
      - section_21
    dependsOn:
      questionId: eviction_route
      value: "section_21"
    helperText: "Required for Form N5B accelerated possession claim."
    fields:
      - id: deposit_amount
        label: "Deposit amount (£)"
        inputType: number
        validation:
          required: true
        width: half
      - id: deposit_protection_date
        label: "Date deposit was protected"
        inputType: date
        validation:
          required: true
        width: half
      - id: deposit_scheme_name
        label: "Deposit protection scheme"
        inputType: select
        options:
          - "DPS"
          - "MyDeposits"
          - "TDS"
        validation:
          required: true
        width: half
      - id: deposit_reference
        label: "Deposit reference number"
        inputType: text
        helperText: "Optional - reference from protection scheme"
        width: half
    maps_to:
      - deposit_amount
      - deposit_protection_date
      - deposit_scheme_name
      - deposit_reference

  # ============================================================
  # COMMON EVICTION PACK QUESTIONS
  # ============================================================

  - id: property_address
    section: Property
    question: "Property address"
    inputType: group
    helperText: "The rental property being repossessed"
    fields:
      - id: property_address_line1
        label: "Building and street"
        inputType: text
        validation:
          required: true
        width: full
      - id: property_address_town
        label: "Town/City"
        inputType: text
        validation:
          required: true
        width: half
      - id: property_address_postcode
        label: "Postcode"
        inputType: text
        validation:
          required: true
        width: half
    maps_to:
      - property_address_line1
      - property_address_town
      - property_address_postcode

  - id: tenancy_start_date
    section: Tenancy
    question: "Tenancy start date"
    inputType: date
    helperText: "When the current tenancy began"
    validation:
      required: true
    maps_to:
      - tenancy_start_date

  - id: tenant_details
    section: Tenant
    question: "Lead tenant details"
    inputType: group
    fields:
      - id: tenant_full_name
        label: "Full name"
        inputType: text
        validation:
          required: true
        width: full
      - id: tenant_email
        label: "Email"
        inputType: email
        width: half
      - id: tenant_phone
        label: "Phone"
        inputType: tel
        width: half
    maps_to:
      - tenant_full_name
      - tenant_email
      - tenant_phone

  - id: landlord_details
    section: Landlord
    question: "Landlord details"
    inputType: group
    fields:
      - id: landlord_full_name
        label: "Full name"
        inputType: text
        validation:
          required: true
        width: full
      - id: landlord_address_line1
        label: "Address line 1"
        inputType: text
        validation:
          required: true
        width: full
      - id: landlord_address_town
        label: "Town/City"
        inputType: text
        validation:
          required: true
        width: half
      - id: landlord_address_postcode
        label: "Postcode"
        inputType: text
        validation:
          required: true
        width: half
    maps_to:
      - landlord_full_name
      - landlord_address_line1
      - landlord_address_town
      - landlord_address_postcode

  # ============================================================
  # COURT DETAILS (Required for N5, N5B, N119 court forms)
  # ============================================================
  - id: court_name
    section: Court
    question: "Which county court will handle your claim?"
    inputType: text
    helperText: "Required for court forms. Use HMCTS Court Finder (https://www.gov.uk/find-court-tribunal) to find your local County Court based on the property address."
    placeholder: "e.g., Central London County Court"
    validation:
      required: true
    maps_to:
      - court_name

  # ============================================================
  # EVIDENCE UPLOADS - CATEGORIZED (Smart Review v1)
  # ============================================================
  # These categorized upload fields enable Smart Review AI extraction
  # and fact comparison. The legacy evidence_uploads field is retained
  # for backward compatibility - old uploads map to evidence.other_uploads.

  - id: evidence_section_header
    section: Evidence
    question: "Supporting Documents"
    inputType: info
    helperText: "Upload documents to support your case. Smart Review will verify details against your answers."

  - id: evidence_tenancy_agreement
    section: Evidence
    question: "Tenancy Agreement"
    inputType: upload
    helperText: "Upload the signed tenancy agreement or AST. Used to verify tenant/landlord names, property address, rent amount, and tenancy start date."
    validation:
      required: false
    maps_to:
      - evidence.tenancy_agreement_uploads

  - id: evidence_bank_statements
    section: Evidence
    question: "Bank Statements / Rent Records"
    inputType: upload
    helperText: "Upload bank statements or rent payment records showing rent payments received."
    validation:
      required: false
    routes:
      - section_8
    dependsOn:
      questionId: eviction_route
      value: "section_8"
    maps_to:
      - evidence.bank_statements_uploads

  - id: evidence_deposit_protection
    section: Evidence
    question: "Deposit Protection Certificate"
    inputType: upload
    # P0-D: Canonical evidence category for N5B checkbox truthfulness
    evidenceCategory: deposit_protection_certificate
    helperText: "Upload the deposit protection certificate from DPS, MyDeposits, or TDS."
    validation:
      required: false
    routes:
      - section_21
    dependsOn:
      questionId: eviction_route
      value: "section_21"
    maps_to:
      - evidence.deposit_protection_uploads

  - id: evidence_prescribed_info
    section: Evidence
    question: "Prescribed Information Proof"
    inputType: upload
    helperText: "Upload proof that prescribed deposit information was served to the tenant within 30 days."
    validation:
      required: false
    routes:
      - section_21
    dependsOn:
      questionId: eviction_route
      value: "section_21"
    maps_to:
      - evidence.prescribed_info_uploads

  - id: evidence_how_to_rent
    section: Evidence
    question: "How to Rent Guide Proof"
    inputType: upload
    helperText: "Upload proof the How to Rent guide was provided (email confirmation, signed acknowledgment)."
    validation:
      required: false
    routes:
      - section_21
    dependsOn:
      questionId: eviction_route
      value: "section_21"
    maps_to:
      - evidence.how_to_rent_uploads

  - id: evidence_epc
    section: Evidence
    question: "Energy Performance Certificate (EPC)"
    inputType: upload
    # P0-D: Canonical evidence category for N5B checkbox truthfulness
    evidenceCategory: epc
    helperText: "Upload the current Energy Performance Certificate for the property."
    validation:
      required: false
    routes:
      - section_21
    dependsOn:
      questionId: eviction_route
      value: "section_21"
    maps_to:
      - evidence.epc_uploads

  - id: evidence_gas_safety
    section: Evidence
    question: "Gas Safety Certificate"
    inputType: upload
    # P0-D: Canonical evidence category for N5B checkbox truthfulness
    evidenceCategory: gas_safety_certificate
    helperText: "Upload the current Gas Safety Certificate (CP12) for the property."
    validation:
      required: false
    routes:
      - section_21
    dependsOn:
      questionId: eviction_route
      value: "section_21"
    maps_to:
      - evidence.gas_safety_uploads

  - id: evidence_notice_service
    section: Evidence
    question: "Notice Service Proof"
    inputType: upload
    helperText: "Upload proof of notice service (photo of notice, proof of postage, email confirmation)."
    validation:
      required: false
    maps_to:
      - evidence.notice_service_uploads

  - id: evidence_correspondence
    section: Evidence
    question: "Tenant Correspondence"
    inputType: upload
    helperText: "Upload relevant correspondence with the tenant(s)."
    validation:
      required: false
    maps_to:
      - evidence.correspondence_uploads

  - id: evidence_other
    section: Evidence
    question: "Other Supporting Documents"
    inputType: upload
    helperText: "Upload any other supporting documents not covered above."
    validation:
      required: false
    maps_to:
      - evidence.other_uploads

  # Legacy field - retained for backward compatibility
  # Existing evidence_uploads values map to evidence.other_uploads
  - id: evidence_uploads
    section: Evidence
    question: "Upload supporting documents"
    inputType: upload
    helperText: "Tenancy agreement, notice served, deposit certificate, rent statements, etc."
    validation:
      required: false
    deprecated: true
    deprecated_message: "Use categorized upload fields above for Smart Review support"
    maps_to:
      - evidence.pack_documents_uploaded
      - evidence.other_uploads
