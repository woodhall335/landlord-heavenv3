# ============================================================================
# ENGLAND NOTICE ONLY - Master Question Set
# Housing Act 1988 - WITH ALL CLAUDE CODE FIXES APPLIED
# ============================================================================

jurisdiction: england
legal_framework: "Housing Act 1988"
tenancy_type: "Assured Shorthold Tenancy (AST)"

questions:
  # ========================================
  # BASIC INFORMATION
  # ========================================

  - id: landlord_details
    section: Landlord Details
    question: "Your details"
    inputType: group
    helperText: "We need your full details to complete the notice correctly."
    fields:
      - id: landlord_full_name
        label: "Full name"
        inputType: text
        validation:
          required: true
        width: full
      - id: landlord_address_line1
        label: "Address line 1"
        inputType: text
        validation:
          required: true
        width: full
      - id: landlord_address_line2
        label: "Address line 2 (optional)"
        inputType: text
        width: full
      - id: landlord_city
        label: "Town or city"
        inputType: text
        validation:
          required: true
        width: half
      - id: landlord_postcode
        label: "Postcode"
        inputType: text
        validation:
          required: true
        width: half
      # Telephone: Optional per Form 6A - NOT legally mandatory but renders if provided
      - id: landlord_phone
        label: "Telephone (optional)"
        inputType: tel
        placeholder: "e.g. 020 1234 5678"
        width: half
        helperText: "Optional contact number for the notice form"
    maps_to:
      - landlord_full_name
      - landlord_address_line1
      - landlord_address_line2
      - landlord_city
      - landlord_postcode
      - landlord_phone

  # TASK B: Route selection EARLY (before route-dependent questions)
  - id: selected_notice_route
    section: Notice Type
    question: "Which type of notice do you want to serve?"
    inputType: radio
    validation:
      required: true
    helperText: "Select your notice type first. The system will then ask relevant questions for that type."
    options:
      - value: "section_21"
        label: "Section 21 - No-fault eviction"
        helperText: "2 months notice, strict compliance required"
      - value: "section_8"
        label: "Section 8 - Grounds-based eviction"
        helperText: "14+ days notice, specific grounds required"
    width: full
    maps_to:
      - selected_notice_route

  - id: tenant_full_name
    section: Tenant Details
    question: "Tenant's full name"
    inputType: text
    validation:
      required: true
    maps_to:
      - tenant_full_name

  - id: property_details
    section: Property Details
    question: "Property address"
    inputType: group
    helperText: "The property this notice relates to"
    fields:
      - id: property_address_line1
        label: "Address line 1"
        inputType: text
        validation:
          required: true
        width: full
      - id: property_address_line2
        label: "Address line 2 (optional)"
        inputType: text
        width: full
      - id: property_city
        label: "Town or city"
        inputType: text
        validation:
          required: true
        width: half
      - id: property_postcode
        label: "Postcode"
        inputType: text
        validation:
          required: true
        width: half
    maps_to:
      - property_address_line1
      - property_address_line2
      - property_city
      - property_postcode

  - id: tenancy_start_date
    section: Tenancy Details
    question: "When did the tenancy start?"
    inputType: date
    validation:
      required: true
    maps_to:
      - tenancy_start_date

  - id: is_fixed_term
    section: Tenancy Details
    question: "Is this a fixed term tenancy?"
    inputType: yes_no
    validation:
      required: true
    helperText: "Fixed term has a specific end date (e.g., 12 months)"
    maps_to:
      - is_fixed_term

  - id: fixed_term_end_date
    section: Tenancy Details
    question: "Fixed term end date"
    inputType: date
    dependsOn:
      questionId: is_fixed_term
      value: true
    validation:
      required: true
    maps_to:
      - fixed_term_end_date

  - id: rent_terms
    section: Rent Details
    question: "Rent details"
    inputType: group
    helperText: "We need this for the notice and arrears calculations"
    fields:
      - id: rent_amount
        label: "Rent amount"
        inputType: currency
        validation:
          required: true
          min: 0
        width: half
      - id: rent_frequency
        label: "Rent frequency"
        inputType: select
        options:
          - "weekly"
          - "monthly"
          - "quarterly"
          - "yearly"
        validation:
          required: true
        width: half
      - id: payment_date
        label: "Day of month rent is due"
        inputType: number
        helperText: "E.g., 1 for 1st, 15 for 15th"
        validation:
          required: true
          min: 1
          max: 31
        width: half
    maps_to:
      - rent_amount
      - rent_frequency
      - payment_date

  # ========================================
  # DEPOSIT & COMPLIANCE (TASK A: COLLECT FOR BOTH ROUTES)
  # ========================================

  - id: section21_intro
    section: Deposit & Compliance
    question: "Compliance Requirements"
    inputType: info
    content: |
      **Compliance requirements for eviction notices:**

      We'll check your compliance status. This is critical for Section 21 validity,
      and helps establish your position for Section 8 cases too.

  - id: deposit_taken
    section: Deposit & Compliance
    question: "Did you take a deposit from the tenant?"
    inputType: yes_no
    validation:
      required: true
    helperText: "Deposit protection is a legal requirement for Section 21 notices. For Section 8, it's not required but good practice."
    maps_to:
      - deposit_taken

  - id: deposit_amount
    section: Deposit & Compliance
    question: "Deposit amount"
    inputType: currency
    dependsOn:
      questionId: deposit_taken
      value: true
    validation:
      required: true
      min: 0
    helperText: "The total deposit amount collected from the tenant. Required for compliance checking."
    maps_to:
      - deposit_amount

  # ========================================
  # DEPOSIT CAP - INLINE WARNING ONLY (NOT A WIZARD STEP)
  # ========================================
  # Deposit cap (Tenant Fees Act 2019) is enforced as an inline warning
  # on the deposit_amount step, not as a separate confirmation step.
  # The warning is computed and displayed by StructuredWizard.tsx.
  # evaluate-notice-compliance.ts computes cap values for messaging.
  # ========================================

  - id: has_gas_appliances
    section: Deposit & Compliance
    question: "Does the property have gas appliances?"
    inputType: yes_no
    validation:
      required: true
    helperText: "Gas boiler, gas hob, gas fire, etc. Gas safety certification is required for Section 21 but good practice for all notices."
    maps_to:
      - has_gas_appliances

  # ========================================
  # CONDITIONAL COMPLIANCE CHECKS
  # ========================================

  - id: deposit_protected_scheme
    section: Deposit & Compliance
    question: "Is the deposit protected in an approved scheme?"
    inputType: yes_no
    dependsOn:
      questionId: deposit_taken
      value: true
    validation:
      required: true
    helperText: |
      Deposit protection is a legal requirement for Section 21 notices. For Section 8, it's not required but may be relevant for your records.

      Approved schemes:
      • Deposit Protection Service (DPS)
      • MyDeposits
      • Tenancy Deposit Scheme (TDS)
    maps_to:
      - deposit_protected

  # NEW: Collect actual deposit scheme name when deposit is protected
  - id: deposit_scheme_name
    section: Deposit & Compliance
    question: "Which deposit protection scheme was used?"
    inputType: select
    dependsOn:
      questionId: deposit_protected_scheme
      value: true
    validation:
      required: true
    helperText: "Select the government-approved scheme where the deposit is protected."
    options:
      - value: "DPS"
        label: "Deposit Protection Service (DPS)"
      - value: "MyDeposits"
        label: "MyDeposits"
      - value: "TDS"
        label: "Tenancy Deposit Scheme (TDS)"
    maps_to:
      - deposit_scheme

  # UPDATED: prescribed_info_given now depends on BOTH deposit_taken AND deposit_protected_scheme
  # Prescribed information can only be given if the deposit was first protected in an approved scheme
  - id: prescribed_info_given
    section: Deposit & Compliance
    question: "Was prescribed information given within 30 days?"
    inputType: yes_no
    dependsOn:
      allOf:
        - questionId: deposit_taken
          value: true
        - questionId: deposit_protected_scheme
          value: true
    validation:
      required: true
    helperText: "Prescribed information about the deposit protection scheme. This is a legal requirement for Section 21 notices, but not required for Section 8."
    maps_to:
      - prescribed_info_given

  - id: gas_safety_certificate
    section: Deposit & Compliance
    question: "Was a valid gas safety certificate provided?"
    inputType: yes_no
    dependsOn:
      questionId: has_gas_appliances
      value: true
    validation:
      required: true
    helperText: "Must be provided and renewed annually. This is a legal requirement for Section 21 notices."
    maps_to:
      - gas_certificate_provided

  # ========================================
  # EPC (CLAUDE CODE FIX #6 - EXPLICIT PRODUCT CONSTRAINT)
  # ========================================

  - id: epc_provided
    section: Deposit & Compliance
    question: "Was an EPC provided before tenancy started?"
    inputType: yes_no
    routes:
      - section_21
    validation:
      required: true
    helperText: |
      Energy Performance Certificate (EPC) must be provided to tenants.

      This is a legal requirement for Section 21 notices.

      **Legal exemptions exist but are not supported:**
      • Listed buildings
      • Buildings to be demolished
      • Temporary structures
      • Certain holiday accommodations

      **If you believe your property is EPC exempt:**
      Consult a solicitor for manual preparation.
    maps_to:
      - epc_provided

  # ========================================
  # HOW TO RENT (CLAUDE CODE FIX #5 - OPTIONAL, API-ENFORCED)
  # ========================================

  - id: how_to_rent_info
    section: Deposit & Compliance
    question: "How to Rent Guide"
    inputType: info
    routes:
      - section_21
    content: |
      **How to Rent guide requirement:**

      System automatically determines if required based on
      tenancy start date.

      • Before Oct 1, 2015: Not required
      • On or after Oct 1, 2015: Required (for Section 21)

      **System calculates requirement automatically.**

  - id: how_to_rent_provided
    section: Deposit & Compliance
    question: "Was the 'How to Rent' guide provided?"
    inputType: yes_no
    routes:
      - section_21
    validation:
      required: false  # Not required in UI, enforced in API for Section 21
    helperText: |
      Answer based on whether you provided the guide.
      **System checks if it was required for your tenancy start date.**
    maps_to:
      - how_to_rent_provided

  - id: property_licensing
    section: Deposit & Compliance
    question: "Property licensing status"
    inputType: select
    routes:
      - section_21
    validation:
      required: true
    options:
      - "not_required"
      - "licensed"
      - "unlicensed"
    helperText: "HMO or selective licensing status. If required and unlicensed, Section 21 notices cannot be served."
    maps_to:
      - property_licensing_status

  - id: recent_repair_complaints_s21
    section: Deposit & Compliance
    question: "Has tenant made repair complaints in last 6 months?"
    inputType: yes_no
    routes:
      - section_21
    validation:
      required: true
    helperText: "Retaliatory eviction rules may apply to Section 21 notices if tenant has made recent repair complaints."
    maps_to:
      - recent_repair_complaints

  # ========================================
  # SECTION 8 ARREARS DETAILS (CRITICAL FOR GROUND 8 VALIDATION)
  # ========================================

  - id: has_rent_arrears
    section: Section 8 Grounds
    question: "Are there currently any rent arrears?"
    inputType: yes_no
    dependsOn:
      questionId: selected_notice_route
      value: section_8
    validation:
      required: true
    helperText: "Select 'Yes' if the tenant owes any unpaid rent. This is required to validate Ground 8, 10, or 11."
    maps_to:
      - has_rent_arrears

  - id: arrears_details
    section: Section 8 Grounds
    question: "Arrears details"
    inputType: group
    dependsOn:
      questionId: has_rent_arrears
      value: true
    validation:
      required: true
    helperText: "We need these details to validate Ground 8 (mandatory) threshold and calculate notice periods."
    fields:
      - id: arrears_total
        label: "Total arrears amount (£)"
        inputType: currency
        validation:
          required: true
          min: 0
        width: half
        helperText: "Total amount of rent currently owed"
      - id: arrears_from_date
        label: "Arrears started from (optional)"
        inputType: date
        width: half
        helperText: "When did arrears first start accruing?"
    maps_to:
      - arrears_total
      - arrears_from_date

  # ========================================
  # SECTION 8 GROUNDS (must come BEFORE notice_service for proper flow)
  # ========================================

  # Ground selection fetches all available grounds from API (config/jurisdictions/uk/england/grounds/)
  # No static options needed - UI loads complete ground list with descriptions
  - id: section8_grounds_selection
    section: Section 8 Grounds
    question: "Select grounds for eviction"
    inputType: multi_select
    dependsOn:
      questionId: selected_notice_route
      value: section_8
    validation:
      required: true
    helperText: "Select all grounds that apply to your case. Grounds are loaded from legal database."
    maps_to:
      - section8_grounds

  - id: ground14_severity
    section: Section 8 Grounds
    question: "How severe is the antisocial behaviour?"
    inputType: select
    dependsOn:
      questionId: section8_grounds_selection
      valueContains: "Ground 14"
    validation:
      required: true
    options:
      - value: "serious"
        label: "Serious (violence, threats, drug dealing)"
      - value: "moderate"
        label: "Moderate (noise, minor nuisance)"
    maps_to:
      - ground14_severity

  - id: ground_particulars
    section: Section 8 Grounds
    question: "Provide specific details for each ground selected"
    inputType: textarea
    dependsOn:
      questionId: selected_notice_route
      value: section_8
    validation:
      required: true
    helperText: "For each ground, provide: dates, amounts (if arrears), specific incidents, evidence available. Be factual and specific."
    suggestion_prompt: >
      Draft clear, factual particulars for Section 8 Notice. For each ground selected, provide:
      - Dates when incidents occurred or breaches started
      - Amounts (if rent arrears)
      - Specific examples and evidence
      - Witnesses or documentation available
      Keep professional and court-ready. Focus on facts, not opinions.
    maps_to:
      - ground_particulars
      - section_8_particulars

  - id: notice_strategy
    section: Section 8 Grounds
    question: "Notice period strategy"
    inputType: select
    dependsOn:
      questionId: selected_notice_route
      value: section_8
    validation:
      required: true
    options:
      - value: "minimum"
        label: "Minimum legal period (14 days)"
      - value: "recommended"
        label: "Recommended period (60 days for discretionary grounds)"
    helperText: "Recommended period improves court success probability"
    maps_to:
      - notice_strategy

  # ========================================
  # NOTICE SERVICE + EXPIRY (comes AFTER grounds for Section 8)
  # ========================================

  - id: notice_service
    section: Notice Details
    question: "Notice service and expiry"
    inputType: group
    dependsOn:
      anyOf:
        - questionId: selected_notice_route
          value: section_8
        - questionId: selected_notice_route
          value: section_21
    helperText: "We need these dates to calculate the minimum notice period and check statutory bars."
    fields:
      - id: notice_service_date
        label: "Date the notice will be served"
        inputType: date
        validation:
          required: true
      - id: notice_expiry_date
        label: "Date the notice should expire"
        inputType: date
        validation:
          required: false
        helperText: "Will be auto-calculated based on your grounds and service date"
      - id: service_method
        label: "How will you serve the notice?"
        inputType: select
        options: ["Post", "By hand", "Email (agreed)", "Other"]
        validation:
          required: true
      - id: served_by
        label: "Who will serve the notice?"
        inputType: text
    maps_to:
      - notice_service.notice_date
      - notice_service.notice_expiry_date
      - notice_service.service_method
      - notice_service.served_by
