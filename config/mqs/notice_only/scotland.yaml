# Version History:
# 2.0.0 - Added ground-specific conditional questions for better Notice to Leave particulars
#         - Ground selection with basic particulars for each ground type

__meta:
  version: "2.0.0"
  effective_from: "2025-12-03"
  last_updated: "2025-12-03"
  legal_review_date: "2025-12-03"
  jurisdiction: "scotland"
  product: "notice_only"

# Audit Notes (2025-12-03)
# - IDs unique and dependsOn references validated by script.
# - maps_to keys match WizardFacts for Scottish notice routing; avoids court form promises.
# - Evidence upload step present to gather tenancy, arrears/ASB and supporting files.

id: notice_only_scotland_v2
product: notice_only
jurisdiction: scotland
version: "2.0.0"

questions:
  # 1. Landlord details
  - id: landlord_details
    section: Landlord Details
    question: Your details
    inputType: group
    helperText: "We need your details to complete the Notice to Leave correctly."
    fields:
      - id: landlord_full_name
        label: Full name
        inputType: text
        placeholder: "Jane Landlord"
        validation:
          required: true
        width: full
      - id: landlord_address
        label: Your address (for service)
        inputType: textarea
        placeholder: "Building and street\nTown/City\nPostcode"
        validation:
          required: true
        width: full
      - id: landlord_email
        label: Email address
        inputType: email
        placeholder: "you@example.com"
        validation:
          required: true
        width: half
      - id: landlord_phone
        label: Phone number
        inputType: tel
        placeholder: "07700 900000"
        validation:
          required: true
        width: half
      # MANDATORY: Scottish Landlord Registration (all landlords must register)
      - id: landlord_registration_number
        label: Scottish Landlord Registration Number
        inputType: text
        placeholder: "e.g., 123456/130/12345"
        helperText: "MANDATORY: All landlords in Scotland must be registered. Check www.landlordregistrationscotland.gov.uk"
        validation:
          required: true
        width: full
    maps_to:
      - landlord_full_name
      - landlord_address
      - landlord_email
      - landlord_phone
      - landlord_registration_number

  # 2. Tenant details
  - id: tenant_details
    section: Tenant Details
    question: Tenant details
    inputType: group
    helperText: "Main tenant(s) named on the Private Residential Tenancy agreement."
    fields:
      - id: tenant_full_name
        label: Main tenant full name
        inputType: text
        placeholder: "John Tenant"
        validation:
          required: true
        width: full
      - id: tenant_2_name
        label: Second tenant (if any)
        inputType: text
        placeholder: "Second tenant full name"
        width: full
    maps_to:
      - tenant_full_name
      - tenant_2_name

  # 3. Property address
  - id: property_details
    section: Property
    question: Property address
    inputType: group
    helperText: "The rented property this Notice to Leave relates to."
    fields:
      - id: property_address_line1
        label: Address line 1
        inputType: text
        validation:
          required: true
        width: full
      - id: property_address_line2
        label: Address line 2 (optional)
        inputType: text
        width: full
      - id: property_address_town
        label: Town or city
        inputType: text
        validation:
          required: true
        width: half
      - id: property_postcode
        label: Postcode
        inputType: text
        validation:
          required: true
        width: half
    maps_to:
      - property.address_line1
      - property.address_line2
      - property.city
      - property.postcode

  # 4. Tenancy type and dates
  - id: tenancy_type_and_dates
    section: Tenancy Details
    question: Tenancy type and start date
    inputType: group
    helperText: "Confirm this is a Private Residential Tenancy and provide the start date."
    fields:
      - id: tenancy_type
        label: "Tenancy type"
        inputType: select
        options:
          - "Private Residential Tenancy (PRT)"
          - "Other / unsure"
        validation:
          required: true
        width: half
      - id: tenancy_start_date
        label: "When did the tenancy start?"
        inputType: date
        helperText: "Use the date from the PRT agreement."
        validation:
          required: true
        width: half
    maps_to:
      - tenancy.tenancy_type
      - tenancy.start_date

  - id: rent_terms
    section: Rent Terms
    question: "Rent details"
    inputType: group
    helperText: "We need this for the rent arrears breakdown and tribunal paperwork."
    fields:
      - id: rent_amount
        label: "Monthly rent amount"
        inputType: currency
        validation:
          required: true
      - id: rent_frequency
        label: "Rent frequency"
        inputType: select
        options: ["weekly", "monthly", "yearly", "other"]
        validation:
          required: true
      - id: rent_due_day
        label: "Day of month rent is due"
        inputType: number
        validation:
          required: true
    maps_to:
      - tenancy.rent_amount
      - tenancy.rent_frequency
      - tenancy.rent_due_day
    suggestion_prompt: >
      Check the rent amount, payment frequency, and due date against the tenancy agreement and bank records.
      Highlight any inconsistencies to the landlord.

  - id: rent_arrears
    section: Rent Arrears
    question: "Is the tenant in rent arrears?"
    inputType: yes_no
    validation:
      required: true
    maps_to:
      - issues.rent_arrears.has_arrears
    suggestion_prompt: >
      Confirm whether arrears exist and remind the landlord that pre-action requirements apply before eviction based on rent arrears.

  - id: arrears_amount
    section: Rent Arrears
    question: "Total arrears outstanding"
    inputType: currency
    helperText: "If none, enter 0. Our smart guidance system will help you understand which grounds apply and ensure you meet pre-action requirements for Ground 1."
    validation:
      required: true
      min: 0
    dependsOn:
      questionId: rent_arrears
      value: "Yes"
    maps_to:
      - issues.rent_arrears.total_arrears

  - id: pre_action_contact
    section: Rent Arrears
    question: "Have you completed the pre-action requirements (contacting the tenant about arrears)?"
    inputType: yes_no
    validation:
      required: true
    dependsOn:
      questionId: rent_arrears
      value: "Yes"
    maps_to:
      - issues.rent_arrears.pre_action_confirmed
    suggestion_prompt: >
      Ensure the landlord has attempted reasonable contact about arrears and signposted support before serving a Notice to Leave.
      Scotland law requires landlords to take specific pre-action steps before evicting for rent arrears.

  # ============================================================
  # SCOTLAND PRE-ACTION PROTOCOL (Expanded)
  # Required for Ground 1 (Rent Arrears) - Tribunal will check
  # ============================================================

  - id: pre_action_protocol
    section: Pre-Action Protocol
    question: "Pre-action protocol compliance"
    inputType: group
    dependsOn:
      questionId: rent_arrears
      value: "Yes"
    helperText: "Scotland requires specific pre-action steps before eviction for rent arrears. The tribunal WILL check this."
    fields:
      - id: rent_statement_sent
        label: "Did you send the tenant a rent statement?"
        inputType: yes_no
        helperText: "Clear breakdown of rent due vs paid"
        width: half
      - id: rent_statement_date
        label: "Rent statement date"
        inputType: date
        width: half
        dependsOn:
          fieldId: rent_statement_sent
          value: true
      - id: advice_signposting
        label: "Did you signpost the tenant to advice services?"
        inputType: yes_no
        helperText: "Citizens Advice, Shelter Scotland, local council"
        width: half
      - id: signposted_to
        label: "Which services did you signpost to?"
        inputType: multiselect
        options:
          - "Citizens Advice Scotland"
          - "Shelter Scotland"
          - "Local council housing team"
          - "Money Advice Scotland"
          - "StepChange"
          - "Other advice service"
        width: full
        dependsOn:
          fieldId: advice_signposting
          value: true
      - id: reasonable_time_given
        label: "Did you give the tenant reasonable time to pay?"
        inputType: yes_no
        helperText: "Typically at least 14 days"
        width: half
      - id: time_given_details
        label: "How much time was given?"
        inputType: textarea
        placeholder: "E.g., Gave tenant 4 weeks to arrange payment plan..."
        width: full
        dependsOn:
          fieldId: reasonable_time_given
          value: true
      - id: payment_plan_offered
        label: "Did you offer a payment plan?"
        inputType: yes_no
        width: half
      - id: payment_plan_details
        label: "Payment plan details"
        inputType: textarea
        placeholder: "E.g., Offered to clear arrears over 6 months at £100/month..."
        width: full
        dependsOn:
          fieldId: payment_plan_offered
          value: true
      - id: housing_benefit_check
        label: "Did you check if tenant is claiming housing benefit?"
        inputType: yes_no
        helperText: "Required to check before proceeding"
        width: half
      - id: housing_benefit_details
        label: "Housing benefit status"
        inputType: textarea
        placeholder: "E.g., Tenant confirmed not claiming benefits / Claim pending since..."
        width: full
    maps_to:
      - scotland_pre_action.rent_statement_sent
      - scotland_pre_action.rent_statement_date
      - scotland_pre_action.advice_signposting
      - scotland_pre_action.signposted_to
      - scotland_pre_action.reasonable_time_given
      - scotland_pre_action.time_given_details
      - scotland_pre_action.payment_plan_offered
      - scotland_pre_action.payment_plan_details
      - scotland_pre_action.housing_benefit_check
      - scotland_pre_action.housing_benefit_details

  - id: deposit_protection
    section: Deposit Protection
    question: "Deposit details"
    inputType: group
    helperText: "Scotland deposits must be protected in an approved scheme within 30 WORKING DAYS (not calendar days)."
    fields:
      - id: deposit_amount
        label: "Deposit amount"
        inputType: currency
        width: half
      - id: deposit_protected
        label: "Is the deposit protected?"
        inputType: yes_no
        width: half
      - id: deposit_scheme_name
        label: "Which approved scheme?"
        inputType: select
        options:
          - "SafeDeposits Scotland"
          - "Letting Protection Service Scotland"
          - "mydeposits Scotland"
        helperText: "Only these 3 schemes are approved in Scotland"
        width: full
        dependsOn:
          fieldId: deposit_protected
          value: true
      # CRITICAL: Deposit protection dates for compliance verification
      - id: deposit_paid_date
        label: "Date deposit was paid by tenant"
        inputType: date
        helperText: "When did you receive the deposit?"
        width: half
        dependsOn:
          fieldId: deposit_protected
          value: true
      - id: deposit_protection_date
        label: "Date deposit was protected"
        inputType: date
        helperText: "SCOTLAND: Must be within 30 WORKING DAYS (not calendar days)"
        width: half
        dependsOn:
          fieldId: deposit_protected
          value: true
    maps_to:
      - tenancy.deposit_amount
      - tenancy.deposit_protected
      - tenancy.deposit_scheme_name
      - deposit_paid_date
      - deposit_protection_date
    suggestion_prompt: >
      Remind the landlord to provide proof of deposit protection and prescribed information where applicable.

  # CRITICAL: Working days clarification for Scotland
  - id: deposit_working_days_info
    section: Deposit Protection
    question: "Working Days Calculation"
    inputType: info
    dependsOn:
      questionId: deposit_protected
      value: true
    content: |
      ⚠️ **SCOTLAND: 30 WORKING DAYS (not calendar days)**

      Under Housing (Scotland) Act 2014, deposits must be protected within **30 WORKING DAYS**.

      **Working days = Monday to Friday, excluding:**
      - Scottish bank holidays
      - Christmas Day, Boxing Day, New Year's Day, 2nd January
      - Good Friday, Early May, Spring & Autumn bank holidays

      **This is approximately 6 calendar weeks.**

      Example: Deposit received Friday 1st = Protected by Friday 12th (6 weeks later)

      **Penalty for late protection:** Up to 3x deposit amount

  - id: safety_checks
    section: Safety Checks
    question: "Do you have up-to-date safety certificates (gas, electrical, smoke alarms)?"
    inputType: yes_no
    validation:
      required: true
    maps_to:
      - evidence.safety_certificates_uploaded
    suggestion_prompt: >
      Highlight any missing safety documentation needed for tribunal compliance.

  # ============================================================
  # REPAIRING STANDARD (Scotland)
  # ============================================================

  - id: repairing_standard_met
    section: Property Compliance
    question: "Does the property meet the Repairing Standard?"
    inputType: radio
    validation:
      required: true
    options:
      - value: true
        label: "Yes - property meets Repairing Standard"
      - value: false
        label: "No - there are outstanding repair issues"
    helperText: |
      Under Housing (Scotland) Act 2006, Section 13:
      All private landlords must ensure their property meets the Repairing Standard.
    maps_to:
      - scotland_compliance.repairing_standard_met

  - id: repairing_standard_warning
    section: Property Compliance
    question: "Repairing Standard Warning"
    inputType: info
    dependsOn:
      questionId: repairing_standard_met
      value: false
    content: |
      ⛔ **WARNING: NOTICE TO LEAVE MAY BE CHALLENGED**

      Under Housing (Scotland) Act 2006, Section 13, landlords must ensure their
      property meets the **Repairing Standard** throughout the tenancy.

      **The Repairing Standard requires:**
      - Wind and watertight structure
      - Safe gas, electrical, water and drainage installations
      - Satisfactory heating/hot water
      - Safe food preparation facilities
      - Adequate fire detection (linked interlinked smoke/heat alarms from Feb 2022)
      - Carbon monoxide detectors where required

      **If the tenant has applied to the Housing and Property Chamber:**
      - The Tribunal may issue a Repairing Standard Enforcement Order
      - This may affect your ability to evict
      - Consider resolving repair issues first

      **Recommendation:** Address any Repairing Standard issues before serving notice.

  # ============================================================
  # COMPLIANCE CERTIFICATE DATES
  # ============================================================

  - id: compliance_dates
    section: Compliance Certificates
    question: "Compliance certificate dates"
    inputType: group
    helperText: "Provide dates for your safety certificates."
    dependsOn:
      questionId: safety_checks
      value: "Yes"
    fields:
      - id: gas_cert_date
        label: "Gas safety certificate date"
        inputType: date
        helperText: "Date of most recent gas safety certificate"
        width: half
      - id: gas_cert_expiry
        label: "Gas certificate expiry date"
        inputType: date
        helperText: "Expires 12 months after issue"
        width: half
      - id: eicr_date
        label: "Electrical safety (EICR) date"
        inputType: date
        helperText: "Electrical Installation Condition Report date"
        width: half
      - id: smoke_alarm_check_date
        label: "Smoke/heat alarm check date"
        inputType: date
        helperText: "Date alarms were last checked"
        width: half
    maps_to:
      - compliance.gas_cert_date
      - compliance.gas_cert_expiry
      - compliance.eicr_date
      - compliance.smoke_alarm_check_date

  - id: asb_details
    section: Antisocial Behaviour
    question: "Has there been any antisocial behaviour?"
    inputType: yes_no
    maps_to:
      - issues.asb.has_asb
    suggestion_prompt: >
      Capture any relevant ASB incidents for the Notice to Leave and tribunal evidence.

  - id: asb_description
    section: Antisocial Behaviour
    question: "Describe the antisocial behaviour incidents"
    inputType: textarea
    dependsOn:
      questionId: asb_details
      value: "Yes"
    maps_to:
      - issues.asb.description
      - issues.asb.incidents
    suggestion_prompt: >
      Summarise dates, witnesses, and any police or council involvement. Keep it factual.

  # ============================================================
  # RISK INDICATORS
  # ============================================================

  - id: risk_indicators
    section: Risk Assessment
    question: "Risk factors"
    inputType: group
    helperText: "This information helps identify potential issues with your case."
    fields:
      - id: known_tenant_defences
        label: "Are you aware of any defences the tenant may raise?"
        inputType: textarea
        helperText: "E.g., claims of disrepair, harassment, discrimination"
        placeholder: "Describe any known or anticipated tenant defences..."
        width: full
      - id: disrepair_complaints
        label: "Has the tenant complained about disrepair?"
        inputType: yes_no
        width: half
      - id: disrepair_complaint_date
        label: "Date of disrepair complaint"
        inputType: date
        width: half
        dependsOn:
          fieldId: disrepair_complaints
          value: true
      - id: disrepair_issues_list
        label: "List the disrepair issues"
        inputType: textarea
        width: full
        dependsOn:
          fieldId: disrepair_complaints
          value: true
      - id: previous_court_proceedings
        label: "Previous tribunal proceedings about this tenancy?"
        inputType: yes_no
        width: half
      - id: previous_proceedings_details
        label: "Previous proceedings details"
        inputType: textarea
        helperText: "Dates, case numbers, outcomes"
        width: full
        dependsOn:
          fieldId: previous_court_proceedings
          value: true
      - id: tenant_vulnerability
        label: "Are you aware of any tenant vulnerabilities?"
        inputType: yes_no
        helperText: "E.g., elderly, disabled, mental health issues, children"
        width: half
      - id: tenant_vulnerability_details
        label: "Vulnerability details"
        inputType: textarea
        helperText: "Tribunal may consider this when deciding reasonableness"
        width: full
        dependsOn:
          fieldId: tenant_vulnerability
          value: true
    maps_to:
      - risk.known_tenant_defences
      - risk.disrepair_complaints
      - risk.disrepair_complaint_date
      - risk.disrepair_issues_list
      - risk.previous_court_proceedings
      - risk.previous_proceedings_details
      - risk.tenant_vulnerability
      - risk.tenant_vulnerability_details

  - id: eviction_grounds
    section: Grounds for Eviction
    question: "Which grounds for eviction apply?"
    inputType: multiselect
    helperText: "Select all PRT grounds that apply to this case. Our smart guidance system will help you understand notice periods, evidence requirements, and tribunal success probabilities for each ground."
    options:
      - "Ground 1 - Rent arrears (3+ months)"
      - "Ground 2 - Breach of tenancy"
      - "Ground 3 - Antisocial behaviour"
      - "Ground 4 - Landlord intends to occupy"
      - "Ground 5 - Landlord intends to sell"
      - "Ground 6 - Refurbishment required"
      - "Ground 11 - Not occupying as principal home"
      - "Ground 12 - Criminal conviction"
      - "Ground 13 - Mortgage lender repossession"
      - "Other ground"
    validation:
      required: true
    maps_to:
      - eviction_grounds
      - scotland_ground_codes
    suggestion_prompt: >
      Help landlord select appropriate grounds based on case facts. Remind that pre-action requirements
      are mandatory for Ground 1 (rent arrears).

  - id: ground_particulars
    section: Grounds for Eviction
    question: "Provide specific details for each ground selected"
    inputType: textarea
    helperText: "For each ground selected, provide: dates, amounts (if arrears), specific incidents (if breach/ASB), or plans (if sale/refurb)."
    validation:
      required: true
    maps_to:
      - ground_particulars
      - notice_reason
    suggestion_prompt: >
      Draft clear, factual particulars for Notice to Leave. Focus on: what happened, when, amounts owed,
      evidence available. Keep professional and tribunal-ready.

  - id: notice_service
    section: Notice Service
    question: "Notice details"
    inputType: group
    helperText: "We need these for the Notice to Leave. Our smart guidance system will automatically calculate the correct notice period and expiry date based on your selected grounds."
    fields:
      - id: notice_date
        label: "Date notice will be served"
        inputType: date
        validation:
          required: true
      - id: notice_expiry
        label: "Date the notice should expire"
        inputType: date
        validation:
          required: true
      - id: service_method
        label: "How will you serve the notice?"
        inputType: select
        options: ["Recorded delivery", "By hand", "Email (agreed)", "Other"]
        validation:
          required: true
      - id: served_by
        label: "Who will serve the notice?"
        inputType: text
    maps_to:
      - notice.notice_date
      - notice.expiry_date
      - notice.service_method
      - notice.served_by

  # ============================================================
  # EVIDENCE WITH DESCRIBE OPTION
  # ============================================================

  - id: evidence_tenancy_agreement
    section: Evidence
    question: "Tenancy Agreement"
    inputType: group
    helperText: "Upload your PRT agreement or summarize key terms."
    fields:
      - id: tenancy_agreement_upload
        label: "Upload tenancy agreement"
        inputType: upload
        helperText: "Upload a copy of the PRT"
        width: full
      - id: tenancy_agreement_describe
        label: "Or summarize key terms"
        inputType: textarea
        helperText: "If unable to upload, describe: start date, rent amount, key terms"
        placeholder: "E.g., PRT started 01/01/2024, rent £950pcm due 1st of each month..."
        width: full
    maps_to:
      - evidence.tenancy_agreement_uploads
      - evidence.tenancy_agreement_description

  - id: evidence_rent_schedule
    section: Evidence
    question: "Rent Payment Evidence"
    inputType: group
    helperText: "Upload rent schedule/statements or summarize payment history."
    fields:
      - id: rent_schedule_upload
        label: "Upload rent schedule"
        inputType: upload
        helperText: "Upload rent ledger or bank statements"
        width: full
      - id: bank_statements_describe
        label: "Or describe payment history"
        inputType: textarea
        helperText: "Summarize rent payment pattern"
        placeholder: "E.g., Rent paid on time Jan-June. Payments stopped July. Last payment £450 on 15/08..."
        width: full
    maps_to:
      - evidence.rent_schedule_uploads
      - evidence.bank_statements_description

  - id: evidence_correspondence
    section: Evidence
    question: "Correspondence with Tenant"
    inputType: group
    helperText: "Upload correspondence or summarize key communications."
    fields:
      - id: correspondence_upload
        label: "Upload correspondence"
        inputType: upload
        helperText: "Warning letters, emails, texts with tenant"
        width: full
      - id: correspondence_describe
        label: "Or summarize key correspondence"
        inputType: textarea
        helperText: "Summarize important communications"
        placeholder: "E.g., 01/06/2024 - Sent rent arrears letter by recorded delivery..."
        width: full
    maps_to:
      - evidence.correspondence_uploads
      - evidence.correspondence_description

  - id: evidence_other
    section: Evidence
    question: "Other Supporting Documents"
    inputType: upload
    helperText: "Upload any other supporting documents (photos, authority letters, police reports, etc.)"
    validation:
      required: false
    evidence_types:
      - photos
      - authority_letters
    maps_to:
      - evidence.other_evidence_uploaded
    suggestion_prompt: >
      Suggest the most useful evidence for a Scottish notice to leave: photos of issues,
      council/police correspondence, ASB logs.

  - id: service_contact
    section: Service Contact
    question: "Where should tribunal documents be served?"
    inputType: group
    helperText: "If you have a solicitor or agent, use their service details."
    fields:
      - id: service_name
        label: "Service contact name"
        inputType: text
        validation:
          required: true
      - id: service_address_line1
        label: "Service address line 1"
        inputType: text
        validation:
          required: true
      - id: service_city
        label: "Service city"
        inputType: text
        validation:
          required: true
      - id: service_postcode
        label: "Service postcode"
        inputType: text
        validation:
          required: true
      - id: service_email
        label: "Service email"
        inputType: email
      - id: service_phone
        label: "Service phone"
        inputType: tel
    maps_to:
      - service_contact.service_name
      - service_contact.service_address_line1
      - service_contact.service_city
      - service_contact.service_postcode
      - service_contact.service_email
      - service_contact.service_phone
    suggestion_prompt: >
      Confirm the tribunal can use these details to send correspondence and notices.
