# Notice Only Field Map ‚Äî Complete MSQ ‚Üí Template Variable Traceability

**Version:** 1.0.0
**Last Updated:** 2025-12-16
**Purpose:** Complete traceability from MSQ questions ‚Üí wizard facts ‚Üí mapper ‚Üí template variables

This document ensures **every template variable** is mapped and **no blank critical fields** render in notices.

---

## How to Use This Document

For any template variable:
1. Find it in the tables below
2. See which MSQ question(s) populate it
3. Understand the mapper transformation
4. Verify the field is not blank in production

**Rules:**
- ‚úÖ **Required** fields MUST have values (notices fail without them)
- ‚ö†Ô∏è **Conditional** fields are required only in certain contexts
- üìù **Optional** fields enhance the notice but aren't critical
- üîß **Computed** fields are generated by code, not MSQ

---

## Part 1: Common Fields (All Jurisdictions)

These fields appear in **all** Notice Only templates across England, Wales, and Scotland.

### 1.1 Landlord Details

| Template Variable | Required | MSQ Question ID(s) | Mapper Source Paths | Transformation | Notes |
|-------------------|----------|-------------------|---------------------|----------------|-------|
| `landlord_full_name` | ‚úÖ | `landlord_full_name` | `landlord_full_name`, `landlord.name`, `landlord_name`, `parties.landlord.name`, `claimant_full_name` | extractString() | Primary landlord name |
| `landlord_2_name` | üìù | (not in MSQ) | `landlord_2_name`, `landlord_secondary_name`, `landlord_co_claimant` | extractString() | Second landlord (optional) |
| `landlord_address` | ‚úÖ | (concatenated) | See breakdown below | Concatenated with `\n` | Full address block |
| `landlord_address_line1` | ‚úÖ | `landlord_address` (England/Wales group field) `landlord_details.landlord_address` (Scotland) | `landlord_address_line1`, `landlord.address_line1`, `landlord_address` | extractString() | First line extracted from group or textarea |
| `landlord_address_line2` | üìù | (same as above) | `landlord_address_line2`, `landlord.address_line2` | extractString() | Second line |
| `landlord_city` | ‚úÖ | (same as above) | `landlord_address_town`, `landlord_city`, `landlord.city` | extractString() | Town/city |
| `landlord_postcode` | ‚úÖ | (same as above) | `landlord_address_postcode`, `landlord_postcode`, `landlord.postcode` | extractString() | UK postcode |
| `landlord_email` | ‚ö†Ô∏è | `landlord_details.landlord_email` (Scotland) | `landlord_email`, `landlord.email` | extractString() | Scotland requires email |
| `landlord_phone` | ‚ö†Ô∏è | `landlord_details.landlord_phone` (Scotland) | `landlord_phone`, `landlord.phone` | extractString() | Scotland requires phone |
| `landlord_reg_number` | ‚ö†Ô∏è | (not in current MSQ but expected) | `landlord_reg_number` | extractString() | Scotland landlord registration number |

**Address Concatenation Logic:**
```javascript
landlord_address = [
  landlord_address_line1,
  landlord_address_line2,
  landlord_city,
  landlord_postcode
].filter(Boolean).join('\n')
```

**Current Issue:** England/Wales MSQs only have `landlord_full_name`. Address fields are missing. **FIX REQUIRED.**

---

### 1.2 Tenant Details

| Template Variable | Required | MSQ Question ID(s) | Mapper Source Paths | Transformation | Notes |
|-------------------|----------|-------------------|---------------------|----------------|-------|
| `tenant_full_name` | ‚úÖ | `tenant_full_name` (England), `contract_holder_full_name` (Wales), `tenant_details.tenant_full_name` (Scotland) | `tenant_full_name`, `tenant1_name`, `contract_holder_full_name`, `parties.tenants.0.name` | extractString() | Primary tenant name |
| `tenant_2_name` | üìù | `tenant_details.tenant_2_name` (Scotland only) | `tenant_2_name`, `tenant2_name`, `tenant_secondary_name` | extractString() | Second tenant (optional) |
| `contract_holder_full_name` | ‚úÖ (Wales) | `contract_holder_full_name` (Wales) | `contract_holder_full_name`, fallback: `tenant_full_name` | extractString() | Wales uses "contract holder" terminology |

**Wales Terminology:** Templates use `{{contract_holder_full_name}}` but MSQ collects `contract_holder_full_name`. Mapper provides fallback to `tenant_full_name`.

---

### 1.3 Property Address

| Template Variable | Required | MSQ Question ID(s) | Mapper Source Paths | Transformation | Notes |
|-------------------|----------|-------------------|---------------------|----------------|-------|
| `property_address` | ‚úÖ | `property_address` (England/Wales textarea), `property_details.*` (Scotland group) | See breakdown below | Concatenated with `\n` | Full property address block |
| `property_address_line1` | ‚úÖ | `property_address` (extracted), `property_details.property_address_line1` (Scotland) | `property_address_line1`, `property.address_line1`, `property_address` | extractString() | First line |
| `property_address_line2` | üìù | `property_details.property_address_line2` (Scotland) | `property_address_line2`, `property.address_line2` | extractString() | Second line (optional) |
| `property_city` | ‚úÖ | `property_details.property_address_town` (Scotland) | `property_address_town`, `property_city`, `property.city` | extractString() | Town/city |
| `property_postcode` | ‚úÖ | `property_details.property_postcode` (Scotland) | `property_address_postcode`, `property_postcode`, `property.postcode` | extractString() | UK postcode |

**Address Concatenation Logic:**
```javascript
property_address = [
  property_address_line1,
  property_address_line2,
  property_city,
  property_postcode
].filter(Boolean).join('\n')
```

**Current Issue:** England/Wales MSQs use a single `textarea` for `property_address`. Mapper needs to parse this OR MSQ needs structured fields. **FIX REQUIRED.**

---

### 1.4 Tenancy/Contract Dates

| Template Variable | Required | MSQ Question ID(s) | Mapper Source Paths | Transformation | Notes |
|-------------------|----------|-------------------|---------------------|----------------|-------|
| `tenancy_start_date` | ‚úÖ | `tenancy_start_date` (England), `contract_start_date` (Wales), `tenancy_type_and_dates.tenancy_start_date` (Scotland) | `tenancy_start_date`, `contract_start_date`, `start_date` | extractString(), format DD/MM/YYYY | When tenancy began |
| `contract_start_date` | ‚úÖ (Wales) | `contract_start_date` (Wales) | `contract_start_date`, fallback: `tenancy_start_date` | extractString(), format DD/MM/YYYY | Wales uses "occupation contract" |
| `fixed_term` | ‚úÖ | `is_fixed_term` (England/Wales) | `is_fixed_term`, `fixed_term`, `tenancy_fixed_term` | coerceBoolean() | Boolean: is it a fixed-term tenancy? |
| `fixed_term_end_date` | ‚ö†Ô∏è | `fixed_term_end_date` (conditional on `is_fixed_term`) | `fixed_term_end_date`, `tenancy_end_date` | extractString(), format DD/MM/YYYY | Required if fixed_term = true |
| `fixed_term_expired` | üîß | (computed) | N/A | Compare `fixed_term_end_date` < today | Computed in template |

---

### 1.5 Rent Details

| Template Variable | Required | MSQ Question ID(s) | Mapper Source Paths | Transformation | Notes |
|-------------------|----------|-------------------|---------------------|----------------|-------|
| `rent_amount` | ‚úÖ | `rent_amount` (all MSQs), `rent_terms.rent_amount` (Scotland) | `rent_amount` | Number() | Monthly rent in GBP |
| `rent_frequency` | ‚úÖ | `rent_terms.rent_frequency` (Scotland) | `rent_frequency`, `rent_period` | extractString() | "monthly", "weekly", etc. |
| `rent_period_description` | üîß | (derived from `rent_frequency`) | N/A | Mapper logic: "monthly" ‚Üí "month", "weekly" ‚Üí "week" | Singular form for templates |
| `payment_date` | ‚ö†Ô∏è | `rent_terms.rent_due_day` (Scotland) | `payment_date`, `rent_due_day` | Number() | Day of month rent is due (e.g., 1, 15, 28) |

**Current Issue:** England/Wales MSQs don't collect `rent_frequency` or `payment_date`. Templates may reference these. **FIX REQUIRED.**

---

### 1.6 Notice Dates (Critical)

| Template Variable | Required | MSQ Question ID(s) | Mapper Source Paths | Transformation | Notes |
|-------------------|----------|-------------------|---------------------|----------------|-------|
| `service_date` | ‚úÖ | `notice_service.notice_date` (Scotland), (missing in England/Wales?) | `notice_service_date`, `service_date`, `notice_date` | extractString(), format DD/MM/YYYY | Date notice is served |
| `notice_date` | ‚úÖ | `notice_service.notice_date` (Scotland) | `notice_date`, `notice_service_date`, `service_date` | extractString(), format DD/MM/YYYY | Same as service_date |
| `expiry_date` | ‚úÖ üîß | `notice_service.notice_expiry` (Scotland), OR computed | `notice_expiry_date`, `expiry_date` | extractString() OR computed | **CRITICAL**: Earliest date tenant must leave |
| `earliest_possession_date` | ‚úÖ üîß | (computed by decision engine) | N/A | Computed based on route and grounds | England Section 8 only |
| `possession_date` | ‚úÖ üîß | (computed) | N/A | Same as `expiry_date` | England Section 21 only (Form 6A) |
| `earliest_leaving_date` | ‚úÖ (Scotland) | `notice_service.notice_expiry` (Scotland) | `earliest_leaving_date` | extractString(), format DD/MM/YYYY | Scotland terminology |
| `earliest_tribunal_date` | ‚úÖ (Scotland) | (computed OR MSQ) | `earliest_tribunal_date` | extractString(), format DD/MM/YYYY | Scotland: earliest Tribunal application date |
| `notice_period_days` | üîß | (computed) | `notice_period_days` | Number() | Number of days notice given |

**CRITICAL:** `expiry_date` / `earliest_possession_date` MUST be computed correctly. These determine when court/tribunal proceedings can begin.

---

### 1.7 Deposit & Compliance

| Template Variable | Required | MSQ Question ID(s) | Mapper Source Paths | Transformation | Notes |
|-------------------|----------|-------------------|---------------------|----------------|-------|
| `deposit_taken` | ‚úÖ | `deposit_taken` (England), `deposit_taken_wales` (Wales S173), `deposit_taken_fault` (Wales fault), `deposit_protection.deposit_amount` > 0 (Scotland) | `deposit_taken`, `deposit_taken_wales`, `deposit_taken_fault` | coerceBoolean() | Was a deposit taken? |
| `deposit_protected` | ‚ö†Ô∏è | `deposit_protected_scheme` (England), `deposit_protected_wales` (Wales S173), `deposit_protected_fault` (Wales fault), `deposit_protection.deposit_protected` (Scotland) | `deposit_protected`, `deposit_protected_wales`, `deposit_protected_fault` | coerceBoolean() | Is deposit protected in approved scheme? |
| `deposit_amount` | ‚ö†Ô∏è | `deposit_protection.deposit_amount` (Scotland) | `deposit_amount` | Number() | Deposit amount in GBP |
| `deposit_scheme` | ‚ö†Ô∏è | `deposit_scheme_wales_s173`, `deposit_scheme_fault` (Wales), `deposit_protection.deposit_scheme_name` (Scotland) | `deposit_scheme`, `deposit_scheme_name` | extractString() | Scheme name (DPS, MyDeposits, TDS, etc.) |
| `deposit_reference` | üìù | (not in MSQ) | `deposit_reference`, `deposit_protection_reference` | extractString() | Deposit protection certificate reference |
| `prescribed_info_provided` | ‚ö†Ô∏è (England S21) | `prescribed_info_given` (England) | `prescribed_info_provided`, `prescribed_info_given` | coerceBoolean() | England S21: prescribed info given within 30 days? |
| `prescribed_info_date` | üìù | (not in MSQ) | `prescribed_info_date` | extractString(), format DD/MM/YYYY | Date prescribed info was given |

---

## Part 2: England-Specific Fields

### 2.1 Section 8 (Fault-Based) Fields

| Template Variable | Required | MSQ Question ID(s) | Mapper Source Paths | Transformation | Notes |
|-------------------|----------|-------------------|---------------------|----------------|-------|
| `grounds` | ‚úÖ | `section8_grounds_selection` | `section8_grounds` | Array of ground objects, each with: `code`, `title`, `legal_basis`, `particulars`, `mandatory` | **CRITICAL**: Ground objects must be structured |
| `any_mandatory_ground` | üîß | (derived from `grounds`) | N/A | Check if any ground has `mandatory: true` | Computed in template |
| `any_discretionary_ground` | üîß | (derived from `grounds`) | N/A | Check if any ground has `mandatory: false` | Computed in template |
| `notice_period_days` | üîß | `notice_strategy` (minimum or recommended) | N/A | 14 days (mandatory), 60 days (discretionary) | Computed based on grounds |
| `earliest_possession_date` | ‚úÖ üîß | (computed) | N/A | `service_date` + `notice_period_days` | **CRITICAL COMPUTATION** |

#### Ground-Specific Variables (Conditional)

**Ground 1 (Landlord Previously Occupied):**
- `ground_1_claimed` - Boolean (derived from grounds array)
- `landlord_previous_residence` - (not in MSQ)
- `landlord_residence_start` - (not in MSQ)
- `landlord_residence_end` - (not in MSQ)
- `landlord_residence_evidence` - (not in MSQ)
- `landlord_now_needs_property` - (not in MSQ)
- `reason_for_needing_property` - (not in MSQ)
- `notice_given_before_tenancy` - (not in MSQ)

**Ground 2 (Mortgage Lender):**
- `ground_2_claimed`
- `lender_name`, `mortgage_date`, `lender_demand_letter_attached` - (not in MSQ)

**Ground 8 (Serious Rent Arrears - MANDATORY):**
- `ground_8_claimed` - Boolean (derived from grounds array)
- `rent_frequency` - "weekly", "monthly", "quarterly"
- `arrears_at_notice_date` - Currency
- `current_arrears_amount` - Currency
- `arrears_duration_months` - Number
- `arrears_breakdown` - Array of objects: `{ period, amount_due, amount_paid, balance }`
- `total_arrears` - Currency
- `last_payment_date` - Date
- `last_payment_amount` - Currency

**Ground 10 (Some Rent Arrears):**
- `ground_10_claimed`
- `current_arrears` - Currency
- `arrears_explanation` - Text

**Ground 11 (Persistent Late Payment):**
- `ground_11_claimed`
- `total_late_payments`, `total_payments` - Numbers
- `late_payment_instances` - Array: `{ due_date, payment_date, days_late, amount }`
- `late_payment_pattern_description` - Text

**Ground 12 (Breach of Tenancy):**
- `ground_12_claimed`
- `tenancy_clause_breached` - Text
- `breach_type` - Text
- `breach_description` - Textarea
- `breach_start_date` - Date
- `breach_ongoing` - Boolean
- `breach_remedied` - Boolean
- `warnings_given` - Array: `{ date, method, description }`

**Ground 13 (Property Deterioration):**
- `ground_13_claimed`
- `property_condition_start`, `property_condition_current` - Text
- `deterioration_description` - Textarea
- `deterioration_areas` - Array of strings
- `estimated_repair_cost` - Currency
- `inventory_report_attached`, `photographic_evidence_attached` - Boolean

**Ground 14 (Antisocial Behaviour):**
- `ground_14_claimed`
- `nuisance_by_visitor` - Boolean
- `affected_party_description` - Text
- `nuisance_type` - Text
- `nuisance_description` - Textarea
- `incident_log` - Array: `{ date, time, description, witnesses }`
- `police_involvement`, `police_call_count`, `police_crime_numbers` - Police details
- `council_complaints`, `council_name`, `council_reference` - Council details
- `witness_statements_attached` - Boolean

**Current Issue:** MSQ only collects ground selection via `section8_grounds_selection`. **No follow-up questions for ground-specific particulars.** Templates expect detailed fields. **MAJOR GAP.**

---

### 2.2 Section 21 (No-Fault) Fields

| Template Variable | Required | MSQ Question ID(s) | Mapper Source Paths | Transformation | Notes |
|-------------------|----------|-------------------|---------------------|----------------|-------|
| `possession_date` | ‚úÖ üîß | (computed) | N/A | `service_date` + 2 months (or `fixed_term_end_date` if later) | **CRITICAL**: Form 6A prescribed field |
| `fixed_term` | ‚úÖ | `is_fixed_term` | See common fields | Boolean | Determines which section of Form 6A applies |
| `periodic_aligned_with_rent` | üîß | (computed) | N/A | Check if `possession_date` aligns with rent period | Affects Form 6A checkboxes |
| `first_anniversary_date` | üîß | (computed from `tenancy_start_date`) | N/A | `tenancy_start_date` + 1 year | Periodic tenancies only |
| `deposit_payment_date` | üìù | (not in MSQ) | `deposit_payment_date` | extractString(), format DD/MM/YYYY | When deposit was paid |
| `deposit_protection_date` | ‚ö†Ô∏è | (not in MSQ) | `deposit_protection_date` | extractString(), format DD/MM/YYYY | When deposit was protected |
| `epc_provided` | ‚úÖ | `epc_provided` | `epc_provided` | coerceBoolean() | **CRITICAL**: Section 21 invalid without EPC |
| `how_to_rent_provided` | ‚ö†Ô∏è | `how_to_rent_provided` | `how_to_rent_provided` | coerceBoolean() | Required if tenancy started after Oct 1, 2015 |
| `property_licensing_status` | ‚úÖ | `property_licensing` | `property_licensing_status` | extractString() | "not_required", "licensed", "unlicensed" |
| `recent_repair_complaints` | ‚úÖ | `recent_repair_complaints_s21` | `recent_repair_complaints` | coerceBoolean() | Retaliatory eviction rule (Section 21(4ZA)) |
| `all_compliance_met` | üîß | (computed from above fields) | N/A | Boolean: all compliance checks passed | Form 6A declaration section |

**Compliance Checklist Variables (for supporting doc):**
- `compliance_checklist` - Array of objects: `{ requirement, met, date }`

---

## Part 3: Wales-Specific Fields

### 3.1 Section 173 (No-Fault) Fields

| Template Variable | Required | MSQ Question ID(s) | Mapper Source Paths | Transformation | Notes |
|-------------------|----------|-------------------|---------------------|----------------|-------|
| `contract_holder_full_name` | ‚úÖ | `contract_holder_full_name` | `contract_holder_full_name`, fallback: `tenant_full_name` | extractString() | Wales terminology: "contract holder" |
| `contract_start_date` | ‚úÖ | `contract_start_date` | `contract_start_date`, fallback: `tenancy_start_date` | extractString(), format DD/MM/YYYY | Wales terminology: "occupation contract" |
| `wales_contract_category` | ‚úÖ | `wales_contract_category` | `wales_contract_category` | extractString() | "standard", "supported_standard", "secure" |
| `rent_smart_wales_registered` | ‚úÖ | `rent_smart_wales_registered` | `rent_smart_wales_registered` | coerceBoolean() | **CRITICAL**: Section 173 invalid without registration |
| `prohibited_period_violation` | üîß | (computed) | N/A | Check if `service_date` < (`contract_start_date` + 6 months) | Cannot serve S173 in first 6 months |
| `expiry_date` | ‚úÖ üîß | (computed) | N/A | `service_date` + 2 months (or 6 months if within first 4 years) | **CRITICAL COMPUTATION** |
| `is_wales` | ‚úÖ | (implicit from jurisdiction) | N/A | Boolean | Flag for supporting docs |

---

### 3.2 Wales Fault-Based Fields

| Template Variable | Required | MSQ Question ID(s) | Mapper Source Paths | Transformation | Notes |
|-------------------|----------|-------------------|---------------------|----------------|-------|
| `wales_fault_based_section` | ‚úÖ | `wales_fault_based_section` | `wales_fault_based_section` | extractString() | "Section 157", "Section 159", "Section 161", "Section 162" |
| `rent_arrears_amount` | ‚ö†Ô∏è | `rent_arrears_amount` (conditional on Section 157/159) | `rent_arrears_amount` | Number() | Total rent arrears |
| `asb_description` | ‚ö†Ô∏è | `asb_description` (conditional on Section 161) | `asb_description` | extractString() | Antisocial behaviour description |
| `breach_description` | ‚ö†Ô∏è | `breach_description` (conditional on Section 162) | `breach_description` | extractString() | Breach of contract description |

**Current Issue:** Wales fault-based templates **do not exist yet**. Preview API returns placeholder. **IMPLEMENTATION REQUIRED.**

---

## Part 4: Scotland-Specific Fields

### 4.1 Notice to Leave Fields

| Template Variable | Required | MSQ Question ID(s) | Mapper Source Paths | Transformation | Notes |
|-------------------|----------|-------------------|---------------------|----------------|-------|
| `landlord_reg_number` | ‚úÖ | (not in MSQ but expected) | `landlord_reg_number` | extractString() | Scotland landlord registration number |
| `grounds` | ‚úÖ | `eviction_grounds` | `eviction_grounds`, `scotland_ground_codes` | Array of ground objects | Multiselect of PRT grounds |
| `ground_particulars` | ‚úÖ | `ground_particulars` | `ground_particulars`, `notice_reason` | extractString() | **CRITICAL**: Detailed particulars for all grounds (textarea with Ask Heaven) |
| `earliest_leaving_date` | ‚úÖ üîß | `notice_service.notice_expiry` OR computed | `earliest_leaving_date` | extractString(), format DD/MM/YYYY | Earliest date tenant must leave |
| `earliest_tribunal_date` | ‚úÖ üîß | (computed) | `earliest_tribunal_date` | extractString(), format DD/MM/YYYY | Earliest Tribunal application date (same as `earliest_leaving_date`) |
| `notice_period_days` | üîß | (computed based on grounds) | `notice_period_days` | Number() | 28 days (Grounds 1-3) or 84 days (Grounds 4-6, 11-13) |

#### Ground-Specific Variables (Conditional)

**Ground 1 (Rent Arrears - 3+ months):**
- `ground_1_claimed` - Boolean (derived from `eviction_grounds`)
- `rent_amount` - From `rent_terms.rent_amount`
- `rent_period` - From `rent_terms.rent_frequency`
- `total_arrears` - From `arrears_amount`
- `arrears_date` - (not in MSQ)
- `arrears_duration_months` - (not in MSQ)
- `arrears_duration_days` - (not in MSQ)
- `arrears_breakdown` - Array: `{ period, amount_due, amount_paid, balance }` (not in MSQ)
- `last_payment_date`, `last_payment_amount` - (not in MSQ)
- `pre_action_evidence` - Derived from `pre_action_contact` (yes/no question only)

**Pre-Action Requirements (Ground 1 MANDATORY):**
- `pre_action_contact` - MSQ: `pre_action_contact` (yes/no)
- Pre-action details (evidence, dates) - **NOT COLLECTED IN MSQ**

**Ground 2 (Breach of Tenancy):**
- `ground_2_claimed`
- `tenancy_clause`, `breach_type`, `breach_description` - (not in MSQ, relies on `ground_particulars`)
- `breach_date`, `breach_continuing`, `breach_remedied` - (not in MSQ)
- `warnings_given`, `warnings_list` - (not in MSQ)

**Ground 3 (Antisocial Behaviour):**
- `ground_3_claimed`
- `asb_type`, `asb_description` - Derived from MSQ `asb_description` (conditional on `asb_details`)
- `asb_incidents` - Array: `{ date, time, description, witnesses }` (not in MSQ)
- `police_involved`, `police_call_count`, `police_crime_numbers` - (not in MSQ)
- `council_involved`, `council_name`, `council_reference` - (not in MSQ)

**Ground 4 (Landlord Intends to Occupy):**
- `ground_4_claimed`
- `reason_for_occupying`, `current_residence`, `occupation_timescale` - (not in MSQ, relies on `ground_particulars`)

**Ground 5 (Landlord Intends to Sell):**
- `ground_5_claimed`
- `sale_intention_details`, `estate_agent`, `estate_agent_name`, `estate_agent_date`, `marketing_planned`, `marketing_details` - (not in MSQ)

**Ground 6 (Refurbishment):**
- `ground_6_claimed`
- `refurbishment_description`, `vacant_possession_reason`, `planning_permission`, `planning_permission_date`, `planning_reference`, `building_warrant`, `building_warrant_details`, `contractor`, `contractor_name`, `works_start_date`, `works_duration` - (not in MSQ)

**Ground 11 (Not Occupying as Principal Home):**
- `ground_11_claimed`
- `non_occupation_evidence`, `duration_not_occupying`, `alternative_residence` - (not in MSQ)

**Ground 12 (Criminal Conviction):**
- `ground_12_claimed`
- `tenant_convicted`, `conviction_details`, `court_name`, `conviction_date`, `offence_description`, `sentence`, `connection_to_property`, `property_connection` - (not in MSQ)

**Ground 13 (Mortgage Lender Requiring Possession):**
- `ground_13_claimed`
- `lender_name`, `mortgage_date`, `lender_notice`, `lender_notice_date` - (not in MSQ)

**Ground 18 (False Statement):**
- `ground_18_claimed`
- `false_statement`, `statement_context`, `true_facts`, `materiality_explanation` - (not in MSQ)

**Current Issue:** Scotland MSQ collects:
- Ground selection (multiselect)
- Single `ground_particulars` textarea (with Ask Heaven support)

Templates expect **highly detailed, ground-specific fields** that are NOT collected. **MAJOR GAP.**

---

### 4.2 Scotland Service Details

| Template Variable | Required | MSQ Question ID(s) | Mapper Source Paths | Transformation | Notes |
|-------------------|----------|-------------------|---------------------|----------------|-------|
| `service_method` | ‚úÖ | `notice_service.service_method` | `notice_service_method`, `service_method` | extractString() | "Recorded delivery", "By hand", "Email (agreed)", "Other" |
| `served_by` | ‚úÖ | `notice_service.served_by` | `notice_served_by`, `served_by` | extractString() | Who will serve the notice |
| `service_name` | ‚úÖ | `service_contact.service_name` | `service_contact.service_name` | extractString() | Tribunal service contact name |
| `service_address_line1` | ‚úÖ | `service_contact.service_address_line1` | `service_contact.service_address_line1` | extractString() | Service address (solicitor/agent) |
| `service_city` | ‚úÖ | `service_contact.service_city` | `service_contact.service_city` | extractString() | Service city |
| `service_postcode` | ‚úÖ | `service_contact.service_postcode` | `service_contact.service_postcode` | extractString() | Service postcode |
| `service_email` | üìù | `service_contact.service_email` | `service_contact.service_email` | extractString() | Service email |
| `service_phone` | üìù | `service_contact.service_phone` | `service_contact.service_phone` | extractString() | Service phone |

---

## Part 5: Computed Fields & Date Calculations

These fields are **generated by code**, not directly from MSQ answers.

### 5.1 Date Computations

| Computed Field | Jurisdiction | Logic | Function/Location | Notes |
|----------------|--------------|-------|-------------------|-------|
| `expiry_date` | England S21 | `service_date` + 2 months OR `fixed_term_end_date` (whichever is later) | Decision engine | **CRITICAL** |
| `expiry_date` | Wales S173 | `service_date` + 2 months (or 6 months if within first 4 years) | Decision engine | **CRITICAL** |
| `earliest_possession_date` | England S8 | `service_date` + 14 days (mandatory) or 60 days (discretionary) | Decision engine | **CRITICAL** |
| `earliest_leaving_date` | Scotland | `service_date` + 28 days (Grounds 1-3) or 84 days (others) | Decision engine | **CRITICAL** |
| `earliest_tribunal_date` | Scotland | Same as `earliest_leaving_date` | Decision engine | **CRITICAL** |
| `notice_period_days` | All | Calculated based on route and grounds | Decision engine | For templates |
| `prohibited_period_violation` | Wales S173 | `service_date` < (`contract_start_date` + 6 months) | Template or decision engine | Wales cannot serve S173 in first 6 months |
| `fixed_term_expired` | All | `fixed_term_end_date` < today | Template helper | Boolean |

**Current State:** Decision engine computes these dates. Mapper must expose them to templates. **Verify all routes compute correctly.**

---

### 5.2 Ground Normalization

| Computed Field | Logic | Function/Location | Notes |
|----------------|-------|-------------------|-------|
| `grounds` (array) | Parse `section8_grounds` (England) or `eviction_grounds` (Scotland) multiselect string ‚Üí structured objects | `mapNoticeOnlyFacts()` ‚Üí `normalizeGrounds()` | Each ground object has: `code`, `title`, `legal_basis`, `particulars`, `mandatory`, `supporting_evidence` |
| `any_mandatory_ground` | Check if any ground in `grounds[]` has `mandatory: true` | Template logic | England Section 8 only |
| `any_discretionary_ground` | Check if any ground in `grounds[]` has `mandatory: false` | Template logic | All grounds |

**Example Ground Object:**
```javascript
{
  code: "8",
  title: "Serious rent arrears",
  legal_basis: "Housing Act 1988, Schedule 2, Ground 8",
  particulars: "At least 2 months' rent is unpaid...",
  mandatory: true,
  supporting_evidence: "Rent ledger, arrears breakdown"
}
```

**Current Issue:** Ground particulars are **NOT collected** in MSQ. Templates expect detailed `particulars` and `supporting_evidence` fields for each ground. **Rely on `ground_particulars` textarea (Scotland) or implement ground-specific questions (England).**

---

### 5.3 Address Concatenation

| Computed Field | Logic | Function/Location | Notes |
|----------------|-------|-------------------|-------|
| `landlord_address` | Concatenate `landlord_address_line1`, `line2`, `city`, `postcode` with `\n` | `mapNoticeOnlyFacts()` | **CRITICAL**: Must render full address with line breaks |
| `property_address` | Concatenate `property_address_line1`, `line2`, `city`, `postcode` with `\n` | `mapNoticeOnlyFacts()` | **CRITICAL**: Must render full address with line breaks |

**Current Issue:** England/Wales MSQs use single `textarea` for addresses. Mapper receives unstructured text. **Cannot parse reliably.** Need structured address fields. **FIX REQUIRED.**

---

### 5.4 Deposit Logic

| Computed Field | Logic | Function/Location | Notes |
|----------------|-------|-------------------|-------|
| `deposit_amount` | If `deposit_taken` = false ‚Üí 0, else use MSQ value | `mapNoticeOnlyFacts()` | Avoid rendering "¬£0 protected in X scheme" |
| `deposit_scheme` | If `deposit_taken` = false ‚Üí null, else use MSQ value | `mapNoticeOnlyFacts()` | Avoid blank scheme names |

---

## Part 6: Critical Mapping Issues (Fix Required)

### Issue 1: England/Wales Addresses Are Unstructured

**Problem:** MSQs use single `textarea` for `property_address` and no explicit field for `landlord_address`.

**Impact:** Mapper cannot reliably parse `property_address_line1`, `city`, `postcode` for templates.

**Fix Required:**
1. Add structured address fields to England/Wales MSQs (like Scotland has)
2. OR implement robust address parser in mapper
3. OR update templates to use single `{{property_address}}` variable

**Recommendation:** Add structured fields (cleanest solution).

---

### Issue 2: Missing Landlord Address Fields (England/Wales)

**Problem:** England/Wales MSQs only collect `landlord_full_name`. No address fields.

**Impact:** `{{landlord_address}}` renders blank in notices. **INVALID NOTICES.**

**Fix Required:** Add `landlord_address` group field to England/Wales MSQs (like Scotland has).

---

### Issue 3: Missing Ground-Specific Particulars (England Section 8)

**Problem:** MSQ only collects ground selection (`section8_grounds_selection`). No follow-up questions for ground-specific details.

**Impact:** Templates expect detailed variables like:
- `arrears_breakdown` (Ground 8)
- `breach_description` (Ground 12)
- `incident_log` (Ground 14)

These fields are **undefined**, rendering blank in notices.

**Fix Required:**
1. Add conditional questions for each ground (massive MSQ expansion)
2. OR rely on single `ground_particulars` textarea (like Scotland)
3. OR simplify templates to use generic ground blocks

**Recommendation:** Implement Scotland-style `ground_particulars` textarea with Ask Heaven support.

---

### Issue 4: Scotland Ground Particulars Too Generic

**Problem:** Templates expect highly detailed, ground-specific variables. MSQ only collects:
- Ground selection (multiselect)
- Single `ground_particulars` textarea

**Impact:** Templates cannot render structured sections like:
- Arrears breakdown table (Ground 1)
- Pre-action evidence details (Ground 1)
- Incident log (Ground 3)
- Sale plans (Ground 5)

**Fix Required:**
1. Simplify Scotland templates to use generic `{{ground_particulars}}` rendering
2. OR add conditional ground-specific questions (like England should have)
3. OR rely on Ask Heaven to generate structured text

**Recommendation:** Simplify templates. Use single particulars block per ground. Rely on Ask Heaven for quality content.

---

### Issue 5: Missing Pre-Action Details (Scotland Ground 1)

**Problem:** MSQ has `pre_action_contact` (yes/no only). Templates expect:
- `pre_action_evidence` (detailed text)
- Dates of contact attempts
- Evidence of debt advice signposting

**Impact:** Pre-action checklist supporting doc cannot render specific evidence.

**Fix Required:** Add follow-up questions when `pre_action_contact` = yes:
- `pre_action_dates` (dates of contact attempts)
- `pre_action_evidence` (textarea: what was done)
- `debt_advice_provided` (yes/no: was tenant signposted to debt advice?)

---

### Issue 6: Computed Dates Not Exposed to Templates

**Problem:** Decision engine computes `expiry_date`, `earliest_possession_date`, etc. Mapper must expose these to templates.

**Impact:** If dates are not passed through, templates render blank dates. **INVALID NOTICES.**

**Fix Required:** Verify decision engine output is merged into `wizard_facts` before mapping, OR decision engine directly populates these fields in wizard state.

---

### Issue 7: Wales Fault-Based Templates Don't Exist

**Problem:** Preview API returns placeholder document for `wales_fault_based` route.

**Impact:** Wales fault-based notices **cannot be generated**.

**Fix Required:** Implement Wales fault-based templates for Sections 157, 159, 161, 162.

---

### Issue 8: rent_frequency and payment_date Missing (England/Wales)

**Problem:** England/Wales MSQs don't collect `rent_frequency` or `payment_date`. Templates reference these.

**Impact:** Templates render blank or default to "monthly" / no payment date.

**Fix Required:** Add `rent_frequency` and `rent_due_day` fields to England/Wales MSQs.

---

## Part 7: Supporting Document Variables

Supporting documents (service instructions, compliance checklist, next steps guide) also require variables.

### Common Supporting Doc Variables

| Variable | Required | Source | Notes |
|----------|----------|--------|-------|
| `jurisdiction` | ‚úÖ | Implicit (from case jurisdiction) | "England", "Wales", "Scotland" |
| `is_wales` | ‚ö†Ô∏è | Boolean flag | For Wales-specific content in shared templates |
| `notice_type` | ‚úÖ | Route name | "Section 8", "Section 21", "Section 173", "Notice to Leave" |
| `service_date` | ‚úÖ | See common fields | Date notice is served |
| `expiry_date` | ‚úÖ | See common fields | Date notice expires |
| `notice_period_days` | ‚úÖ | Computed | Number of days notice |
| `tenant_full_name` | ‚úÖ | See common fields | Tenant name (for addressing instructions) |
| `property_address` | ‚úÖ | See common fields | Property address |

### Compliance Checklist Variables

| Variable | Required | Source | Notes |
|----------|----------|--------|-------|
| `compliance_checklist` | ‚úÖ | Array generated from MSQ answers | Each item: `{ requirement, met, date }` |
| `deposit_protected` | ‚ö†Ô∏è | See common fields | For deposit compliance check |
| `gas_certificate_provided` | ‚ö†Ô∏è | MSQ: `gas_safety_certificate` (England), `safety_checks` (Scotland) | For gas safety check |
| `epc_provided` | ‚ö†Ô∏è | MSQ: `epc_provided` (England S21) | For EPC check |
| `how_to_rent_provided` | ‚ö†Ô∏è | MSQ: `how_to_rent_provided` (England S21) | For How to Rent check |
| `rent_smart_wales_registered` | ‚ö†Ô∏è | MSQ: `rent_smart_wales_registered` (Wales S173) | For Wales registration check |

---

## Part 8: Ask Heaven Integration Points

Ask Heaven enhances **textarea/text/longtext** questions. These questions are eligible for AI-powered suggestions:

### England Section 8

| MSQ Question ID | Variable It Maps To | Ask Heaven Role |
|----------------|---------------------|-----------------|
| (none currently - ground details not collected) | `ground_8_particulars`, `breach_description`, `nuisance_description`, etc. | Should suggest legally accurate ground particulars |

**Current Gap:** No textarea questions for ground details. **Add them.**

---

### Wales

| MSQ Question ID | Variable It Maps To | Ask Heaven Role |
|----------------|---------------------|-----------------|
| `asb_description` | `asb_description` | Suggest factual ASB description for Section 161 |
| `breach_description` | `breach_description` | Suggest breach description for Section 162 |

---

### Scotland

| MSQ Question ID | Variable It Maps To | Ask Heaven Role |
|----------------|---------------------|-----------------|
| `asb_description` | `issues.asb.description`, `issues.asb.incidents` | Suggest factual ASB incidents for Ground 3 |
| `ground_particulars` | `ground_particulars`, `notice_reason` | **CRITICAL**: Draft legally accurate particulars for all selected grounds |

**Scotland's `ground_particulars` is the single most important Ask Heaven integration point.** It must:
- Understand which grounds are selected
- Suggest particulars for each ground
- Reference decision engine context (arrears amount, pre-action status, etc.)
- Provide tribunal-ready, professional language

---

## Part 9: Recommendations for Ultra-Complete Implementation

### Quick Wins (High Impact, Low Effort)

1. **Add landlord address fields** to England/Wales MSQs (like Scotland has) ‚úÖ **CRITICAL**
2. **Add structured property address fields** to England/Wales MSQs ‚úÖ **CRITICAL**
3. **Add `rent_frequency` and `rent_due_day`** to England/Wales MSQs
4. **Expose decision engine computed dates** to mapper (`expiry_date`, `earliest_possession_date`)
5. **Add `landlord_reg_number` field** to Scotland MSQ

### Medium Effort (High Impact)

6. **Implement Wales fault-based templates** (Sections 157, 159, 161, 162)
7. **Add follow-up questions for Scotland Ground 1 pre-action** (dates, evidence)
8. **Simplify Scotland templates** to use generic `{{ground_particulars}}` instead of expecting detailed variables

### Large Effort (Complete Solution)

9. **Add conditional ground-specific questions to England Section 8** MSQ (arrears details, breach details, ASB incidents, etc.) ‚Äî OR rely on single `ground_particulars` textarea
10. **Implement ground particulars normalization** in mapper: Parse freeform text into structured template variables (AI-powered?)
11. **Create jurisdiction-specific supporting docs** (Part D of your task)

---

## Appendix: Mapper Function Reference

**File:** `src/lib/case-facts/normalize.ts`
**Function:** `mapNoticeOnlyFacts(wizard: WizardFacts): Record<string, any>`

**Key Helper Functions:**
- `extractString(value)` - Recursively extracts string from objects
- `getFirstValue(wizard, paths[])` - Try multiple field paths, return first non-null
- `coerceBoolean(value)` - Normalize boolean values

**Logic Flow:**
1. Extract landlord details ‚Üí concatenate address
2. Extract tenant details ‚Üí handle Wales terminology
3. Extract property details ‚Üí concatenate address
4. Extract dates ‚Üí normalize formats
5. Extract rent details ‚Üí derive `rent_period_description`
6. Extract deposit & compliance ‚Üí conditional logic
7. Normalize grounds (Section 8 / Scotland) ‚Üí structured objects
8. Pass through computed fields from decision engine

---

**End of Field Map**

This document is the **single source of truth** for Notice Only field mapping. Any unmapped template variables = **blank fields in notices** = **invalid legal documents**.

All mapping gaps MUST be fixed before Notice Only is production-grade.
