
> landlord-heavenv3@0.1.0 test
> vitest run

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 RUN  v2.1.9 /home/user/landlord-heavenv3

 âœ“ src/lib/documents/__tests__/notice-date-calculator.test.ts (42 tests) 38ms
 âœ“ tests/lib/wizard-path-helpers.test.ts (17 tests) 10ms
 â¯ src/app/api/wizard/generate/__tests__/api-enforcement.test.ts (16 tests | 16 skipped) 8ms
stdout | tests/notice-only-section8-grounds.test.ts > Section 8 Notice Only - Grounds Rendering > maps grounds with statutory_text for Form 3 Section 3
[mapNoticeOnlyFacts] Mapped Notice Only template data
[mapNoticeOnlyFacts] Landlord: John Doe
[mapNoticeOnlyFacts] Landlord address: MISSING
[mapNoticeOnlyFacts] Tenant: Jane Smith
[mapNoticeOnlyFacts] Property address: SET
[mapNoticeOnlyFacts] Property object: SET
[mapNoticeOnlyFacts] Tenant object: SET
[mapNoticeOnlyFacts] Grounds: 2
[mapNoticeOnlyFacts] Dates - notice: 2024-01-01 service: 2024-01-01 earliest: 2024-01-15
[mapNoticeOnlyFacts] Deposit - amount: 0 protected: null scheme: null
[mapNoticeOnlyFacts] === PACK DOCUMENT DATA ===
[mapNoticeOnlyFacts] property.address_line1: 123 Test Street
[mapNoticeOnlyFacts] property.address_town: null
[mapNoticeOnlyFacts] property.postcode: null
[mapNoticeOnlyFacts] tenant.full_name: Jane Smith
[mapNoticeOnlyFacts] tenancy.start_date: null
[mapNoticeOnlyFacts] notice_service_date: 2024-01-01
[mapNoticeOnlyFacts] notice_expiry_date: 2024-01-15
[mapNoticeOnlyFacts] jurisdiction_display: England
[mapNoticeOnlyFacts] ===========================

stdout | tests/notice-only-section8-grounds.test.ts > Section 8 Notice Only - Grounds Rendering > derives arrears totals from shared arrears particulars when canonical fields are missing
[mapNoticeOnlyFacts] Mapped Notice Only template data
[mapNoticeOnlyFacts] Landlord: John Doe
[mapNoticeOnlyFacts] Landlord address: MISSING
[mapNoticeOnlyFacts] Tenant: Jane Smith
[mapNoticeOnlyFacts] Property address: SET
[mapNoticeOnlyFacts] Property object: SET
[mapNoticeOnlyFacts] Tenant object: SET
[mapNoticeOnlyFacts] Grounds: 2
[mapNoticeOnlyFacts] Dates - notice: 2025-12-15 service: 2025-12-15 earliest: 2025-12-29
[mapNoticeOnlyFacts] Deposit - amount: 0 protected: null scheme: null
[mapNoticeOnlyFacts] === PACK DOCUMENT DATA ===
[mapNoticeOnlyFacts] property.address_line1: 123 Test Street
[mapNoticeOnlyFacts] property.address_town: null
[mapNoticeOnlyFacts] property.postcode: null
[mapNoticeOnlyFacts] tenant.full_name: Jane Smith
[mapNoticeOnlyFacts] tenancy.start_date: null
[mapNoticeOnlyFacts] notice_service_date: 2025-12-15
[mapNoticeOnlyFacts] notice_expiry_date: 2025-12-29
[mapNoticeOnlyFacts] jurisdiction_display: England
[mapNoticeOnlyFacts] ===========================

stdout | tests/notice-only-section8-grounds.test.ts > Section 8 Notice Only - Grounds Rendering > maps ground particulars for Section 4 from wizard facts
[mapNoticeOnlyFacts] Mapped Notice Only template data
[mapNoticeOnlyFacts] Landlord: John Doe
[mapNoticeOnlyFacts] Landlord address: MISSING
[mapNoticeOnlyFacts] Tenant: Jane Smith
[mapNoticeOnlyFacts] Property address: SET
[mapNoticeOnlyFacts] Property object: SET
[mapNoticeOnlyFacts] Tenant object: SET
[mapNoticeOnlyFacts] Grounds: 1
[mapNoticeOnlyFacts] Dates - notice: 2024-01-01 service: 2024-01-01 earliest: 2024-01-15
[mapNoticeOnlyFacts] Deposit - amount: 0 protected: null scheme: null
[mapNoticeOnlyFacts] === PACK DOCUMENT DATA ===
[mapNoticeOnlyFacts] property.address_line1: 123 Test Street
[mapNoticeOnlyFacts] property.address_town: null
[mapNoticeOnlyFacts] property.postcode: null
[mapNoticeOnlyFacts] tenant.full_name: Jane Smith
[mapNoticeOnlyFacts] tenancy.start_date: null
[mapNoticeOnlyFacts] notice_service_date: 2024-01-01
[mapNoticeOnlyFacts] notice_expiry_date: 2024-01-15
[mapNoticeOnlyFacts] jurisdiction_display: England
[mapNoticeOnlyFacts] ===========================

stdout | tests/notice-only-section8-grounds.test.ts > Section 8 Notice Only - Grounds Rendering > handles multiple grounds with correct numbering
[mapNoticeOnlyFacts] Mapped Notice Only template data
[mapNoticeOnlyFacts] Landlord: John Doe
[mapNoticeOnlyFacts] Landlord address: MISSING
[mapNoticeOnlyFacts] Tenant: Jane Smith
[mapNoticeOnlyFacts] Property address: SET
[mapNoticeOnlyFacts] Property object: SET
[mapNoticeOnlyFacts] Tenant object: SET
[mapNoticeOnlyFacts] Grounds: 3
[mapNoticeOnlyFacts] Dates - notice: 2024-01-01 service: 2024-01-01 earliest: 2024-01-15
[mapNoticeOnlyFacts] Deposit - amount: 0 protected: null scheme: null
[mapNoticeOnlyFacts] === PACK DOCUMENT DATA ===
[mapNoticeOnlyFacts] property.address_line1: 123 Test Street
[mapNoticeOnlyFacts] property.address_town: null
[mapNoticeOnlyFacts] property.postcode: null
[mapNoticeOnlyFacts] tenant.full_name: Jane Smith
[mapNoticeOnlyFacts] tenancy.start_date: null
[mapNoticeOnlyFacts] notice_service_date: 2024-01-01
[mapNoticeOnlyFacts] notice_expiry_date: 2024-01-15
[mapNoticeOnlyFacts] jurisdiction_display: England
[mapNoticeOnlyFacts] ===========================

stdout | tests/notice-only-section8-grounds.test.ts > Section 8 Notice Only - Grounds Rendering > calculates arrears properly for Ground 8 mandatory threshold
[mapNoticeOnlyFacts] Mapped Notice Only template data
[mapNoticeOnlyFacts] Landlord: John Doe
[mapNoticeOnlyFacts] Landlord address: MISSING
[mapNoticeOnlyFacts] Tenant: Jane Smith
[mapNoticeOnlyFacts] Property address: SET
[mapNoticeOnlyFacts] Property object: SET
[mapNoticeOnlyFacts] Tenant object: SET
[mapNoticeOnlyFacts] Grounds: 1
[mapNoticeOnlyFacts] Dates - notice: 2024-01-01 service: 2024-01-01 earliest: 2024-01-15
[mapNoticeOnlyFacts] Deposit - amount: 0 protected: null scheme: null
[mapNoticeOnlyFacts] === PACK DOCUMENT DATA ===
[mapNoticeOnlyFacts] property.address_line1: 123 Test Street
[mapNoticeOnlyFacts] property.address_town: null
[mapNoticeOnlyFacts] property.postcode: null
[mapNoticeOnlyFacts] tenant.full_name: Jane Smith
[mapNoticeOnlyFacts] tenancy.start_date: null
[mapNoticeOnlyFacts] notice_service_date: 2024-01-01
[mapNoticeOnlyFacts] notice_expiry_date: 2024-01-15
[mapNoticeOnlyFacts] jurisdiction_display: England
[mapNoticeOnlyFacts] ===========================

stdout | tests/notice-only-section8-grounds.test.ts > Section 8 Notice Only - Grounds Rendering > sets ground_numbers and ground_descriptions for checklist
[mapNoticeOnlyFacts] Mapped Notice Only template data
[mapNoticeOnlyFacts] Landlord: John Doe
[mapNoticeOnlyFacts] Landlord address: MISSING
[mapNoticeOnlyFacts] Tenant: Jane Smith
[mapNoticeOnlyFacts] Property address: SET
[mapNoticeOnlyFacts] Property object: SET
[mapNoticeOnlyFacts] Tenant object: SET
[mapNoticeOnlyFacts] Grounds: 2
[mapNoticeOnlyFacts] Dates - notice: 2024-01-01 service: 2024-01-01 earliest: 2024-01-15
[mapNoticeOnlyFacts] Deposit - amount: 0 protected: null scheme: null
[mapNoticeOnlyFacts] === PACK DOCUMENT DATA ===
[mapNoticeOnlyFacts] property.address_line1: 123 Test Street
[mapNoticeOnlyFacts] property.address_town: null
[mapNoticeOnlyFacts] property.postcode: null
[mapNoticeOnlyFacts] tenant.full_name: Jane Smith
[mapNoticeOnlyFacts] tenancy.start_date: null
[mapNoticeOnlyFacts] notice_service_date: 2024-01-01
[mapNoticeOnlyFacts] notice_expiry_date: 2024-01-15
[mapNoticeOnlyFacts] jurisdiction_display: England
[mapNoticeOnlyFacts] ===========================

stdout | tests/notice-only-section8-grounds.test.ts > Section 8 Notice Only - Grounds Rendering > handles unknown grounds gracefully
[mapNoticeOnlyFacts] Mapped Notice Only template data
[mapNoticeOnlyFacts] Landlord: John Doe
[mapNoticeOnlyFacts] Landlord address: MISSING
[mapNoticeOnlyFacts] Tenant: Jane Smith
[mapNoticeOnlyFacts] Property address: SET
[mapNoticeOnlyFacts] Property object: SET
[mapNoticeOnlyFacts] Tenant object: SET
[mapNoticeOnlyFacts] Grounds: 1
[mapNoticeOnlyFacts] Dates - notice: 2024-01-01 service: 2024-01-01 earliest: 2024-01-15
[mapNoticeOnlyFacts] Deposit - amount: 0 protected: null scheme: null
[mapNoticeOnlyFacts] === PACK DOCUMENT DATA ===
[mapNoticeOnlyFacts] property.address_line1: 123 Test Street
[mapNoticeOnlyFacts] property.address_town: null
[mapNoticeOnlyFacts] property.postcode: null
[mapNoticeOnlyFacts] tenant.full_name: Jane Smith
[mapNoticeOnlyFacts] tenancy.start_date: null
[mapNoticeOnlyFacts] notice_service_date: 2024-01-01
[mapNoticeOnlyFacts] notice_expiry_date: 2024-01-15
[mapNoticeOnlyFacts] jurisdiction_display: England
[mapNoticeOnlyFacts] ===========================

stderr | tests/notice-only-section8-grounds.test.ts > Section 8 Notice Only - Grounds Rendering > handles unknown grounds gracefully
[buildGroundsArray] Unknown ground: Ground 99 - Unknown ground

stdout | tests/notice-only-section8-grounds.test.ts > Section 8 Notice Only - Grounds Rendering > includes all mandatory ground metadata
[mapNoticeOnlyFacts] Mapped Notice Only template data
[mapNoticeOnlyFacts] Landlord: John Doe
[mapNoticeOnlyFacts] Landlord address: MISSING
[mapNoticeOnlyFacts] Tenant: Jane Smith
[mapNoticeOnlyFacts] Property address: SET
[mapNoticeOnlyFacts] Property object: SET
[mapNoticeOnlyFacts] Tenant object: SET
[mapNoticeOnlyFacts] Grounds: 2
[mapNoticeOnlyFacts] Dates - notice: 2024-01-01 service: 2024-01-01 earliest: 2024-01-15
[mapNoticeOnlyFacts] Deposit - amount: 0 protected: null scheme: null
[mapNoticeOnlyFacts] === PACK DOCUMENT DATA ===
[mapNoticeOnlyFacts] property.address_line1: 123 Test Street
[mapNoticeOnlyFacts] property.address_town: null
[mapNoticeOnlyFacts] property.postcode: null
[mapNoticeOnlyFacts] tenant.full_name: Jane Smith
[mapNoticeOnlyFacts] tenancy.start_date: null
[mapNoticeOnlyFacts] notice_service_date: 2024-01-01
[mapNoticeOnlyFacts] notice_expiry_date: 2024-01-15
[mapNoticeOnlyFacts] jurisdiction_display: England
[mapNoticeOnlyFacts] ===========================

stdout | tests/notice-only-section8-grounds.test.ts > Section 8 Notice Only - Grounds Rendering > normalizes internal ground ids and maps structured particulars
[mapNoticeOnlyFacts] Mapped Notice Only template data
[mapNoticeOnlyFacts] Landlord: Landlord
[mapNoticeOnlyFacts] Landlord address: MISSING
[mapNoticeOnlyFacts] Tenant: Tenant
[mapNoticeOnlyFacts] Property address: SET
[mapNoticeOnlyFacts] Property object: SET
[mapNoticeOnlyFacts] Tenant object: SET
[mapNoticeOnlyFacts] Grounds: 2
[mapNoticeOnlyFacts] Dates - notice: 2024-02-01 service: 2024-02-01 earliest: 2024-02-15
[mapNoticeOnlyFacts] Deposit - amount: 0 protected: null scheme: null
[mapNoticeOnlyFacts] === PACK DOCUMENT DATA ===
[mapNoticeOnlyFacts] property.address_line1: 123 Main Street
[mapNoticeOnlyFacts] property.address_town: null
[mapNoticeOnlyFacts] property.postcode: null
[mapNoticeOnlyFacts] tenant.full_name: Tenant
[mapNoticeOnlyFacts] tenancy.start_date: null
[mapNoticeOnlyFacts] notice_service_date: 2024-02-01
[mapNoticeOnlyFacts] notice_expiry_date: 2024-02-15
[mapNoticeOnlyFacts] jurisdiction_display: England
[mapNoticeOnlyFacts] ===========================

stdout | tests/notice-only-section8-grounds.test.ts > Section 8 Notice Only - Preview Route Integration > does not leak internal ground keys like ground_8
[mapNoticeOnlyFacts] Mapped Notice Only template data
[mapNoticeOnlyFacts] Landlord: John Doe
[mapNoticeOnlyFacts] Landlord address: MISSING
[mapNoticeOnlyFacts] Tenant: Jane Smith
[mapNoticeOnlyFacts] Property address: SET
[mapNoticeOnlyFacts] Property object: SET
[mapNoticeOnlyFacts] Tenant object: SET
[mapNoticeOnlyFacts] Grounds: 1
[mapNoticeOnlyFacts] Dates - notice: 2024-01-01 service: 2024-01-01 earliest: 2024-01-15
[mapNoticeOnlyFacts] Deposit - amount: 0 protected: null scheme: null
[mapNoticeOnlyFacts] === PACK DOCUMENT DATA ===
[mapNoticeOnlyFacts] property.address_line1: 123 Test Street
[mapNoticeOnlyFacts] property.address_town: null
[mapNoticeOnlyFacts] property.postcode: null
[mapNoticeOnlyFacts] tenant.full_name: Jane Smith
[mapNoticeOnlyFacts] tenancy.start_date: null
[mapNoticeOnlyFacts] notice_service_date: 2024-01-01
[mapNoticeOnlyFacts] notice_expiry_date: 2024-01-15
[mapNoticeOnlyFacts] jurisdiction_display: England
[mapNoticeOnlyFacts] ===========================

stdout | tests/notice-only-section8-grounds.test.ts > Section 8 Notice Only - Preview Route Integration > assembles preview-friendly strings for grounds 8 and 11 with particulars
[mapNoticeOnlyFacts] Mapped Notice Only template data
[mapNoticeOnlyFacts] Landlord: John Doe
[mapNoticeOnlyFacts] Landlord address: MISSING
[mapNoticeOnlyFacts] Tenant: Jane Smith
[mapNoticeOnlyFacts] Property address: SET
[mapNoticeOnlyFacts] Property object: SET
[mapNoticeOnlyFacts] Tenant object: SET
[mapNoticeOnlyFacts] Grounds: 2
[mapNoticeOnlyFacts] Dates - notice: 2024-03-01 service: 2024-03-01 earliest: 2024-03-15
[mapNoticeOnlyFacts] Deposit - amount: 0 protected: null scheme: null
[mapNoticeOnlyFacts] === PACK DOCUMENT DATA ===
[mapNoticeOnlyFacts] property.address_line1: 123 Test Street
[mapNoticeOnlyFacts] property.address_town: null
[mapNoticeOnlyFacts] property.postcode: null
[mapNoticeOnlyFacts] tenant.full_name: Jane Smith
[mapNoticeOnlyFacts] tenancy.start_date: null
[mapNoticeOnlyFacts] notice_service_date: 2024-03-01
[mapNoticeOnlyFacts] notice_expiry_date: 2024-03-15
[mapNoticeOnlyFacts] jurisdiction_display: England
[mapNoticeOnlyFacts] ===========================

stdout | tests/lib/scotland/prt-wizard-mapper.test.ts > PRT Wizard Mapper - Scotland > should map basic PRT data correctly
[Normalize] Property address concatenated: 1 parts
[Normalize] Tenant name: Jane Doe
[Normalize] Landlord name: John Smith
[Normalize] Case facts normalization complete

stderr | tests/lib/scotland/prt-wizard-mapper.test.ts > PRT Wizard Mapper - Scotland > should map basic PRT data correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/lib/scotland/prt-wizard-mapper.test.ts > PRT Wizard Mapper - Scotland > should handle multiple tenants correctly
[Normalize] Property address concatenated: 1 parts
[Normalize] Tenant name: Jane Doe
[Normalize] Landlord name: John Smith
[Normalize] Case facts normalization complete

stderr | tests/lib/scotland/prt-wizard-mapper.test.ts > PRT Wizard Mapper - Scotland > should handle multiple tenants correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/lib/scotland/prt-wizard-mapper.test.ts > PRT Wizard Mapper - Scotland > should map Premium Enhanced Features correctly
[Normalize] Property address concatenated: 1 parts
[Normalize] Tenant name: Jane Doe
[Normalize] Landlord name: John Smith
[Normalize] Case facts normalization complete

stderr | tests/lib/scotland/prt-wizard-mapper.test.ts > PRT Wizard Mapper - Scotland > should map Premium Enhanced Features correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/lib/scotland/prt-wizard-mapper.test.ts > PRT Wizard Mapper - Scotland > should handle address building from components
[Normalize] Property address concatenated: 3 parts
[Normalize] Tenant name: Jane Doe
[Normalize] Landlord name: John Smith
[Normalize] Case facts normalization complete

stderr | tests/lib/scotland/prt-wizard-mapper.test.ts > PRT Wizard Mapper - Scotland > should handle address building from components
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/lib/scotland/prt-wizard-mapper.test.ts > PRT Wizard Mapper - Scotland > should normalize deposit scheme names
[Normalize] Property address concatenated: 1 parts
[Normalize] Tenant name: Jane Doe
[Normalize] Landlord name: John Smith
[Normalize] Case facts normalization complete
[Normalize] Property address concatenated: 1 parts
[Normalize] Tenant name: Jane Doe
[Normalize] Landlord name: John Smith
[Normalize] Case facts normalization complete
[Normalize] Property address concatenated: 1 parts
[Normalize] Tenant name: Jane Doe
[Normalize] Landlord name: John Smith
[Normalize] Case facts normalization complete

stderr | tests/lib/scotland/prt-wizard-mapper.test.ts > PRT Wizard Mapper - Scotland > should normalize deposit scheme names
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/lib/scotland/prt-wizard-mapper.test.ts > PRT Wizard Mapper - Scotland > should handle HMO properties correctly
[Normalize] Property address concatenated: 1 parts
[Normalize] Tenant name: Jane Doe
[Normalize] Landlord name: John Smith
[Normalize] Case facts normalization complete

stderr | tests/lib/scotland/prt-wizard-mapper.test.ts > PRT Wizard Mapper - Scotland > should handle HMO properties correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/lib/scotland/prt-wizard-mapper.test.ts > PRT Wizard Mapper - Scotland > should handle product tier mapping
[Normalize] Property address concatenated: 1 parts
[Normalize] Tenant name: Jane Doe
[Normalize] Landlord name: John Smith
[Normalize] Case facts normalization complete
[Normalize] Property address concatenated: 1 parts
[Normalize] Tenant name: Jane Doe
[Normalize] Landlord name: John Smith
[Normalize] Case facts normalization complete

stderr | tests/lib/scotland/prt-wizard-mapper.test.ts > PRT Wizard Mapper - Scotland > should handle product tier mapping
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/lib/northern-ireland/private-tenancy-wizard-mapper.test.ts > Private Tenancy Wizard Mapper - Northern Ireland > should map basic private tenancy data correctly
[Normalize] Property address concatenated: 1 parts
[Normalize] Tenant name: Patrick Murphy
[Normalize] Landlord name: Mary O'Brien
[Normalize] Case facts normalization complete

stderr | tests/lib/northern-ireland/private-tenancy-wizard-mapper.test.ts > Private Tenancy Wizard Mapper - Northern Ireland > should map basic private tenancy data correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/lib/northern-ireland/private-tenancy-wizard-mapper.test.ts > Private Tenancy Wizard Mapper - Northern Ireland > should handle multiple tenants correctly
[Normalize] Property address concatenated: 1 parts
[Normalize] Tenant name: Patrick Murphy
[Normalize] Landlord name: Mary O'Brien
[Normalize] Case facts normalization complete

stderr | tests/lib/northern-ireland/private-tenancy-wizard-mapper.test.ts > Private Tenancy Wizard Mapper - Northern Ireland > should handle multiple tenants correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/lib/northern-ireland/private-tenancy-wizard-mapper.test.ts > Private Tenancy Wizard Mapper - Northern Ireland > should handle agent details correctly
[Normalize] Property address concatenated: 1 parts
[Normalize] Tenant name: Patrick Murphy
[Normalize] Landlord name: Mary O'Brien
[Normalize] Case facts normalization complete

stderr | tests/lib/northern-ireland/private-tenancy-wizard-mapper.test.ts > Private Tenancy Wizard Mapper - Northern Ireland > should handle agent details correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/lib/northern-ireland/private-tenancy-wizard-mapper.test.ts > Private Tenancy Wizard Mapper - Northern Ireland > should map Premium Enhanced Features correctly
[Normalize] Property address concatenated: 1 parts
[Normalize] Tenant name: Patrick Murphy
[Normalize] Landlord name: Mary O'Brien
[Normalize] Case facts normalization complete

stderr | tests/lib/northern-ireland/private-tenancy-wizard-mapper.test.ts > Private Tenancy Wizard Mapper - Northern Ireland > should map Premium Enhanced Features correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/lib/northern-ireland/private-tenancy-wizard-mapper.test.ts > Private Tenancy Wizard Mapper - Northern Ireland > should handle address building from components
[Normalize] Property address concatenated: 3 parts
[Normalize] Tenant name: Patrick Murphy
[Normalize] Landlord name: Mary O'Brien
[Normalize] Case facts normalization complete

stderr | tests/lib/northern-ireland/private-tenancy-wizard-mapper.test.ts > Private Tenancy Wizard Mapper - Northern Ireland > should handle address building from components
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/lib/northern-ireland/private-tenancy-wizard-mapper.test.ts > Private Tenancy Wizard Mapper - Northern Ireland > should normalize deposit scheme names
[Normalize] Property address concatenated: 1 parts
[Normalize] Tenant name: Patrick Murphy
[Normalize] Landlord name: Mary O'Brien
[Normalize] Case facts normalization complete
[Normalize] Property address concatenated: 1 parts
[Normalize] Tenant name: Patrick Murphy
[Normalize] Landlord name: Mary O'Brien
[Normalize] Case facts normalization complete

stderr | tests/lib/northern-ireland/private-tenancy-wizard-mapper.test.ts > Private Tenancy Wizard Mapper - Northern Ireland > should normalize deposit scheme names
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/lib/northern-ireland/private-tenancy-wizard-mapper.test.ts > Private Tenancy Wizard Mapper - Northern Ireland > should handle domestic rates registration deadline (NI specific)
[Normalize] Property address concatenated: 1 parts
[Normalize] Tenant name: Patrick Murphy
[Normalize] Landlord name: Mary O'Brien
[Normalize] Case facts normalization complete

stderr | tests/lib/northern-ireland/private-tenancy-wizard-mapper.test.ts > Private Tenancy Wizard Mapper - Northern Ireland > should handle domestic rates registration deadline (NI specific)
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/lib/northern-ireland/private-tenancy-wizard-mapper.test.ts > Private Tenancy Wizard Mapper - Northern Ireland > should handle HMO properties correctly
[Normalize] Property address concatenated: 1 parts
[Normalize] Tenant name: Patrick Murphy
[Normalize] Landlord name: Mary O'Brien
[Normalize] Case facts normalization complete

stderr | tests/lib/northern-ireland/private-tenancy-wizard-mapper.test.ts > Private Tenancy Wizard Mapper - Northern Ireland > should handle HMO properties correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/lib/northern-ireland/private-tenancy-wizard-mapper.test.ts > Private Tenancy Wizard Mapper - Northern Ireland > should handle product tier mapping
[Normalize] Property address concatenated: 1 parts
[Normalize] Tenant name: Patrick Murphy
[Normalize] Landlord name: Mary O'Brien
[Normalize] Case facts normalization complete
[Normalize] Property address concatenated: 1 parts
[Normalize] Tenant name: Patrick Murphy
[Normalize] Landlord name: Mary O'Brien
[Normalize] Case facts normalization complete

stderr | tests/lib/northern-ireland/private-tenancy-wizard-mapper.test.ts > Private Tenancy Wizard Mapper - Northern Ireland > should handle product tier mapping
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/lib/northern-ireland/private-tenancy-wizard-mapper.test.ts > Private Tenancy Wizard Mapper - Northern Ireland > should handle missing optional fields gracefully
[Normalize] Property address concatenated: 1 parts
[Normalize] Tenant name: Patrick Murphy
[Normalize] Landlord name: Mary O'Brien
[Normalize] Case facts normalization complete

stderr | tests/lib/northern-ireland/private-tenancy-wizard-mapper.test.ts > Private Tenancy Wizard Mapper - Northern Ireland > should handle missing optional fields gracefully
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

 âœ“ tests/lib/northern-ireland/private-tenancy-wizard-mapper.test.ts (10 tests) 28ms
 âœ“ tests/notice-only-section8-grounds.test.ts (12 tests) 21ms
 âœ“ tests/lib/scotland/prt-wizard-mapper.test.ts (7 tests) 24ms
stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Property Mapping > should map property address fields correctly
[Normalize] Property address concatenated: 4 parts
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Property Mapping > should map property address fields correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Property Mapping > should map property country from property_country field
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Property Mapping > should map property country from property_country field
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Property Mapping > should fallback to jurisdiction field for country
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Property Mapping > should fallback to jurisdiction field for country
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Property Mapping > should prefer property_country over jurisdiction
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Property Mapping > should prefer property_country over jurisdiction
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Property Mapping > should map HMO status
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Property Mapping > should map HMO status
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Property Mapping > should default missing property fields to null
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Property Mapping > should default missing property fields to null
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Tenancy Mapping > should map basic tenancy fields correctly
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Tenancy Mapping > should map basic tenancy fields correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Tenancy Mapping > should map fixed term fields correctly
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Tenancy Mapping > should map fixed term fields correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Tenancy Mapping > should map deposit protection fields correctly
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Tenancy Mapping > should map deposit protection fields correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Tenancy Mapping > should map rent due day correctly
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Tenancy Mapping > should map rent due day correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Tenancy Mapping > should default tenancy_type to "unknown" when missing
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Tenancy Mapping > should default tenancy_type to "unknown" when missing
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Tenancy Mapping > should default missing tenancy fields to null
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Tenancy Mapping > should default missing tenancy fields to null
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Landlord > should map landlord details with underscore notation
[Normalize] Landlord name: John Smith
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Landlord > should map landlord details with underscore notation
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Landlord > should map landlord details with dot notation fallback
[Normalize] Landlord name: Jane Doe
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Landlord > should map landlord details with dot notation fallback
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Landlord > should prefer underscore notation over dot notation for landlord
[Normalize] Landlord name: John Smith
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Landlord > should prefer underscore notation over dot notation for landlord
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Landlord > should default missing landlord fields to null
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Landlord > should default missing landlord fields to null
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Tenants > should map single tenant correctly
[Normalize] Tenant name: Alice Johnson
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Tenants > should map single tenant correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Tenants > should support alternate tenant name field
[Normalize] Tenant name: Bob Wilson
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Tenants > should support alternate tenant name field
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Tenants > should prefer full_name over name for tenants
[Normalize] Tenant name: Alice Johnson
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Tenants > should prefer full_name over name for tenants
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Tenants > should support alternate phone field name
[Normalize] Tenant name: Charlie Brown
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Tenants > should support alternate phone field name
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Tenants > should map multiple tenants correctly
[Normalize] Tenant name: Alice Johnson
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Tenants > should map multiple tenants correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Tenants > should handle non-sequential tenant indices correctly
[Normalize] Tenant name: Alice Johnson
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Tenants > should handle non-sequential tenant indices correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Tenants > should return empty array when no tenants present
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Tenants > should return empty array when no tenants present
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Tenants > should handle partial tenant data gracefully
[Normalize] Tenant name: Alice Johnson
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Tenants > should handle partial tenant data gracefully
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Agent and Solicitor > should map agent details correctly
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Agent and Solicitor > should map agent details correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Agent and Solicitor > should map solicitor details correctly
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Agent and Solicitor > should map solicitor details correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Agent and Solicitor > should default missing agent and solicitor fields to null
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Parties Mapping - Agent and Solicitor > should default missing agent and solicitor fields to null
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Meta Mapping > should map product metadata correctly
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Meta Mapping > should map product metadata correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Meta Mapping > should handle missing __meta gracefully
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Meta Mapping > should handle missing __meta gracefully
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Meta Mapping > should handle partial __meta fields
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Meta Mapping > should handle partial __meta fields
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Full AST Flow Integration > should map complete AST England/Wales case correctly
[Normalize] Property address concatenated: 4 parts
[Normalize] Tenant name: Alice Johnson
[Normalize] Landlord name: John Smith
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Full AST Flow Integration > should map complete AST England/Wales case correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Full AST Flow Integration > should map premium tier AST with multiple tenants
[Normalize] Property address concatenated: 2 parts
[Normalize] Tenant name: Alice Johnson
[Normalize] Landlord name: Sarah Williams
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Full AST Flow Integration > should map premium tier AST with multiple tenants
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Edge Cases > should handle completely empty wizard facts
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Edge Cases > should handle completely empty wizard facts
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Edge Cases > should handle null values in wizard facts
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Edge Cases > should handle null values in wizard facts
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Edge Cases > should handle undefined values in wizard facts
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Edge Cases > should handle undefined values in wizard facts
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Edge Cases > should not explode with unexpected field types
[Normalize] Property address concatenated: 1 parts
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Edge Cases > should not explode with unexpected field types
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Edge Cases > should handle special characters in string fields
[Normalize] Property address concatenated: 1 parts
[Normalize] Tenant name: FranÃ§ois MÃ¼ller-Schmidt
[Normalize] Landlord name: JosÃ© GarcÃ­a-LÃ³pez
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Edge Cases > should handle special characters in string fields
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Edge Cases > should handle zero values correctly
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Edge Cases > should handle zero values correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Edge Cases > should handle boolean false values correctly
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Edge Cases > should handle boolean false values correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Issues Mapping > should map rent arrears fields
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Issues Mapping > should map rent arrears fields
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Issues Mapping > should map ASB fields
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Issues Mapping > should map ASB fields
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Issues Mapping > should map other breaches fields
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Issues Mapping > should map other breaches fields
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Notice Mapping > should map notice fields correctly
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Notice Mapping > should map notice fields correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Notice Mapping > should handle alternate expiry_date field name
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Notice Mapping > should handle alternate expiry_date field name
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Court Mapping > should map court claim fields correctly
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Court Mapping > should map court claim fields correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Court Mapping > should map court form requirements correctly
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Court Mapping > should map court form requirements correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Evidence Mapping > should map evidence upload flags correctly
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Evidence Mapping > should map evidence upload flags correctly
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Evidence Mapping > should default evidence flags to false when missing
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Evidence Mapping > should default evidence flags to false when missing
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Service Contact Mapping > should map service contact with dot notation
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Service Contact Mapping > should map service contact with dot notation
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Service Contact Mapping > should fallback to underscore notation for service contact
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Service Contact Mapping > should fallback to underscore notation for service contact
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Money Claim Mapping > should map solicitor costs from wizard
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Money Claim Mapping > should map solicitor costs from wizard
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Money Claim Mapping > should default solicitor costs to null when missing
[Normalize] Case facts normalization complete

stderr | src/lib/case-facts/normalize.test.ts > wizardFactsToCaseFacts > Money Claim Mapping > should default solicitor costs to null when missing
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

 âœ“ src/lib/case-facts/normalize.test.ts (52 tests) 70ms
 â¯ tests/api/wizard-gating.test.ts (28 tests | 8 failed) 131ms
   Ã— Wizard Gating - Eviction (England) > Gate 1: Ground 8 Threshold > should block Ground 8 when arrears < 2 months 29ms
     â†’ expected [ { â€¦(5) }, { â€¦(5) }, { â€¦(5) }, â€¦(10) ] to have a length of 1 but got 13
   Ã— Wizard Gating - Eviction (England) > Gate 1: Ground 8 Threshold > should allow Ground 8 when arrears >= 2 months 5ms
     â†’ expected [ { â€¦(5) }, { â€¦(5) }, { â€¦(5) }, â€¦(9) ] to have a length of +0 but got 12
   Ã— Wizard Gating - Eviction (England) > Gate 1: Ground 8 Threshold > should warn when arrears are borderline (2-3 months) 4ms
     â†’ expected [ { â€¦(5) }, { â€¦(5) }, { â€¦(5) }, â€¦(9) ] to have a length of +0 but got 12
   Ã— Wizard Gating - Eviction (England) > Gate 1: Ground 8 Threshold > should allow weekly rent with sufficient arrears 4ms
     â†’ expected [ { â€¦(5) }, { â€¦(5) }, { â€¦(5) }, â€¦(9) ] to have a length of +0 but got 12
   Ã— Wizard Gating - Eviction (England) > Gate 3: Section 21 Route Blockers > should block Section 21 when deposit is not protected 5ms
     â†’ expected false to be true // Object.is equality
   Ã— Wizard Gating - Eviction (England) > Gate 3: Section 21 Route Blockers > should block Section 21 when gas cert not provided 5ms
     â†’ expected false to be true // Object.is equality
   Ã— Wizard Gating - Eviction (England) > Gate 3: Section 21 Route Blockers > should allow Section 21 when all compliance requirements met 3ms
     â†’ expected [ { â€¦(5) }, { â€¦(5) }, { â€¦(5) } ] to have a length of +0 but got 3
   Ã— Wizard Gating - Eviction (England) > Gate 4: Ground Particulars Completeness > should block when ground particulars are missing for selected grounds 5ms
     â†’ expected 'Ground 8 is missing required fact: reâ€¦' to contain 'Ground(s): 8, 11'
 âœ“ tests/ai/ask-heaven-advanced.test.ts (14 tests) 10ms
 âœ“ tests/api/wizard-mqs-tenancy-agreement.test.ts (18 tests) 163ms
11:32:26 PM [vite] warning: This case clause will never be evaluated because it duplicates an earlier case clause
630|      case 'wales':
631|      case 'england-wales': // Legacy compatibility
632|      case 'england':
   |           ^
633|      case 'wales':
634|        return `CONTEXT: England & Wales eviction law. Use Section 8/Section 21 terminology where appropriate.`;

  Plugin: vite:esbuild
  File: /home/user/landlord-heavenv3/src/lib/case-intel/narrative.ts
11:32:26 PM [vite] warning: This case clause will never be evaluated because it duplicates an earlier case clause
631|      case 'england-wales': // Legacy compatibility
632|      case 'england':
633|      case 'wales':
   |           ^
634|        return `CONTEXT: England & Wales eviction law. Use Section 8/Section 21 terminology where appropriate.`;
635|  

  Plugin: vite:esbuild
  File: /home/user/landlord-heavenv3/src/lib/case-intel/narrative.ts
 â¯ tests/api/wizard-checkpoint.test.ts (10 tests | 10 failed) 42ms
   Ã— Wizard API Checkpoint > accepts case_id and returns structured response 19ms
     â†’ expected 422 to be 200 // Object.is equality
   Ã— Wizard API Checkpoint > persists recommended_route to cases table 6ms
     â†’ expected "spy" to be called with arguments: [ { recommended_route: 'section_8' } ]

Received: 



Number of calls: 0

   Ã— Wizard API Checkpoint > returns structured error for missing case_id 2ms
     â†’ expected 422 to be 400 // Object.is equality
   Ã— Wizard API Checkpoint > returns structured error for case not found 2ms
     â†’ expected 422 to be 404 // Object.is equality
   Ã— Wizard API Checkpoint > returns early for money_claim case_type 2ms
     â†’ expected 422 to be 200 // Object.is equality
   Ã— Wizard API Checkpoint > blocks NI eviction cases with structured error 2ms
     â†’ expected 422 to be 400 // Object.is equality
   Ã— Wizard API Checkpoint > accepts canonical jurisdiction "england" and normalizes for decision engine 1ms
     â†’ expected 422 to be 200 // Object.is equality
   Ã— Wizard API Checkpoint > accepts canonical jurisdiction "wales" and normalizes for decision engine 1ms
     â†’ expected 422 to be 200 // Object.is equality
   Ã— Wizard API Checkpoint > still accepts legacy jurisdiction "england-wales" for backwards compatibility 2ms
     â†’ expected 422 to be 200 // Object.is equality
   Ã— Wizard API Checkpoint > rejects invalid jurisdiction values 4ms
     â†’ expected 'Invalid request' to be 'Invalid jurisdiction' // Object.is equality
11:32:27 PM [vite] warning: This case clause will never be evaluated because it duplicates an earlier case clause
142|      case 'wales':
143|      case 'england-wales': // Legacy compatibility
144|      case 'england':
   |           ^
145|      case 'wales':
146|        return 'Chronology of Events';

  Plugin: vite:esbuild
  File: /home/user/landlord-heavenv3/src/lib/bundles/evidence-index.ts
11:32:27 PM [vite] warning: This case clause will never be evaluated because it duplicates an earlier case clause
143|      case 'england-wales': // Legacy compatibility
144|      case 'england':
145|      case 'wales':
   |           ^
146|        return 'Chronology of Events';
147|  

  Plugin: vite:esbuild
  File: /home/user/landlord-heavenv3/src/lib/bundles/evidence-index.ts
 â¯ tests/bundles/bundle-generator.test.ts (12 tests | 1 failed) 66ms
   Ã— generateCourtBundle (England & Wales) > should generate bundle for minimal case 48ms
     â†’ expected 'england-wales' to be 'england' // Object.is equality
 âœ“ tests/lib/wizard/dependency-matching.test.ts (7 tests) 22ms
stdout | src/server/config/__tests__/wales-rule-selection.test.ts > Wales Section 173 Rule Selection (UTC Date Parsing) > selects 2-month rule for historic date (2017)
[Wales Config] Service date 2017-06-01 â†’ Using rule effective 2016-12-01 (2 months)

stdout | src/server/config/__tests__/wales-rule-selection.test.ts > Wales Section 173 Rule Selection (UTC Date Parsing) > selects 6-month rule for current date (2023)
[Wales Config] Service date 2023-06-01 â†’ Using rule effective 2022-12-01 (6 months)

stdout | src/server/config/__tests__/wales-rule-selection.test.ts > Wales Section 173 Rule Selection (UTC Date Parsing) > selects 6-month rule for date on rule effective date (2022-12-01)
[Wales Config] Service date 2022-12-01 â†’ Using rule effective 2022-12-01 (6 months)

stdout | src/server/config/__tests__/wales-rule-selection.test.ts > Wales Section 173 Rule Selection (UTC Date Parsing) > selects 2-month rule for date just before new rule (2022-11-30)
[Wales Config] Service date 2022-11-30 â†’ Using rule effective 2016-12-01 (2 months)

stdout | src/server/config/__tests__/wales-rule-selection.test.ts > Wales Section 173 Rule Selection (UTC Date Parsing) > selects latest applicable rule when multiple match
[Wales Config] Service date 2023-01-01 â†’ Using rule effective 2022-12-01 (6 months)

stdout | src/server/config/__tests__/wales-rule-selection.test.ts > Wales Section 173 Rule Selection (UTC Date Parsing) > uses current date when no service date provided
[Wales Config] Service date current â†’ Using rule effective 2022-12-01 (6 months)

stdout | src/server/config/__tests__/wales-rule-selection.test.ts > Wales Section 173 Rule Selection (UTC Date Parsing) > includes prohibited period in result
[Wales Config] Service date 2023-01-01 â†’ Using rule effective 2022-12-01 (6 months)

stdout | src/server/config/__tests__/wales-rule-selection.test.ts > Wales Config Structure > Section 173 rules are chronologically ordered
[Wales Config] Service date 2017-01-01 â†’ Using rule effective 2016-12-01 (2 months)
[Wales Config] Service date 2023-01-01 â†’ Using rule effective 2022-12-01 (6 months)

stderr | tests/api/wizard-mqs-eviction.test.ts > MQS eviction flow (England & Wales) > enhanceAnswer is called for MQS questions with suggestion_prompt
[WIZARD_GATING] Blocking progression: {
  case_id: 'case-3',
  question_id: 'custom_question',
  blocking: [
    'DEPOSIT_FIELD_REQUIRED',
    'DEPOSIT_FIELD_REQUIRED',
    'REQUIRED_IF_EVALUATION_FAILED',
    'REQUIRED_IF_EVALUATION_FAILED',
    'REQUIRED_IF_EVALUATION_FAILED'
  ]
}

 â¯ tests/api/wizard-mqs-eviction.test.ts (5 tests | 1 failed) 59ms
   Ã— MQS eviction flow (England & Wales) > enhanceAnswer is called for MQS questions with suggestion_prompt 23ms
     â†’ expected 422 to be 200 // Object.is equality
 âœ“ src/server/config/__tests__/wales-rule-selection.test.ts (17 tests) 17ms
stdout | src/lib/documents/__tests__/template-rendering.test.ts
[PRINT SYSTEM] âœ… Registered 11 print component partials

stdout | tests/lib/jurisdictions/legal-enforcement.test.ts
[PRINT SYSTEM] âœ… Registered 11 print component partials

stdout | tests/integration/money-claim-wizard-flow.test.ts
[PRINT SYSTEM] âœ… Registered 11 print component partials

stdout | tests/integration/ast-wizard-flow.test.ts
[PRINT SYSTEM] âœ… Registered 11 print component partials

stdout | src/lib/documents/__tests__/template-rendering.test.ts > Markdown Artifact Prevention > No raw markdown tokens (##, **, ---) in compiled Section 8 template
[TEMPLATE] âœ… Loading from: /home/user/landlord-heavenv3/config/jurisdictions/uk/england/templates/eviction/section8_notice.hbs
[PRINT SYSTEM] âœ… Loaded print.css

stdout | src/lib/documents/__tests__/template-rendering.test.ts > Markdown Artifact Prevention > Date formatting is DD/MM/YYYY in templates
[TEMPLATE] âœ… Loading from: /home/user/landlord-heavenv3/config/jurisdictions/uk/england/templates/eviction/section8_notice.hbs

stdout | src/lib/documents/__tests__/template-rendering.test.ts > Markdown Artifact Prevention > Site domain is landlordheaven.com in generated documents
[TEMPLATE] âœ… Loading from: /home/user/landlord-heavenv3/config/jurisdictions/uk/england/templates/eviction/section8_notice.hbs

 â¯ src/lib/documents/__tests__/template-rendering.test.ts (11 tests | 1 failed) 176ms
   Ã— Markdown Artifact Prevention > No raw markdown tokens in compiled Scotland Notice to Leave template 9ms
     â†’ The proposed leaving date is too early. The earliest legally valid date is 09 April 2025 (84 days from service date). Legal basis: Private Housing (Tenancies) (Scotland) Act 2016, Schedule 3
stdout | tests/documents/money-claim-data-pipeline.test.ts > Money claim data pipeline (wizard â†’ caseFacts â†’ pack) > should correctly map wizard facts through the entire pipeline
[Normalize] Property address concatenated: 3 parts
[Normalize] Tenant name: Tom Tenant
[Normalize] Landlord name: Alice Landlord
[Normalize] Case facts normalization complete
[MoneyClaimAI] No OpenAI API key available, using fallback content

stderr | tests/documents/money-claim-data-pipeline.test.ts > Money claim data pipeline (wizard â†’ caseFacts â†’ pack) > should correctly map wizard facts through the entire pipeline
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/documents/money-claim-data-pipeline.test.ts > Money claim data pipeline (wizard â†’ caseFacts â†’ pack) > should handle Scotland money claim flow
[Normalize] Property address concatenated: 3 parts
[Normalize] Tenant name: Rob Renter
[Normalize] Landlord name: Sarah Landlord
[Normalize] Case facts normalization complete

stderr | tests/documents/money-claim-data-pipeline.test.ts > Money claim data pipeline (wizard â†’ caseFacts â†’ pack) > should handle Scotland money claim flow
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

 âœ“ tests/documents/money-claim-data-pipeline.test.ts (2 tests) 14ms
stdout | tests/integration/ast-wizard-flow.test.ts > AST Wizard Flow - Integration Tests > Standard AST - Happy Path > should create case, answer question, analyze, and generate document
[Normalize] Case facts normalization complete

stderr | tests/integration/ast-wizard-flow.test.ts > AST Wizard Flow - Integration Tests > Standard AST - Happy Path > should create case, answer question, analyze, and generate document
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/integration/ast-wizard-flow.test.ts > AST Wizard Flow - Integration Tests > Premium AST - Multiple Tenants > should create case and generate premium document
[Normalize] Case facts normalization complete

stderr | tests/integration/ast-wizard-flow.test.ts > AST Wizard Flow - Integration Tests > Premium AST - Multiple Tenants > should create case and generate premium document
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stderr | tests/integration/ast-wizard-flow.test.ts > AST Wizard Flow - Integration Tests > Error Handling > should reject non-existent case_id in answer route
[classifyDatabaseError] Unclassified error in wizard/answer: {
  errorMessage: 'Not found',
  errorCode: undefined,
  error: Error: Not found
      at Object.single (/home/user/landlord-heavenv3/tests/integration/ast-wizard-flow.test.ts:26:61)
      at Module.POST (/home/user/landlord-heavenv3/src/app/api/wizard/answer/route.ts:547:8)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)
      at /home/user/landlord-heavenv3/tests/integration/ast-wizard-flow.test.ts:411:24
      at file:///home/user/landlord-heavenv3/node_modules/@vitest/runner/dist/index.js:533:5
      at runTest (file:///home/user/landlord-heavenv3/node_modules/@vitest/runner/dist/index.js:1056:11)
      at runSuite (file:///home/user/landlord-heavenv3/node_modules/@vitest/runner/dist/index.js:1205:15)
      at runSuite (file:///home/user/landlord-heavenv3/node_modules/@vitest/runner/dist/index.js:1205:15)
      at runSuite (file:///home/user/landlord-heavenv3/node_modules/@vitest/runner/dist/index.js:1205:15)
      at runFiles (file:///home/user/landlord-heavenv3/node_modules/@vitest/runner/dist/index.js:1262:5),
  context: {
    operation: 'wizard/answer',
    caseId: '00000000-0000-0000-0000-000000000000'
  }
}
[wizard/answer] unknown: {
  caseId: '00000000-0000-0000-0000-000000000000',
  message: 'Internal server error',
  statusCode: 500,
  retryable: false
}

 â¯ tests/integration/ast-wizard-flow.test.ts (4 tests | 1 failed) 133ms
   Ã— AST Wizard Flow - Integration Tests > Error Handling > should reject non-existent case_id in answer route 27ms
     â†’ expected 500 to be 404 // Object.is equality
 âœ“ tests/api/wizard-hmo-gating.test.ts (6 tests) 47ms
stdout | tests/api/wizard-ni-gating.test.ts > Wizard API Northern Ireland gating > rejects NI eviction analysis at /api/wizard/analyze
[Normalize] Case facts normalization complete

stderr | tests/api/wizard-ni-gating.test.ts > Wizard API Northern Ireland gating > rejects NI eviction analysis at /api/wizard/analyze
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

 âœ“ tests/api/wizard-ni-gating.test.ts (6 tests) 48ms
stderr | tests/api/wizard-guest-flow.test.ts > Error Handling - Upstream vs Not Found > returns 503 for Cloudflare 500 HTML error (upstream failure)
[wizard/answer] upstream_error: {
  caseId: 'case-with-upstream-error',
  message: 'Service temporarily unavailable. Please try again.',
  statusCode: 503,
  retryable: true
}

stderr | tests/api/wizard-guest-flow.test.ts > Error Handling - Upstream vs Not Found > returns 503 for timeout error (retryable)
[wizard/next-question] upstream_error: {
  caseId: 'case-with-timeout',
  message: 'Service temporarily unavailable. Please try again.',
  statusCode: 503,
  retryable: true
}

stderr | tests/api/wizard-guest-flow.test.ts > Error Handling - Upstream vs Not Found > returns 503 for connection failure (retryable)
[wizard/answer] upstream_error: {
  caseId: 'case-with-connection-error',
  message: 'Service temporarily unavailable. Please try again.',
  statusCode: 503,
  retryable: true
}

stderr | tests/api/wizard-guest-flow.test.ts > Error Handling - Upstream vs Not Found > returns 403 for RLS policy violation (permission denied)
[wizard/answer] unauthorized: {
  caseId: 'unauthorized-case',
  message: 'Access denied',
  statusCode: 403,
  retryable: false
}

 â¯ tests/api/wizard-guest-flow.test.ts (8 tests | 1 failed) 62ms
   Ã— Guest Wizard Flow > allows guest to answer questions in wizard 16ms
     â†’ expected 400 to be 200 // Object.is equality
 â¯ tests/api/wizard-info-questions.test.ts (2 tests | 2 failed) 47ms
   Ã— Wizard info-type question handling > returns info-type question (section21_intro) once and marks it as viewed 30ms
     â†’ expected 'landlord_details' to be 'section21_intro' // Object.is equality
   Ã— Wizard info-type question handling > does not get stuck in a loop on info questions 16ms
     â†’ expected 'landlord_details' to be 'section21_intro' // Object.is equality
stdout | tests/api/wizard-money-claim-completion.test.ts > Money claim completion gating > falls back to AI when essential money-claim facts are missing
[Normalize] Case facts normalization complete

stderr | tests/api/wizard-money-claim-completion.test.ts > Money claim completion gating > falls back to AI when essential money-claim facts are missing
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/api/wizard-money-claim-completion.test.ts > Money claim completion gating > marks money-claim complete when essentials are present
[Normalize] Property address concatenated: 2 parts
[Normalize] Tenant name: Tom Tenant
[Normalize] Landlord name: Alice Landlord
[Normalize] Case facts normalization complete

stderr | tests/api/wizard-money-claim-completion.test.ts > Money claim completion gating > marks money-claim complete when essentials are present
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

 âœ“ tests/api/wizard-money-claim-completion.test.ts (2 tests) 32ms
stdout | tests/debug/money-claim-data-flow.test.ts > Money claim data flow debugging > trace wizard facts â†’ caseFacts â†’ moneyClaimCase

========================================
STEP 1: wizardFacts (from DB)
========================================
Keys: [
  'claimant_full_name',
  'claimant_email',
  'claimant_phone',
  'claimant_address.address_line1',
  'claimant_address.address_line2',
  'claimant_address.city',
  'claimant_address.postcode',
  'defendant_full_name',
  'property_address.address_line1',
  'property_address.address_line2',
  'property_address.city',
  'property_address.postcode',
  'property_address.country',
  'tenancy_start_date',
  'rent_amount',
  'rent_frequency',
  'claim_type',
  'arrears_total',
  'arrears_schedule_upload.rent_schedule_uploaded',
  'arrears_schedule_upload.arrears_items',
  'charge_interest',
  'interest_start_date',
  'interest_rate',
  'preferred_court',
  'particulars_of_claim',
  'payment_attempts',
  'lba_sent',
  'lba_date',
  'lba_method',
  'signatory_name'
]

========================================
STEP 2: wizardFactsToCaseFacts()
========================================
[Normalize] Property address concatenated: 3 parts
[Normalize] Tenant name: Tom Tenant
[Normalize] Landlord name: Alice Landlord
[Normalize] Case facts normalization complete
Landlord name: Alice Landlord
Landlord email: alice@example.com
Landlord phone: 01234567890
Landlord address_line1: 1 High Street
Landlord city: London
Landlord postcode: N1 1AA
Tenant name: Tom Tenant
Property address_line1: 2 Rental Road
Property city: London
Property postcode: N2 2BB
Rent amount: 750
Rent frequency: monthly
Tenancy start: 2024-01-01
Arrears total: 1200

========================================
STEP 3: mapCaseFactsToMoneyClaimCase()
========================================
landlord_full_name: Alice Landlord
landlord_address: 1 High Street, London
landlord_postcode: N1 1AA
landlord_email: alice@example.com
landlord_phone: 01234567890
tenant_full_name: Tom Tenant
property_address: 2 Rental Road, London
property_postcode: N2 2BB
rent_amount: 750
rent_frequency: monthly
tenancy_start_date: 2024-01-01
arrears_total: 1200

stderr | tests/debug/money-claim-data-flow.test.ts > Money claim data flow debugging > trace wizard facts â†’ caseFacts â†’ moneyClaimCase
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

 âœ“ tests/debug/money-claim-data-flow.test.ts (1 test) 8ms
stdout | tests/documents/eviction-pack-option-b.test.ts
[PRINT SYSTEM] âœ… Registered 11 print component partials

stderr | tests/api/notice-compliance-blocking.test.ts > wizard answer compliance blocking > returns 422 with failures and no next_question when noncompliant at checkpoint
[WIZARD_GATING] Blocking progression: {
  case_id: 'case-123',
  question_id: 'deposit_protected_scheme',
  blocking: [
    'DEPOSIT_FIELD_REQUIRED',
    'DEPOSIT_NOT_PROTECTED',
    'PRESCRIBED_INFO_MISSING',
    'DEPOSIT_AMOUNT_REQUIRED'
  ]
}

 â¯ tests/api/notice-compliance-blocking.test.ts (2 tests | 2 failed) 49ms
   Ã— wizard answer compliance blocking > returns 422 with failures and no next_question when noncompliant at checkpoint 32ms
     â†’ expected 'WIZARD_GATING_BLOCKED' to be 'NOTICE_NONCOMPLIANT' // Object.is equality
   Ã— wizard answer compliance blocking > allows non-checkpoint questions to pass even with compliance issues (downgrades to warnings) 3ms
     â†’ expected 400 to be 200 // Object.is equality
 â¯ tests/documents/pdf-field-mapping.test.ts (9 tests | 9 failed) 37ms
   Ã— Official form assets > includes required England & Wales PDFs 13ms
     â†’ promise rejected "Error: ENOENT: no such file or directory,â€¦ { â€¦(4) }" instead of resolving
   Ã— Official form assets > has manifest entries present on disk across jurisdictions 1ms
     â†’ ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/public/official-forms/forms-manifest.json'
   Ã— Scotland official forms > treats Notice to Leave as non-fillable when no AcroForm fields exist 1ms
     â†’ ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/public/official-forms/scotland/notice_to_leave.pdf'
   Ã— Scotland official forms > retains critical Form E fields for pdf-lib filling 15ms
     â†’ ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/public/official-forms/scotland/form_e_eviction.pdf'
   Ã— PDF field mappings align with official forms > matches critical N5 fields 1ms
     â†’ ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/public/official-forms/n5-eng.pdf'
   Ã— PDF field mappings align with official forms > matches critical N5B fields 1ms
     â†’ ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/public/official-forms/n5b-eng.pdf'
   Ã— PDF field mappings align with official forms > matches critical N119 fields 1ms
     â†’ ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/public/official-forms/n119-eng.pdf'
   Ã— PDF field mappings align with official forms > matches critical N1 fields 1ms
     â†’ ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/public/official-forms/N1_1224.pdf'
   Ã— PDF field mappings align with official forms > matches critical Form 6A fields 1ms
     â†’ ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/public/official-forms/form_6a.pdf'
stderr | tests/lib/types/jurisdiction-migration.test.ts > Jurisdiction Migration > migrateToCanonicalJurisdiction > should FAIL CLOSED for "england-wales" without property_location (no default to england)
[MIGRATION] Cannot migrate legacy jurisdiction "england-wales" without property_location hint. Legacy england-wales cases must provide explicit property_location.

stderr | tests/lib/types/jurisdiction-migration.test.ts > Jurisdiction Migration > migrateToCanonicalJurisdiction > should handle "england & wales" variant
[MIGRATION] Cannot migrate legacy jurisdiction "england & wales" without property_location hint. Legacy england-wales cases must provide explicit property_location.

stderr | tests/lib/types/jurisdiction-migration.test.ts > Jurisdiction Migration > migrateToCanonicalJurisdiction > should handle "england and wales" variant
[MIGRATION] Cannot migrate legacy jurisdiction "england and wales" without property_location hint. Legacy england-wales cases must provide explicit property_location.

stderr | tests/lib/types/jurisdiction-migration.test.ts > Jurisdiction Migration > migrateToCanonicalJurisdiction > should handle case-insensitive input
[MIGRATION] Cannot migrate legacy jurisdiction "ENGLAND-WALES" without property_location hint. Legacy england-wales cases must provide explicit property_location.
[MIGRATION] Cannot migrate legacy jurisdiction "England-Wales" without property_location hint. Legacy england-wales cases must provide explicit property_location.
[MIGRATION] Cannot migrate legacy jurisdiction "  england-wales  " without property_location hint. Legacy england-wales cases must provide explicit property_location.

stderr | tests/lib/types/jurisdiction-migration.test.ts > Jurisdiction Migration > migrateToCanonicalJurisdiction > should return null for unrecognized values
[JURISDICTION] Invalid jurisdiction value: "france"
[JURISDICTION] Invalid jurisdiction value: "invalid"

stderr | tests/lib/types/jurisdiction-migration.test.ts > Jurisdiction Migration > Real-world migration scenarios > should FAIL CLOSED for wizard API payloads with england-wales and no property_location
[MIGRATION] Cannot migrate legacy jurisdiction "england-wales" without property_location hint. Legacy england-wales cases must provide explicit property_location.

stderr | tests/lib/types/jurisdiction-migration.test.ts > Jurisdiction Migration > Real-world migration scenarios > should FAIL CLOSED for database records without property_location (no default to england)
[MIGRATION] Cannot migrate legacy jurisdiction "england-wales" without property_location hint. Legacy england-wales cases must provide explicit property_location.

 âœ“ tests/lib/grounds/format-ground-title.test.ts (11 tests) 6ms
 âœ“ tests/lib/types/jurisdiction-migration.test.ts (12 tests) 8ms
 âœ“ tests/notice-compliance-evaluate.test.ts (7 tests) 25ms
stderr | tests/integration/money-claim-wizard-flow.test.ts > Money claim wizard integration > England & Wales money claim pack generation flow
Answer error claimant_full_name { error: 'Unknown question_id' }

stderr | tests/integration/money-claim-wizard-flow.test.ts > Money claim wizard integration > Scotland money claim flow produces Simple Procedure pack
[WIZARD_GATING] Blocking progression: {
  case_id: '40aaba22-8bb5-47ab-a9ca-d5ee79091b78',
  question_id: 'pursuer_full_name',
  blocking: [ 'CLAIM_AMOUNT_REQUIRED', 'DEFENDANT_NAME_REQUIRED' ]
}
Answer error pursuer_full_name {
  error: 'WIZARD_GATING_BLOCKED',
  blocking_issues: [
    {
      code: 'CLAIM_AMOUNT_REQUIRED',
      message: 'Money claim requires a claim amount greater than zero',
      fields: [Array],
      user_fix_hint: 'Specify the total amount you are claiming'
    },
    {
      code: 'DEFENDANT_NAME_REQUIRED',
      message: 'Defendant name is required for money claim',
      fields: [Array],
      user_fix_hint: 'Provide the full name of the defendant (tenant)'
    }
  ],
  warnings: [],
  block_next_question: true
}

 â¯ tests/integration/money-claim-wizard-flow.test.ts (2 tests | 2 failed) 70ms
   Ã— Money claim wizard integration > England & Wales money claim pack generation flow 34ms
     â†’ expected 400 to be 200 // Object.is equality
   Ã— Money claim wizard integration > Scotland money claim flow produces Simple Procedure pack 35ms
     â†’ expected 422 to be 200 // Object.is equality
stdout | tests/documents/ast-pack-premium.test.ts
[PRINT SYSTEM] âœ… Registered 11 print component partials

stdout | tests/documents/ast-pack-premium.test.ts > AST pack - Premium > renders premium-only content when flags are set
[Normalize] Property address concatenated: 3 parts
[Normalize] Landlord name: Priya Landlord
[Normalize] Case facts normalization complete
[TEMPLATE] âœ… Loading from: /home/user/landlord-heavenv3/config/jurisdictions/shared/templates/terms_and_conditions.hbs
[PRINT SYSTEM] âœ… Loaded print.css
[TEMPLATE] âœ… Loading from: /home/user/landlord-heavenv3/config/jurisdictions/shared/templates/certificate_of_curation.hbs
[TEMPLATE] âœ… Loading from: /home/user/landlord-heavenv3/config/jurisdictions/shared/templates/deposit_protection_certificate.hbs
[TEMPLATE] âœ… Loading from: /home/user/landlord-heavenv3/config/jurisdictions/shared/templates/inventory_template.hbs

stderr | tests/documents/ast-pack-premium.test.ts > AST pack - Premium > renders premium-only content when flags are set
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...
Failed to compile template uk/england-wales/templates/premium_ast_formatted.hbs: Failed to load template uk/england-wales/templates/premium_ast_formatted.hbs: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/config/jurisdictions/uk/england-wales/templates/premium_ast_formatted.hbs'
Failed to compile template uk/england-wales/templates/ast_legal_validity_summary.hbs: Failed to load template uk/england-wales/templates/ast_legal_validity_summary.hbs: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/config/jurisdictions/uk/england-wales/templates/ast_legal_validity_summary.hbs'
Failed to compile template uk/england-wales/templates/government_model_clauses.hbs: Failed to load template uk/england-wales/templates/government_model_clauses.hbs: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/config/jurisdictions/uk/england-wales/templates/government_model_clauses.hbs'
Failed to compile template uk/england-wales/templates/premium/key_schedule.hbs: Failed to load template uk/england-wales/templates/premium/key_schedule.hbs: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/config/jurisdictions/uk/england-wales/templates/premium/key_schedule.hbs'
Failed to compile template uk/england-wales/templates/premium/tenant_welcome_pack.hbs: Failed to load template uk/england-wales/templates/premium/tenant_welcome_pack.hbs: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/config/jurisdictions/uk/england-wales/templates/premium/tenant_welcome_pack.hbs'
Failed to compile template uk/england-wales/templates/premium/property_maintenance_guide.hbs: Failed to load template uk/england-wales/templates/premium/property_maintenance_guide.hbs: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/config/jurisdictions/uk/england-wales/templates/premium/property_maintenance_guide.hbs'
Failed to compile template uk/england-wales/templates/premium/move_in_condition_report.hbs: Failed to load template uk/england-wales/templates/premium/move_in_condition_report.hbs: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/config/jurisdictions/uk/england-wales/templates/premium/move_in_condition_report.hbs'
Failed to compile template uk/england-wales/templates/premium/checkout_procedure.hbs: Failed to load template uk/england-wales/templates/premium/checkout_procedure.hbs: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/config/jurisdictions/uk/england-wales/templates/premium/checkout_procedure.hbs'

 â¯ tests/documents/ast-pack-premium.test.ts (1 test | 1 failed) 59ms
   Ã— AST pack - Premium > renders premium-only content when flags are set 58ms
     â†’ expected '<div style="page-break-before: alwaysâ€¦' to contain 'HMO & Shared Facilities'
 âœ“ tests/documents/scotland-money-claim-pack.test.ts (6 tests) 9ms
 âœ“ tests/api/wizard-askheaven-enhance-only.test.ts (1 test) 12ms
 â¯ tests/api/wizard-money-claim-access.test.ts (3 tests | 1 failed) 37ms
   Ã— Money claim access controls > allows England & Wales money claim cases at /api/wizard/start 14ms
     â†’ expected 'basis_of_claim' to be 'claimant_full_name' // Object.is equality
 â¯ tests/api/documents-ni-gating.test.ts (1 test | 1 failed) 21ms
   Ã— Document generation Northern Ireland gating > rejects NI eviction document generation requests 20ms
     â†’ expected 'NI_EVICTION_MONEY_CLAIM_NOT_SUPPORTED' to be 'Northern Ireland only supports tenancâ€¦' // Object.is equality
stdout | tests/documents/ast-pack-standard.test.ts
[PRINT SYSTEM] âœ… Registered 11 print component partials

 âœ“ tests/api/grounds-api.test.ts (5 tests) 90ms
stdout | tests/documents/ast-pack-standard.test.ts > AST pack - Standard > renders the standard AST pack with certificate and legal summary
[Normalize] Property address concatenated: 3 parts
[Normalize] Landlord name: Alice Landlord
[Normalize] Case facts normalization complete
[TEMPLATE] âœ… Loading from: /home/user/landlord-heavenv3/config/jurisdictions/shared/templates/terms_and_conditions.hbs
[PRINT SYSTEM] âœ… Loaded print.css
[TEMPLATE] âœ… Loading from: /home/user/landlord-heavenv3/config/jurisdictions/shared/templates/certificate_of_curation.hbs
[TEMPLATE] âœ… Loading from: /home/user/landlord-heavenv3/config/jurisdictions/shared/templates/deposit_protection_certificate.hbs
[TEMPLATE] âœ… Loading from: /home/user/landlord-heavenv3/config/jurisdictions/shared/templates/inventory_template.hbs

stderr | tests/documents/ast-pack-standard.test.ts > AST pack - Standard > renders the standard AST pack with certificate and legal summary
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...
Failed to compile template uk/england-wales/templates/standard_ast_formatted.hbs: Failed to load template uk/england-wales/templates/standard_ast_formatted.hbs: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/config/jurisdictions/uk/england-wales/templates/standard_ast_formatted.hbs'
Failed to compile template uk/england-wales/templates/ast_legal_validity_summary.hbs: Failed to load template uk/england-wales/templates/ast_legal_validity_summary.hbs: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/config/jurisdictions/uk/england-wales/templates/ast_legal_validity_summary.hbs'
Failed to compile template uk/england-wales/templates/government_model_clauses.hbs: Failed to load template uk/england-wales/templates/government_model_clauses.hbs: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/config/jurisdictions/uk/england-wales/templates/government_model_clauses.hbs'

 â¯ tests/documents/ast-pack-standard.test.ts (1 test | 1 failed) 48ms
   Ã— AST pack - Standard > renders the standard AST pack with certificate and legal summary 47ms
     â†’ expected '<div style="page-break-before: alwaysâ€¦' to contain 'Legal Validity Summary'
stdout | tests/ai/option-b-fallbacks.test.ts > Option B AI failure modes > returns deterministic witness statement fallback when AI is disabled
[Normalize] Property address concatenated: 3 parts
[Normalize] Tenant name: Terry Tenant
[Normalize] Landlord name: Fallback Landlord
[Normalize] Case facts normalization complete
[WitnessStatementAI] AI drafting disabled via env var

stderr | tests/ai/option-b-fallbacks.test.ts > Option B AI failure modes > returns deterministic witness statement fallback when AI is disabled
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/ai/option-b-fallbacks.test.ts > Option B AI failure modes > recovers with fallback compliance audit when the AI client throws
[Normalize] Property address concatenated: 3 parts
[Normalize] Tenant name: Terry Tenant
[Normalize] Landlord name: Fallback Landlord
[Normalize] Case facts normalization complete

stderr | tests/ai/option-b-fallbacks.test.ts > Option B AI failure modes > recovers with fallback compliance audit when the AI client throws
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...
[ComplianceAuditAI] AI audit failed, using fallback: Error: LLM unavailable
    at Object.jsonCompletion (/home/user/landlord-heavenv3/tests/ai/option-b-fallbacks.test.ts:63:15)
    at callComplianceAuditLLM (/home/user/landlord-heavenv3/src/lib/ai/compliance-audit-generator.ts:342:42)
    at Module.generateComplianceAudit (/home/user/landlord-heavenv3/src/lib/ai/compliance-audit-generator.ts:129:27)
    at /home/user/landlord-heavenv3/tests/ai/option-b-fallbacks.test.ts:76:25
    at file:///home/user/landlord-heavenv3/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///home/user/landlord-heavenv3/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///home/user/landlord-heavenv3/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///home/user/landlord-heavenv3/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at runSuite (file:///home/user/landlord-heavenv3/node_modules/@vitest/runner/dist/index.js:1205:15)

 âœ“ tests/ai/option-b-fallbacks.test.ts (2 tests) 15ms
 â¯ tests/api/wizard-mqs-money-claim.test.ts (4 tests | 1 failed) 24ms
   Ã— Money claim MQS - England & Wales PAP-DEBT coverage > includes PAP-DEBT, court route, evidence, and enforcement questions 9ms
     â†’ expected false to be true // Object.is equality
 âœ“ tests/supabase-config.test.ts (4 tests) 7ms
stdout | tests/documents/eviction-pack-option-b.test.ts > Complete eviction pack - Option B coverage > produces England & Wales court forms and premium AI documents

ðŸ“¦ Generating Complete Eviction Pack for england...
================================================================================

stdout | tests/lib/jurisdictions/legal-enforcement.test.ts > jurisdiction gating enforcement > fails closed during notice-only pack generation when facts become invalid

ðŸ“„ Generating Notice Only Pack for england...

stdout | tests/lib/jurisdictions/legal-enforcement.test.ts > jurisdiction gating enforcement > migrates legacy England & Wales cases to England rules during preview validation
[NOTICE-PREVIEW-API] Generating preview for case: case-england
[Normalize] Case facts normalization complete

stderr | tests/lib/jurisdictions/legal-enforcement.test.ts > jurisdiction gating enforcement > migrates legacy England & Wales cases to England rules during preview validation
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...
[MIGRATION] Cannot migrate legacy jurisdiction "england-wales" without property_location hint. Legacy england-wales cases must provide explicit property_location.

 â¯ tests/lib/jurisdictions/legal-enforcement.test.ts (10 tests | 1 failed) 86ms
   Ã— jurisdiction gating enforcement > migrates legacy England & Wales cases to England rules during preview validation 18ms
     â†’ expected 400 to be 422 // Object.is equality
 â¯ tests/notice-compliance-mqs-ids.test.ts (1 test | 1 failed) 44ms
   Ã— notice compliance affected_question_id coverage > all affected_question_id values exist in the MQS for the jurisdiction 42ms
     â†’ expected [ Array(1) ] to deeply equal []
stderr | tests/documents/eviction-pack-option-b.test.ts > Complete eviction pack - Option B coverage > produces England & Wales court forms and premium AI documents
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/documents/eviction-pack-option-b.test.ts > Complete eviction pack - Option B coverage > produces England & Wales court forms and premium AI documents
[Normalize] Property address concatenated: 3 parts
[Normalize] Tenant name: Tina Tenant
[Normalize] Landlord name: Alex Landlord
[Normalize] Case facts normalization complete
[TEMPLATE] âœ… Loading from: /home/user/landlord-heavenv3/config/jurisdictions/uk/england/templates/eviction/section8_notice.hbs
[PRINT SYSTEM] âœ… Loaded print.css
ðŸ“„ Filling N5 form (Claim for possession)...

stdout | tests/documents/eviction-pack-option-b.test.ts > Complete eviction pack - Option B coverage > produces Scotland tribunal forms plus premium AI documents

ðŸ“¦ Generating Complete Eviction Pack for scotland...
================================================================================

stderr | tests/documents/eviction-pack-option-b.test.ts > Complete eviction pack - Option B coverage > produces Scotland tribunal forms plus premium AI documents
[Normalize] Found unexpected object for key "notice", flattening...
[Normalize] Found unexpected object for key "service_contact", flattening...

stdout | tests/documents/eviction-pack-option-b.test.ts > Complete eviction pack - Option B coverage > produces Scotland tribunal forms plus premium AI documents
[Normalize] Property address concatenated: 3 parts
[Normalize] Tenant name: Sean Tenant
[Normalize] Landlord name: Fiona Landlord
[Normalize] Case facts normalization complete

stdout | tests/documents/eviction-pack-option-b.test.ts > Complete eviction pack - Option B coverage > produces Scotland tribunal forms plus premium AI documents
[TEMPLATE] âœ… Loading from: /home/user/landlord-heavenv3/config/jurisdictions/uk/scotland/templates/eviction/notice_to_leave.hbs

ðŸ´ó §ó ¢ó ³ó £ó ´ó ¿  Filling Scotland official form: FORM_E
============================================================
ðŸ“„ Filling Form E (Tribunal Application for Eviction Order)...

 â¯ tests/documents/eviction-pack-option-b.test.ts (2 tests | 2 failed) 187ms
   Ã— Complete eviction pack - Option B coverage > produces England & Wales court forms and premium AI documents 118ms
     â†’ Official form "n5-eng.pdf" is missing. Add the PDF under public/official-forms (jurisdiction subfolder allowed) or update the manifest. Error: Error: ENOENT: no such file or directory, access '/home/user/landlord-heavenv3/public/official-forms/n5-eng.pdf'
   Ã— Complete eviction pack - Option B coverage > produces Scotland tribunal forms plus premium AI documents 68ms
     â†’ Failed to load official form "form_e_eviction.pdf". Make sure the PDF exists in /public/official-forms/scotland/. Error: Error: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/public/official-forms/scotland/form_e_eviction.pdf'
 âœ“ tests/lib/wizard/gating.test.ts (3 tests) 16ms
stderr | src/lib/types/jurisdiction.test.ts > jurisdiction helpers > normalizeJurisdiction FAILS CLOSED for legacy england-wales (returns undefined)
[JURISDICTION] Legacy jurisdiction "england-wales" detected. Use migrateToCanonicalJurisdiction with property_location.
[JURISDICTION] Legacy jurisdiction "England & Wales" detected. Use migrateToCanonicalJurisdiction with property_location.

 âœ“ src/lib/types/jurisdiction.test.ts (3 tests) 5ms
 âœ“ tests/api/wizard-edit-review-mode.test.ts (1 test) 10ms
 âœ“ tests/documents/money-claim-pack.test.ts (3 tests) 7ms
 â¯ tests/notice-compliance-spec.test.ts (3 tests | 1 failed) 10ms
   Ã— noticeComplianceSpecs > defines hard bars and inline validations for each notice 6ms
     â†’ expected 0 to be greater than 0
 âœ“ tests/decision-engine/northern-ireland-gating.test.ts (2 tests) 4ms
stdout | tests/notice-only-section8-pdf-text.test.ts
[PRINT SYSTEM] âœ… Registered 11 print component partials

 â†“ tests/notice-only-section8-pdf-text.test.ts (1 test | 1 skipped)
 â¯ tests/documents/scotland-form-guards.test.ts (4 tests | 3 failed) 23ms
   Ã— Scotland official form guards > ships placeholder PDFs for tribunal filings (eviction) 18ms
     â†’ promise rejected "Error: ENOENT: no such file or directory,â€¦ { â€¦(4) }" instead of resolving
   Ã— Scotland official form guards > ships placeholder PDFs for Simple Procedure (money claims) 1ms
     â†’ promise rejected "Error: ENOENT: no such file or directory,â€¦ { â€¦(4) }" instead of resolving
   Ã— Scotland official form guards > Simple Procedure PDFs are valid and non-empty 1ms
     â†’ ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/public/official-forms/scotland/simple_procedure_claim_form.pdf'
 âœ“ tests/ui/wizard-conversational-followups.test.tsx (1 test) 156ms
 âœ“ tests/ui/wizard-ni-gating.test.tsx (3 tests) 249ms
 âœ“ tests/ui/structured-wizard-edit-mode.test.tsx (2 tests) 134ms

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Failed Suites 1 âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯

 FAIL  src/app/api/wizard/generate/__tests__/api-enforcement.test.ts > API Enforcement - Real Pattern (Integration)
Error: Test environment not configured. Missing: SUPABASE_URL_TEST, SUPABASE_SERVICE_ROLE_KEY_TEST, TEST_BASE_URL. See docs/TESTING.md for setup instructions.
 â¯ Module.verifyTestEnvironment src/lib/testing/wizard-test-helpers.ts:111:11
    109| 
    110|   if (missing.length > 0) {
    111|     throw new Error(
       |           ^
    112|       `Test environment not configured. Missing: ${missing.join(', ')}â€¦
    113|         `See docs/TESTING.md for setup instructions.`
 â¯ src/app/api/wizard/generate/__tests__/api-enforcement.test.ts:24:5

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/52]âŽ¯

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Failed Tests 51 âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯

 FAIL  tests/notice-compliance-mqs-ids.test.ts > notice compliance affected_question_id coverage > all affected_question_id values exist in the MQS for the jurisdiction
AssertionError: expected [ Array(1) ] to deeply equal []

- Expected
+ Received

- Array []
+ Array [
+   "notice-only/wales/fault-based:RHW23-GROUND-REQUIRED:breach_or_ground",
+ ]

 â¯ tests/notice-compliance-mqs-ids.test.ts:64:21
     62|     }
     63| 
     64|     expect(missing).toEqual([]);
       |                     ^
     65|   });
     66| });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/52]âŽ¯

 FAIL  tests/notice-compliance-spec.test.ts > noticeComplianceSpecs > defines hard bars and inline validations for each notice
AssertionError: expected 0 to be greater than 0
 â¯ tests/notice-compliance-spec.test.ts:22:51
     20|     noticeComplianceSpecs.forEach((spec) => {
     21|       expect(spec.hard_bars.length).toBeGreaterThan(0);
     22|       expect(spec.inline_validation_rules.length).toBeGreaterThan(0);
       |                                                   ^
     23|       expect(spec.required_inputs.every((input) => input.required)).toâ€¦
     24|     });
 â¯ tests/notice-compliance-spec.test.ts:20:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/52]âŽ¯

 FAIL  tests/bundles/bundle-generator.test.ts > generateCourtBundle (England & Wales) > should generate bundle for minimal case
AssertionError: expected 'england-wales' to be 'england' // Object.is equality

Expected: "england"
Received: "england-wales"

 â¯ tests/bundles/bundle-generator.test.ts:254:43
    252|     expect(result.success).toBe(true);
    253|     expect(result.metadata).toBeDefined();
    254|     expect(result.metadata?.jurisdiction).toBe('england');
       |                                           ^
    255|     expect(result.metadata?.type).toBe('court');
    256|     expect(result.metadata?.sections.length).toBeGreaterThan(0);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/52]âŽ¯

 FAIL  tests/api/documents-ni-gating.test.ts > Document generation Northern Ireland gating > rejects NI eviction document generation requests
AssertionError: expected 'NI_EVICTION_MONEY_CLAIM_NOT_SUPPORTED' to be 'Northern Ireland only supports tenancâ€¦' // Object.is equality

Expected: "Northern Ireland only supports tenancy agreement documents"
Received: "NI_EVICTION_MONEY_CLAIM_NOT_SUPPORTED"

 â¯ tests/api/documents-ni-gating.test.ts:95:24
     93|     const body = await response.json();
     94|     expect(response.status).toBe(400);
     95|     expect(body.error).toBe('Northern Ireland only supports tenancy agâ€¦
       |                        ^
     96|     expect(supabaseClientMock.from).toHaveBeenCalledWith('cases');
     97|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/52]âŽ¯

 FAIL  tests/api/notice-compliance-blocking.test.ts > wizard answer compliance blocking > returns 422 with failures and no next_question when noncompliant at checkpoint
AssertionError: expected 'WIZARD_GATING_BLOCKED' to be 'NOTICE_NONCOMPLIANT' // Object.is equality

Expected: "NOTICE_NONCOMPLIANT"
Received: "WIZARD_GATING_BLOCKED"

 â¯ tests/api/notice-compliance-blocking.test.ts:116:24
    114|     const body = await response.json();
    115|     expect(response.status).toBe(422);
    116|     expect(body.error).toBe('NOTICE_NONCOMPLIANT');
       |                        ^
    117|     expect(body.failures).toBeDefined();
    118|     expect(body.failures.length).toBeGreaterThan(0);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/52]âŽ¯

 FAIL  tests/api/notice-compliance-blocking.test.ts > wizard answer compliance blocking > allows non-checkpoint questions to pass even with compliance issues (downgrades to warnings)
AssertionError: expected 400 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 400

 â¯ tests/api/notice-compliance-blocking.test.ts:150:29
    148|     // Should NOT return 422, even if there are compliance failures
    149|     // Instead, compliance failures are downgraded to warnings
    150|     expect(response.status).toBe(200);
       |                             ^
    151|     expect(body.answer_saved).toBe(true);
    152|     // Compliance warnings may be present but shouldn't block

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[7/52]âŽ¯

 FAIL  tests/api/wizard-checkpoint.test.ts > Wizard API Checkpoint > accepts case_id and returns structured response
AssertionError: expected 422 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 422

 â¯ tests/api/wizard-checkpoint.test.ts:165:29
    163|     const body = await response.json();
    164| 
    165|     expect(response.status).toBe(200);
       |                             ^
    166|     expect(body.ok).toBe(true);
    167|     expect(body.status).toBe('ok');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[8/52]âŽ¯

 FAIL  tests/api/wizard-checkpoint.test.ts > Wizard API Checkpoint > persists recommended_route to cases table
AssertionError: expected "spy" to be called with arguments: [ { recommended_route: 'section_8' } ]

Received: 



Number of calls: 0

 â¯ tests/api/wizard-checkpoint.test.ts:182:39
    180|     await checkpointWizard(request);
    181| 
    182|     expect(supabaseClientMock.update).toHaveBeenCalledWith({
       |                                       ^
    183|       recommended_route: 'section_8',
    184|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[9/52]âŽ¯

 FAIL  tests/api/wizard-checkpoint.test.ts > Wizard API Checkpoint > returns structured error for missing case_id
AssertionError: expected 422 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 422

 â¯ tests/api/wizard-checkpoint.test.ts:198:29
    196|     const body = await response.json();
    197| 
    198|     expect(response.status).toBe(400);
       |                             ^
    199|     expect(body.ok).toBe(false);
    200|     expect(body.error).toBe('Invalid request');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[10/52]âŽ¯

 FAIL  tests/api/wizard-checkpoint.test.ts > Wizard API Checkpoint > returns structured error for case not found
AssertionError: expected 422 to be 404 // Object.is equality

- Expected
+ Received

- 404
+ 422

 â¯ tests/api/wizard-checkpoint.test.ts:219:29
    217|     const body = await response.json();
    218| 
    219|     expect(response.status).toBe(404);
       |                             ^
    220|     expect(body.ok).toBe(false);
    221|     expect(body.error).toBe('Case not found');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[11/52]âŽ¯

 FAIL  tests/api/wizard-checkpoint.test.ts > Wizard API Checkpoint > returns early for money_claim case_type
AssertionError: expected 422 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 422

 â¯ tests/api/wizard-checkpoint.test.ts:245:29
    243|     const body = await response.json();
    244| 
    245|     expect(response.status).toBe(200);
       |                             ^
    246|     expect(body.ok).toBe(true);
    247|     expect(body.summary).toContain('Money claim workflow');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[12/52]âŽ¯

 FAIL  tests/api/wizard-checkpoint.test.ts > Wizard API Checkpoint > blocks NI eviction cases with structured error
AssertionError: expected 422 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 422

 â¯ tests/api/wizard-checkpoint.test.ts:271:29
    269|     const body = await response.json();
    270| 
    271|     expect(response.status).toBe(400);
       |                             ^
    272|     expect(body.ok).toBe(false);
    273|     expect(body.error).toBe('NI_EVICTION_MONEY_CLAIM_NOT_SUPPORTED');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[13/52]âŽ¯

 FAIL  tests/api/wizard-checkpoint.test.ts > Wizard API Checkpoint > accepts canonical jurisdiction "england" and normalizes for decision engine
AssertionError: expected 422 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 422

 â¯ tests/api/wizard-checkpoint.test.ts:297:29
    295|     const body = await response.json();
    296| 
    297|     expect(response.status).toBe(200);
       |                             ^
    298|     expect(body.ok).toBe(true);
    299|     expect(body.status).toBe('ok');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[14/52]âŽ¯

 FAIL  tests/api/wizard-checkpoint.test.ts > Wizard API Checkpoint > accepts canonical jurisdiction "wales" and normalizes for decision engine
AssertionError: expected 422 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 422

 â¯ tests/api/wizard-checkpoint.test.ts:323:29
    321|     const body = await response.json();
    322| 
    323|     expect(response.status).toBe(200);
       |                             ^
    324|     expect(body.ok).toBe(true);
    325|     expect(body.status).toBe('ok');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[15/52]âŽ¯

 FAIL  tests/api/wizard-checkpoint.test.ts > Wizard API Checkpoint > still accepts legacy jurisdiction "england-wales" for backwards compatibility
AssertionError: expected 422 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 422

 â¯ tests/api/wizard-checkpoint.test.ts:352:29
    350|     const body = await response.json();
    351| 
    352|     expect(response.status).toBe(200);
       |                             ^
    353|     expect(body.ok).toBe(true);
    354|     expect(body.status).toBe('ok');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[16/52]âŽ¯

 FAIL  tests/api/wizard-checkpoint.test.ts > Wizard API Checkpoint > rejects invalid jurisdiction values
AssertionError: expected 'Invalid request' to be 'Invalid jurisdiction' // Object.is equality

Expected: "Invalid jurisdiction"
Received: "Invalid request"

 â¯ tests/api/wizard-checkpoint.test.ts:380:24
    378|     expect(response.status).toBe(422);
    379|     expect(body.ok).toBe(false);
    380|     expect(body.error).toBe('Invalid jurisdiction');
       |                        ^
    381|     expect(body.reason).toContain('invalid');
    382|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[17/52]âŽ¯

 FAIL  tests/api/wizard-gating.test.ts > Wizard Gating - Eviction (England) > Gate 1: Ground 8 Threshold > should block Ground 8 when arrears < 2 months
AssertionError: expected [ { â€¦(5) }, { â€¦(5) }, { â€¦(5) }, â€¦(10) ] to have a length of 1 but got 13

- Expected
+ Received

- 1
+ 13

 â¯ tests/api/wizard-gating.test.ts:29:31
     27|       });
     28| 
     29|       expect(result.blocking).toHaveLength(1);
       |                               ^
     30|       expect(result.blocking[0].code).toBe('GROUND_8_THRESHOLD_NOT_METâ€¦
     31|       expect(result.blocking[0].message).toContain('1.50 months');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[18/52]âŽ¯

 FAIL  tests/api/wizard-gating.test.ts > Wizard Gating - Eviction (England) > Gate 1: Ground 8 Threshold > should allow Ground 8 when arrears >= 2 months
AssertionError: expected [ { â€¦(5) }, { â€¦(5) }, { â€¦(5) }, â€¦(9) ] to have a length of +0 but got 12

- Expected
+ Received

- 0
+ 12

 â¯ tests/api/wizard-gating.test.ts:45:31
     43|       });
     44| 
     45|       expect(result.blocking).toHaveLength(0);
       |                               ^
     46|     });
     47| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[19/52]âŽ¯

 FAIL  tests/api/wizard-gating.test.ts > Wizard Gating - Eviction (England) > Gate 1: Ground 8 Threshold > should warn when arrears are borderline (2-3 months)
AssertionError: expected [ { â€¦(5) }, { â€¦(5) }, { â€¦(5) }, â€¦(9) ] to have a length of +0 but got 12

- Expected
+ Received

- 0
+ 12

 â¯ tests/api/wizard-gating.test.ts:59:31
     57|       });
     58| 
     59|       expect(result.blocking).toHaveLength(0);
       |                               ^
     60|       expect(result.warnings).toHaveLength(1);
     61|       expect(result.warnings[0].code).toBe('GROUND_8_BORDERLINE');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[20/52]âŽ¯

 FAIL  tests/api/wizard-gating.test.ts > Wizard Gating - Eviction (England) > Gate 1: Ground 8 Threshold > should allow weekly rent with sufficient arrears
AssertionError: expected [ { â€¦(5) }, { â€¦(5) }, { â€¦(5) }, â€¦(9) ] to have a length of +0 but got 12

- Expected
+ Received

- 0
+ 12

 â¯ tests/api/wizard-gating.test.ts:119:31
    117|       });
    118| 
    119|       expect(result.blocking).toHaveLength(0);
       |                               ^
    120|     });
    121|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[21/52]âŽ¯

 FAIL  tests/api/wizard-gating.test.ts > Wizard Gating - Eviction (England) > Gate 3: Section 21 Route Blockers > should block Section 21 when deposit is not protected
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/api/wizard-gating.test.ts:191:90
    189| 
    190|       expect(result.blocking.length).toBeGreaterThan(0);
    191|       expect(result.blocking.some((b) => b.code === 'SECTION_21_DEPOSIâ€¦
       |                                                                                          ^
    192|         true
    193|       );

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22/52]âŽ¯

 FAIL  tests/api/wizard-gating.test.ts > Wizard Gating - Eviction (England) > Gate 3: Section 21 Route Blockers > should block Section 21 when gas cert not provided
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/api/wizard-gating.test.ts:225:85
    223| 
    224|       expect(result.blocking.length).toBeGreaterThan(0);
    225|       expect(result.blocking.some((b) => b.code === 'SECTION_21_GAS_CEâ€¦
       |                                                                                     ^
    226|     });
    227| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[23/52]âŽ¯

 FAIL  tests/api/wizard-gating.test.ts > Wizard Gating - Eviction (England) > Gate 3: Section 21 Route Blockers > should allow Section 21 when all compliance requirements met
AssertionError: expected [ { â€¦(5) }, { â€¦(5) }, { â€¦(5) } ] to have a length of +0 but got 3

- Expected
+ Received

- 0
+ 3

 â¯ tests/api/wizard-gating.test.ts:270:31
    268|       });
    269| 
    270|       expect(result.blocking).toHaveLength(0);
       |                               ^
    271|     });
    272| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[24/52]âŽ¯

 FAIL  tests/api/wizard-gating.test.ts > Wizard Gating - Eviction (England) > Gate 4: Ground Particulars Completeness > should block when ground particulars are missing for selected grounds
AssertionError: expected 'Ground 8 is missing required fact: reâ€¦' to contain 'Ground(s): 8, 11'

Expected: "Ground(s): 8, 11"
Received: "Ground 8 is missing required fact: rent_amount_monthly"

 â¯ tests/api/wizard-gating.test.ts:303:42
    301|       expect(result.blocking.length).toBeGreaterThan(0);
    302|       expect(result.blocking.some((b) => b.code === 'GROUND_PARTICULARâ€¦
    303|       expect(result.blocking[0].message).toContain('Ground(s): 8, 11');
       |                                          ^
    304|     });
    305| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[25/52]âŽ¯

 FAIL  tests/api/wizard-guest-flow.test.ts > Guest Wizard Flow > allows guest to answer questions in wizard
AssertionError: expected 400 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 400

 â¯ tests/api/wizard-guest-flow.test.ts:110:29
    108| 
    109|     const body = await response.json();
    110|     expect(response.status).toBe(200);
       |                             ^
    111|     expect(body.answer_saved).toBe(true);
    112|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[26/52]âŽ¯

 FAIL  tests/api/wizard-info-questions.test.ts > Wizard info-type question handling > returns info-type question (section21_intro) once and marks it as viewed
AssertionError: expected 'landlord_details' to be 'section21_intro' // Object.is equality

Expected: "section21_intro"
Received: "landlord_details"

 â¯ tests/api/wizard-info-questions.test.ts:108:36
    106|     const body1 = await response1.json();
    107|     expect(response1.status).toBe(200);
    108|     expect(body1.next_question.id).toBe('section21_intro');
       |                                    ^
    109|     expect(body1.next_question.inputType).toBe('info');
    110| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[27/52]âŽ¯

 FAIL  tests/api/wizard-info-questions.test.ts > Wizard info-type question handling > does not get stuck in a loop on info questions
AssertionError: expected 'landlord_details' to be 'section21_intro' // Object.is equality

Expected: "section21_intro"
Received: "landlord_details"

 â¯ tests/api/wizard-info-questions.test.ts:192:26
    190| 
    191|     // Verify we don't get stuck on the same question
    192|     expect(responses[0]).toBe('section21_intro');
       |                          ^
    193|     expect(responses[1]).not.toBe('section21_intro');
    194|     expect(responses[2]).not.toBe('section21_intro');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[28/52]âŽ¯

 FAIL  tests/api/wizard-money-claim-access.test.ts > Money claim access controls > allows England & Wales money claim cases at /api/wizard/start
AssertionError: expected 'basis_of_claim' to be 'claimant_full_name' // Object.is equality

Expected: "claimant_full_name"
Received: "basis_of_claim"

 â¯ tests/api/wizard-money-claim-access.test.ts:96:36
     94|     expect(response.status).toBe(200);
     95|     expect(body.case_id).toBeDefined();
     96|     expect(body.next_question?.id).toBe('claimant_full_name');
       |                                    ^
     97|     expect(supabaseClientMock.insert).toHaveBeenCalled();
     98|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[29/52]âŽ¯

 FAIL  tests/api/wizard-mqs-eviction.test.ts > MQS eviction flow (England & Wales) > enhanceAnswer is called for MQS questions with suggestion_prompt
AssertionError: expected 422 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 422

 â¯ tests/api/wizard-mqs-eviction.test.ts:281:29
    279| 
    280|     const body = await response.json();
    281|     expect(response.status).toBe(200);
       |                             ^
    282|     expect((enhanceAnswer as unknown as Mock)).toHaveBeenCalled();
    283|     expect(body.enhanced_answer).toEqual({

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[30/52]âŽ¯

 FAIL  tests/api/wizard-mqs-money-claim.test.ts > Money claim MQS - England & Wales PAP-DEBT coverage > includes PAP-DEBT, court route, evidence, and enforcement questions
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/api/wizard-mqs-money-claim.test.ts:61:35
     59| 
     60|     englandWalesNewIds.forEach((id) => {
     61|       expect(questionIds.has(id)).toBe(true);
       |                                   ^
     62|     });
     63|   });
 â¯ tests/api/wizard-mqs-money-claim.test.ts:60:24

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[31/52]âŽ¯

 FAIL  tests/documents/ast-pack-premium.test.ts > AST pack - Premium > renders premium-only content when flags are set
AssertionError: expected '<div style="page-break-before: alwaysâ€¦' to contain 'HMO & Shared Facilities'

- Expected
+ Received

- HMO & Shared Facilities
+ <div style="page-break-before: always; padding: 40px;">
+   <h1 style="text-align: center; color: #1976d2; border-bottom: 3px solid #1976d2; padding-bottom: 15px;">
+     Terms and Conditions
+   </h1>
+ <p style="text-align: center; font-size: 10pt; color: #666; margin: 20px 0;">
+     Landlord Heaven Document Generation Service
+   </p>
+ <h2>1. Document Generation Service</h2>
+   <p>
+     This tenancy agreement has been generated using Landlord Heaven's automated document generation service.
+     The document is based on information you provided through our guided wizard and complies with the laws of
+     <strong>England &amp; Wales</strong> as of <strong>2025-12-19</strong>.
+   </p>
+ <h2>2. Legal Compliance</h2>
+   <p>
+     We take reasonable care to ensure our templates comply with current legislation. However, laws change regularly,
+     and you are responsible for:
+   </p>
+   <ul>
+     <li>Verifying the document meets current legal requirements</li>
+     <li>Ensuring all required certificates and documents are attached</li>
+     <li>Seeking independent legal advice if required</li>
+     <li>Complying with all landlord obligations under law</li>
+   </ul>
+ <h2>3. Accuracy of Information</h2>
+   <p>
+     You are responsible for ensuring all information provided is accurate and complete. Landlord Heaven
+     is not liable for errors or omissions in the information you provide.
+   </p>
+ <h2>4. Use of Documents</h2>
+   <p>
+     Documents generated are for your personal use only and may not be:
+   </p>
+   <ul>
+     <li>Resold or redistributed</li>
+     <li>Used for commercial document generation services</li>
+     <li>Modified and represented as Landlord Heaven originals</li>
+   </ul>
+ <h2>5. Liability Limitations</h2>
+   <p>
+     Landlord Heaven provides this service "as is" without warranty. We are not liable for any losses
+     arising from the use of generated documents. Maximum liability is limited to the amount paid for the service.
+   </p>
+ <h2>6. Updates and Revisions</h2>
+   <p>
+     As a Premium customer, you receive unlimited revisions for 12 months from the date of purchase.
+     Simply log in to your dashboard to regenerate documents with updated information.
+   </p>
+ <h2>7. Data Protection</h2>
+   <p>
+     Your data is processed in accordance with UK GDPR. We store your information securely and use it only
+     for document generation and service provision. See our Privacy Policy for details.
+   </p>
+ <h2>8. Professional Advice</h2>
+   <p>
+     <strong>âš ï¸ IMPORTANT:</strong> This service does not constitute legal advice. For complex situations or
+     legal disputes, we strongly recommend consulting a qualified solicitor or legal professional.
+   </p>
+ <div style="background-color: #e3f2fd; border-left: 4px solid #1976d2; padding: 15px; margin: 30px 0;">
+     <p style="margin: 0; font-weight: bold;">Questions or Concerns?</p>
+     <p style="margin: 5px 0 0 0;">
+       Contact us at: <a href="mailto:support@landlordheaven.com">support@landlordheaven.com</a>
+     </p>
+   </div>
+ <p style="text-align: center; font-size: 9pt; color: #666; margin-top: 40px;">
+     Document ID: DOC-MJDI86GE-5FV8AN | Generated: 2025-12-19T23:32:29.486Z<br/>
+     Landlord Heaven Ltd | Company No. XXXXXXXX | England & Wales
+   </p>
+ </div>
+ <div style="page-break-before: always; padding: 60px 80px; border: 10px double #1976d2; margin: 40px;">
+   <div style="text-align: center;">
+     <h1 style="font-size: 32pt; color: #1976d2; margin: 0; font-family: 'Georgia', serif;">
+       ðŸ›ï¸ CERTIFICATE OF CURATION
+     </h1>
+     <div style="height: 3px; background: linear-gradient(to right, #1976d2, #42a5f5, #1976d2); margin: 20px auto; width: 60%;"></div>
+   </div>
+ <div style="margin: 60px 0;">
+     <p style="text-align: center; font-size: 14pt; line-height: 2;">
+       This is to certify that the attached tenancy agreement has been<br/>
+       <strong style="font-size: 16pt;">curated by</strong>
+     </p>
+ <p style="text-align: center; font-size: 20pt; color: #1976d2; font-weight: bold; margin: 30px 0; font-family: 'Georgia', serif;">
+       Priya Landlord
+     </p>
+ <p style="text-align: center; font-size: 14pt; line-height: 2;">
+       and generated using the <strong>Landlord Heaven</strong><br/>
+       professional document generation platform
+     </p>
+   </div>
+ <div style="background-color: #e3f2fd; border: 2px solid #1976d2; padding: 30px; margin: 40px 0;">
+     <h2 style="text-align: center; color: #1976d2; font-size: 16pt; margin: 0 0 20px 0;">
+       âœ“ Legal Compliance Certification
+     </h2>
+ <p style="font-size: 12pt; text-align: center; line-height: 1.8;">
+       This tenancy agreement is <strong>legally compliant</strong> and <strong>court-ready</strong> for use in:
+     </p>
+ <p style="font-size: 18pt; text-align: center; color: #1976d2; font-weight: bold; margin: 20px 0;">
+       England &amp; Wales
+     </p>
+ <p style="font-size: 11pt; text-align: center; color: #555; line-height: 1.6;">
+       This document has been generated in accordance with:<br/>
+     </p>
+   </div>
+ <div style="margin: 60px 0 40px 0;">
+     <table style="width: 100%; border: none;">
+       <tr>
+         <td style="width: 50%; border: none; vertical-align: top;">
+           <p style="font-size: 11pt; margin: 0;">
+             <strong>Document Type:</strong><br/>
+             Premium Assured Shorthold Tenancy Agreement
+           </p>
+           <p style="font-size: 11pt; margin: 10px 0 0 0;">
+             <strong>Property:</strong><br/>
+             12 Harbour Road, Bristol, BS1 2BB<br/>
+             Bristol, BS1 2BB
+           </p>
+         </td>
+         <td style="width: 50%; border: none; vertical-align: top;">
+           <p style="font-size: 11pt; margin: 0;">
+             <strong>Generated Date:</strong><br/>
+             19/12/2025
+           </p>
+           <p style="font-size: 11pt; margin: 10px 0 0 0;">
+             <strong>Document ID:</strong><br/>
+             DOC-MJDI86GP-S6IANI
+           </p>
+         </td>
+       </tr>
+     </table>
+   </div>
+ <div style="border-top: 2px solid #1976d2; padding-top: 30px; margin-top: 60px;">
+     <table style="width: 100%; border: none;">
+       <tr>
+         <td style="width: 50%; border: none; text-align: center;">
+           <div style="border-bottom: 2px solid #000; width: 60%; margin: 0 auto 10px auto; padding-bottom: 2px;"></div>
+           <p style="font-size: 10pt; margin: 0;"><strong>Digitally Verified</strong></p>
+           <p style="font-size: 9pt; margin: 5px 0 0 0; color: #666;">Landlord Heaven Platform</p>
+         </td>
+         <td style="width: 50%; border: none; text-align: center;">
+           <div style="border-bottom: 2px solid #000; width: 60%; margin: 0 auto 10px auto; padding-bottom: 2px;"></div>
+           <p style="font-size: 10pt; margin: 0;"><strong>Date of Issue</strong></p>
+           <p style="font-size: 9pt; margin: 5px 0 0 0; color: #666;">19/12/2025</p>
+         </td>
+       </tr>
+     </table>
+   </div>
+ <div style="text-align: center; margin-top: 60px; padding: 20px; background-color: #f5f5f5; border-radius: 10px;">
+     <p style="font-size: 10pt; color: #666; margin: 0; line-height: 1.6;">
+       This certificate confirms that the tenancy agreement was generated using legally compliant templates<br/>
+       and contains all required clauses and notices as mandated by law.<br/>
+       <br/>
+       <strong>Landlord Heaven</strong> | Professional Legal Documents | <a href="https://landlordheaven.com">landlordheaven.com</a>
+     </p>
+   </div>
+ </div>
+ <div style="page-break-before: always; padding: 40px;">
+   <h1 style="text-align: center; color: #1976d2; border-bottom: 3px solid #1976d2; padding-bottom: 15px;">
+     Tenancy Deposit Protection Certificate
+   </h1>
+ <p style="text-align: center; font-size: 10pt; color: #666; margin: 20px 0;">
+     Prescribed Information Under Deposit Protection Regulations
+   </p>
+ <div style="background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 30px 0;">
+     <p style="margin: 0; font-weight: bold;">âš ï¸ Legal Requirement</p>
+     <p style="margin: 10px 0 0 0;">
+       This certificate must be provided to the tenant within 30 days of receiving the deposit.
+       Complete all sections and provide a signed copy to your tenant.
+     </p>
+   </div>
+ <h2>1. Property Details</h2>
+   <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; width: 40%; background-color: #f5f5f5;"><strong>Property Address:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">
+         12 Harbour Road, Bristol, BS1 2BB<br/>
+         Bristol, BS1 2BB
+       </td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Tenancy Start Date:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">01/02/2025</td>
+     </tr>
+   </table>
+ <h2>2. Landlord Details</h2>
+   <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; width: 40%; background-color: #f5f5f5;"><strong>Name:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">Priya Landlord</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Address:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">
+         10 Market Street, Bristol, BS1 1AA
+       </td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Contact:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">
+         Email: priya@example.com<br/>
+         Phone: 07000000010
+       </td>
+     </tr>
+   </table>
+ <h2>3. Tenant Details</h2>
+   <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; width: 40%; background-color: #f5f5f5;"><strong>Tenant Name(s):</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">
+         
+         
+       </td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Contact:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">
+         Email: <br/>
+         Phone: 
+       </td>
+     </tr>
+   </table>
+ <h2>4. Deposit Details</h2>
+   <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; width: 40%; background-color: #f5f5f5;"><strong>Deposit Amount:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px; font-size: 14pt; font-weight: bold;">Â£2500</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Date Paid:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">___________________</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Payment Method:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">___________________</td>
+     </tr>
+   </table>
+ <h2>5. Deposit Protection Scheme</h2>
+   <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; width: 40%; background-color: #f5f5f5;"><strong>Scheme Name:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px; font-weight: bold;"></td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Certificate Number:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">___________________</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Date Protected:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">___________________</td>
+     </tr>
+   </table>
+ <div style="background-color: #e3f2fd; border: 2px solid #1976d2; padding: 20px; margin: 30px 0;">
+     <h3 style="color: #1976d2; margin: 0 0 15px 0;">What Happens to Your Deposit</h3>
+     <p style="margin: 0; line-height: 1.8;">
+       Your deposit is protected in a government-approved scheme. At the end of the tenancy:
+     </p>
+     <ul style="margin: 10px 0 0 0; line-height: 1.8;">
+       <li>If there are no disputes, the deposit will be returned within 10 days</li>
+       <li>If there are deductions, we must provide evidence (photos, receipts, inventory reports)</li>
+       <li>If we cannot agree, the deposit scheme offers free Alternative Dispute Resolution (ADR)</li>
+       <li>The scheme holds the deposit until the dispute is resolved</li>
+     </ul>
+   </div>
+ <h2>6. How to Raise a Dispute</h2>
+   <p>If you disagree with any proposed deductions at the end of the tenancy:</p>
+   <ol>
+     <li>Contact the landlord/agent to discuss the deductions</li>
+     <li>If no agreement is reached, contact the deposit scheme directly</li>
+     <li>The scheme will offer free ADR to resolve the dispute</li>
+     <li>The ADR decision is binding on both parties</li>
+   </ol>
+ <h2>7. Scheme Contact Information</h2>
+   <div style="background-color: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 5px;">
+     <p style="margin: 0 0 10px 0;"><strong></strong></p>
+     <p style="margin: 0; font-size: 10pt; color: #666;">
+       For scheme contact details, certificate number, and dispute resolution, visit:<br/>
+       â€¢ Deposit Protection Service (DPS): www.depositprotection.com<br/>
+       â€¢ MyDeposits: www.mydeposits.co.uk<br/>
+       â€¢ Tenancy Deposit Scheme (TDS): www.tenancydepositscheme.com
+     </p>
+   </div>
+ <div style="margin-top: 60px; page-break-inside: avoid;">
+     <h2>8. Signatures</h2>
+     <table style="width: 100%; border: none; margin-top: 30px;">
+       <tr>
+         <td style="width: 50%; border: none; padding-right: 20px;">
+           <p style="margin: 0;"><strong>Landlord Signature:</strong></p>
+           <div style="border-bottom: 2px solid #000; margin: 40px 0 10px 0;"></div>
+           <p style="margin: 0; font-size: 10pt;">Priya Landlord</p>
+           <p style="margin: 5px 0; font-size: 10pt;">Date: _______________</p>
+         </td>
+         <td style="width: 50%; border: none; padding-left: 20px;">
+           <p style="margin: 0;"><strong>Tenant Signature:</strong></p>
+           <div style="border-bottom: 2px solid #000; margin: 40px 0 10px 0;"></div>
+           <p style="margin: 0; font-size: 10pt;"></p>
+           <p style="margin: 5px 0; font-size: 10pt;">Date: _______________</p>
+         </td>
+       </tr>
+     </table>
+   </div>
+ <p style="text-align: center; font-size: 9pt; color: #666; margin-top: 40px;">
+     Keep a signed copy of this certificate for your records<br/>
+     Generated by Landlord Heaven | Document ID: DOC-MJDI86GW-TV07M1
+   </p>
+ </div>
+ <div style="page-break-before: always; padding: 40px;">
+   <h1 style="text-align: center; color: #1976d2; border-bottom: 3px solid #1976d2; padding-bottom: 15px;">
+     Property Inventory & Condition Report
+   </h1>
+ <p style="text-align: center; font-size: 10pt; color: #666; margin: 20px 0;">
+     Complete before tenancy starts â€¢ Keep photos as evidence
+   </p>
+ <div style="background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 30px 0;">
+     <p style="margin: 0; font-weight: bold;">ðŸ“¸ Important: Take Photographs</p>
+     <p style="margin: 10px 0 0 0;">
+       Take clear, dated photographs of every room and item listed below. Store photos digitally and
+       reference them in this inventory. This protects both landlord and tenant.
+     </p>
+   </div>
+ <h2>Property Information</h2>
+   <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; width: 30%; background-color: #f5f5f5;"><strong>Address:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">
+         12 Harbour Road, Bristol, BS1 2BB, Bristol, BS1 2BB
+       </td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Property Type:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">house - furnished</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Date Completed:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">___________________</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Completed By:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">___________________</td>
+     </tr>
+   </table>
+ <h2>Condition Rating Guide</h2>
+   <table style="width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 10pt;">
+     <tr style="background-color: #f5f5f5;">
+       <th style="border: 1px solid #ddd; padding: 8px; width: 15%;">Rating</th>
+       <th style="border: 1px solid #ddd; padding: 8px;">Description</th>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 8px; text-align: center;"><strong>Excellent</strong></td>
+       <td style="border: 1px solid #ddd; padding: 8px;">As new, no marks or wear</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 8px; text-align: center;"><strong>Good</strong></td>
+       <td style="border: 1px solid #ddd; padding: 8px;">Clean, minor wear consistent with age</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 8px; text-align: center;"><strong>Fair</strong></td>
+       <td style="border: 1px solid #ddd; padding: 8px;">Showing signs of wear, functional but dated</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 8px; text-align: center;"><strong>Poor</strong></td>
+       <td style="border: 1px solid #ddd; padding: 8px;">Damaged, stained, or in need of repair/replacement</td>
+     </tr>
+   </table>
+ </div>
+ <p><!-- Living Room --><br /><div style="page-break-before: always; padding: 40px;"><br />  <h2 style="background-color: #1976d2; color: white; padding: 10px;">Living Room</h2></p>
+ <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <thead>
+       <tr style="background-color: #f5f5f5;">
+         <th style="border: 1px solid #ddd; padding: 8px; width: 30%;">Item</th>
+         <th style="border: 1px solid #ddd; padding: 8px; width: 15%;">Condition</th>
+         <th style="border: 1px solid #ddd; padding: 8px;">Notes / Defects</th>
+         <th style="border: 1px solid #ddd; padding: 8px; width: 10%;">Photo #</th>
+       </tr>
+     </thead>
+     <tbody>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Walls</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Ceiling</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Floor / Carpet</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Windows</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Doors</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Light Fittings</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Radiators / Heating</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Power Sockets</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+     </tbody>
+   </table>
+ </div>
+ <p><!-- Kitchen --><br /><div style="page-break-before: always; padding: 40px;"><br />  <h2 style="background-color: #1976d2; color: white; padding: 10px;">Kitchen</h2></p>
+ <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <thead>
+       <tr style="background-color: #f5f5f5;">
+         <th style="border: 1px solid #ddd; padding: 8px; width: 30%;">Item</th>
+         <th style="border: 1px solid #ddd; padding: 8px; width: 15%;">Condition</th>
+         <th style="border: 1px solid #ddd; padding: 8px;">Notes / Defects</th>
+         <th style="border: 1px solid #ddd; padding: 8px; width: 10%;">Photo #</th>
+       </tr>
+     </thead>
+     <tbody>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Walls & Ceiling</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Floor</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Kitchen Units</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Worktops</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Sink & Taps</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Oven/Hob</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Extractor Fan</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+ falsefalsefalsefalse    </tbody>
+   </table>
+ </div>
+ <p><!-- Bedroom(s) --><br /><div style="page-break-before: always; padding: 40px;"><br />  <h2 style="background-color: #1976d2; color: white; padding: 10px;">Bedroom 1</h2></p>
+ <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <thead>
+       <tr style="background-color: #f5f5f5;">
+         <th style="border: 1px solid #ddd; padding: 8px; width: 30%;">Item</th>
+         <th style="border: 1px solid #ddd; padding: 8px; width: 15%;">Condition</th>
+         <th style="border: 1px solid #ddd; padding: 8px;">Notes / Defects</th>
+         <th style="border: 1px solid #ddd; padding: 8px; width: 10%;">Photo #</th>
+       </tr>
+     </thead>
+     <tbody>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Walls & Ceiling</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Floor / Carpet</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Windows</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Built-in Wardrobes</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+     </tbody>
+   </table>
+ <p style="font-size: 10pt; color: #666; font-style: italic;">
+     Note: Repeat this section for each bedroom in the property
+   </p>
+ </div>
+ <p><!-- Bathroom --><br /><div style="page-break-before: always; padding: 40px;"><br />  <h2 style="background-color: #1976d2; color: white; padding: 10px;">Bathroom</h2></p>
+ <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <thead>
+       <tr style="background-color: #f5f5f5;">
+         <th style="border: 1px solid #ddd; padding: 8px; width: 30%;">Item</th>
+         <th style="border: 1px solid #ddd; padding: 8px; width: 15%;">Condition</th>
+         <th style="border: 1px solid #ddd; padding: 8px;">Notes / Defects</th>
+         <th style="border: 1px solid #ddd; padding: 8px; width: 10%;">Photo #</th>
+       </tr>
+     </thead>
+     <tbody>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Walls & Ceiling</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Floor / Tiles</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Bath</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Shower</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Toilet</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Sink & Taps</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Mirror / Cabinet</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Extractor Fan</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+     </tbody>
+   </table>
+ </div>
+ <p><!-- Meter Readings & Keys --><br /><div style="page-break-before: always; padding: 40px;"><br />  <h2 style="background-color: #1976d2; color: white; padding: 10px;">Meter Readings & Keys</h2></p>
+ <h3>Meter Readings (at start of tenancy)</h3>
+   <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; width: 30%; background-color: #f5f5f5;"><strong>Electricity:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">___________________</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Gas:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">___________________</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Water:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">___________________</td>
+     </tr>
+   </table>
+ <h3>Keys Provided</h3>
+   <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; width: 30%; background-color: #f5f5f5;"><strong>Front Door:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">_____ keys</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Back Door:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">_____ keys</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Other:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">_______________________</td>
+     </tr>
+   </table>
+ <div style="margin-top: 60px;">
+     <h2>Signatures</h2>
+     <p style="font-size: 11pt; color: #666;">
+       Both parties confirm this inventory is accurate at the start of the tenancy.
+     </p>
+ <table style="width: 100%; border: none; margin-top: 30px;">
+       <tr>
+         <td style="width: 50%; border: none; padding-right: 20px;">
+           <p style="margin: 0;"><strong>Landlord/Agent:</strong></p>
+           <div style="border-bottom: 2px solid #000; margin: 40px 0 10px 0;"></div>
+           <p style="margin: 0; font-size: 10pt;">Priya Landlord</p>
+           <p style="margin: 5px 0; font-size: 10pt;">Date: _______________</p>
+         </td>
+         <td style="width: 50%; border: none; padding-left: 20px;">
+           <p style="margin: 0;"><strong>Tenant:</strong></p>
+           <div style="border-bottom: 2px solid #000; margin: 40px 0 10px 0;"></div>
+           <p style="margin: 0; font-size: 10pt;"></p>
+           <p style="margin: 5px 0; font-size: 10pt;">Date: _______________</p>
+         </td>
+       </tr>
+     </table>
+   </div>
+ <p style="text-align: center; font-size: 9pt; color: #666; margin-top: 60px;">
+     Keep a signed copy and all photographs for the duration of the tenancy<br/>
+     Generated by Landlord Heaven | Document ID: DOC-MJDI86H1-4O6T3E
+   </p>
+ </div>

 â¯ tests/documents/ast-pack-premium.test.ts:97:28
     95|     const generated = await generatePremiumAST(astData, true);
     96| 
     97|     expect(generated.html).toContain('HMO & Shared Facilities');
       |                            ^
     98|     expect(generated.html).toContain('Guarantor');
     99|     expect(generated.html).toContain('Joint and Several Liability');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[32/52]âŽ¯

 FAIL  tests/documents/ast-pack-standard.test.ts > AST pack - Standard > renders the standard AST pack with certificate and legal summary
AssertionError: expected '<div style="page-break-before: alwaysâ€¦' to contain 'Legal Validity Summary'

- Expected
+ Received

- Legal Validity Summary
+ <div style="page-break-before: always; padding: 40px;">
+   <h1 style="text-align: center; color: #1976d2; border-bottom: 3px solid #1976d2; padding-bottom: 15px;">
+     Terms and Conditions
+   </h1>
+ <p style="text-align: center; font-size: 10pt; color: #666; margin: 20px 0;">
+     Landlord Heaven Document Generation Service
+   </p>
+ <h2>1. Document Generation Service</h2>
+   <p>
+     This tenancy agreement has been generated using Landlord Heaven's automated document generation service.
+     The document is based on information you provided through our guided wizard and complies with the laws of
+     <strong>England &amp; Wales</strong> as of <strong>2025-12-19</strong>.
+   </p>
+ <h2>2. Legal Compliance</h2>
+   <p>
+     We take reasonable care to ensure our templates comply with current legislation. However, laws change regularly,
+     and you are responsible for:
+   </p>
+   <ul>
+     <li>Verifying the document meets current legal requirements</li>
+     <li>Ensuring all required certificates and documents are attached</li>
+     <li>Seeking independent legal advice if required</li>
+     <li>Complying with all landlord obligations under law</li>
+   </ul>
+ <h2>3. Accuracy of Information</h2>
+   <p>
+     You are responsible for ensuring all information provided is accurate and complete. Landlord Heaven
+     is not liable for errors or omissions in the information you provide.
+   </p>
+ <h2>4. Use of Documents</h2>
+   <p>
+     Documents generated are for your personal use only and may not be:
+   </p>
+   <ul>
+     <li>Resold or redistributed</li>
+     <li>Used for commercial document generation services</li>
+     <li>Modified and represented as Landlord Heaven originals</li>
+   </ul>
+ <h2>5. Liability Limitations</h2>
+   <p>
+     Landlord Heaven provides this service "as is" without warranty. We are not liable for any losses
+     arising from the use of generated documents. Maximum liability is limited to the amount paid for the service.
+   </p>
+ <h2>6. Updates and Revisions</h2>
+   <p>
+     Standard customers receive the generated document as-is. For revisions or updates, please contact support.
+   </p>
+ <h2>7. Data Protection</h2>
+   <p>
+     Your data is processed in accordance with UK GDPR. We store your information securely and use it only
+     for document generation and service provision. See our Privacy Policy for details.
+   </p>
+ <h2>8. Professional Advice</h2>
+   <p>
+     <strong>âš ï¸ IMPORTANT:</strong> This service does not constitute legal advice. For complex situations or
+     legal disputes, we strongly recommend consulting a qualified solicitor or legal professional.
+   </p>
+ <div style="background-color: #e3f2fd; border-left: 4px solid #1976d2; padding: 15px; margin: 30px 0;">
+     <p style="margin: 0; font-weight: bold;">Questions or Concerns?</p>
+     <p style="margin: 5px 0 0 0;">
+       Contact us at: <a href="mailto:support@landlordheaven.com">support@landlordheaven.com</a>
+     </p>
+   </div>
+ <p style="text-align: center; font-size: 9pt; color: #666; margin-top: 40px;">
+     Document ID: DOC-MJDI86XW-QUJWTX | Generated: 2025-12-19T23:32:30.116Z<br/>
+     Landlord Heaven Ltd | Company No. XXXXXXXX | England & Wales
+   </p>
+ </div>
+ <div style="page-break-before: always; padding: 60px 80px; border: 10px double #1976d2; margin: 40px;">
+   <div style="text-align: center;">
+     <h1 style="font-size: 32pt; color: #1976d2; margin: 0; font-family: 'Georgia', serif;">
+       ðŸ›ï¸ CERTIFICATE OF CURATION
+     </h1>
+     <div style="height: 3px; background: linear-gradient(to right, #1976d2, #42a5f5, #1976d2); margin: 20px auto; width: 60%;"></div>
+   </div>
+ <div style="margin: 60px 0;">
+     <p style="text-align: center; font-size: 14pt; line-height: 2;">
+       This is to certify that the attached tenancy agreement has been<br/>
+       <strong style="font-size: 16pt;">curated by</strong>
+     </p>
+ <p style="text-align: center; font-size: 20pt; color: #1976d2; font-weight: bold; margin: 30px 0; font-family: 'Georgia', serif;">
+       Alice Landlord
+     </p>
+ <p style="text-align: center; font-size: 14pt; line-height: 2;">
+       and generated using the <strong>Landlord Heaven</strong><br/>
+       professional document generation platform
+     </p>
+   </div>
+ <div style="background-color: #e3f2fd; border: 2px solid #1976d2; padding: 30px; margin: 40px 0;">
+     <h2 style="text-align: center; color: #1976d2; font-size: 16pt; margin: 0 0 20px 0;">
+       âœ“ Legal Compliance Certification
+     </h2>
+ <p style="font-size: 12pt; text-align: center; line-height: 1.8;">
+       This tenancy agreement is <strong>legally compliant</strong> and <strong>court-ready</strong> for use in:
+     </p>
+ <p style="font-size: 18pt; text-align: center; color: #1976d2; font-weight: bold; margin: 20px 0;">
+       England &amp; Wales
+     </p>
+ <p style="font-size: 11pt; text-align: center; color: #555; line-height: 1.6;">
+       This document has been generated in accordance with:<br/>
+     </p>
+   </div>
+ <div style="margin: 60px 0 40px 0;">
+     <table style="width: 100%; border: none;">
+       <tr>
+         <td style="width: 50%; border: none; vertical-align: top;">
+           <p style="font-size: 11pt; margin: 0;">
+             <strong>Document Type:</strong><br/>
+             Standard Assured Shorthold Tenancy Agreement
+           </p>
+           <p style="font-size: 11pt; margin: 10px 0 0 0;">
+             <strong>Property:</strong><br/>
+             2 High Street, London, E1 2BB<br/>
+             London, E1 2BB
+           </p>
+         </td>
+         <td style="width: 50%; border: none; vertical-align: top;">
+           <p style="font-size: 11pt; margin: 0;">
+             <strong>Generated Date:</strong><br/>
+             19/12/2025
+           </p>
+           <p style="font-size: 11pt; margin: 10px 0 0 0;">
+             <strong>Document ID:</strong><br/>
+             DOC-MJDI86Y7-4FU7FK
+           </p>
+         </td>
+       </tr>
+     </table>
+   </div>
+ <div style="border-top: 2px solid #1976d2; padding-top: 30px; margin-top: 60px;">
+     <table style="width: 100%; border: none;">
+       <tr>
+         <td style="width: 50%; border: none; text-align: center;">
+           <div style="border-bottom: 2px solid #000; width: 60%; margin: 0 auto 10px auto; padding-bottom: 2px;"></div>
+           <p style="font-size: 10pt; margin: 0;"><strong>Digitally Verified</strong></p>
+           <p style="font-size: 9pt; margin: 5px 0 0 0; color: #666;">Landlord Heaven Platform</p>
+         </td>
+         <td style="width: 50%; border: none; text-align: center;">
+           <div style="border-bottom: 2px solid #000; width: 60%; margin: 0 auto 10px auto; padding-bottom: 2px;"></div>
+           <p style="font-size: 10pt; margin: 0;"><strong>Date of Issue</strong></p>
+           <p style="font-size: 9pt; margin: 5px 0 0 0; color: #666;">19/12/2025</p>
+         </td>
+       </tr>
+     </table>
+   </div>
+ <div style="text-align: center; margin-top: 60px; padding: 20px; background-color: #f5f5f5; border-radius: 10px;">
+     <p style="font-size: 10pt; color: #666; margin: 0; line-height: 1.6;">
+       This certificate confirms that the tenancy agreement was generated using legally compliant templates<br/>
+       and contains all required clauses and notices as mandated by law.<br/>
+       <br/>
+       <strong>Landlord Heaven</strong> | Professional Legal Documents | <a href="https://landlordheaven.com">landlordheaven.com</a>
+     </p>
+   </div>
+ </div>
+ <div style="page-break-before: always; padding: 40px;">
+   <h1 style="text-align: center; color: #1976d2; border-bottom: 3px solid #1976d2; padding-bottom: 15px;">
+     Tenancy Deposit Protection Certificate
+   </h1>
+ <p style="text-align: center; font-size: 10pt; color: #666; margin: 20px 0;">
+     Prescribed Information Under Deposit Protection Regulations
+   </p>
+ <div style="background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 30px 0;">
+     <p style="margin: 0; font-weight: bold;">âš ï¸ Legal Requirement</p>
+     <p style="margin: 10px 0 0 0;">
+       This certificate must be provided to the tenant within 30 days of receiving the deposit.
+       Complete all sections and provide a signed copy to your tenant.
+     </p>
+   </div>
+ <h2>1. Property Details</h2>
+   <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; width: 40%; background-color: #f5f5f5;"><strong>Property Address:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">
+         2 High Street, London, E1 2BB<br/>
+         London, E1 2BB
+       </td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Tenancy Start Date:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">01/01/2025</td>
+     </tr>
+   </table>
+ <h2>2. Landlord Details</h2>
+   <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; width: 40%; background-color: #f5f5f5;"><strong>Name:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">Alice Landlord</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Address:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">
+         1 High Street, London, E1 1AA
+       </td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Contact:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">
+         Email: alice@example.com<br/>
+         Phone: 07000000001
+       </td>
+     </tr>
+   </table>
+ <h2>3. Tenant Details</h2>
+   <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; width: 40%; background-color: #f5f5f5;"><strong>Tenant Name(s):</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">
+         
+         
+       </td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Contact:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">
+         Email: <br/>
+         Phone: 
+       </td>
+     </tr>
+   </table>
+ <h2>4. Deposit Details</h2>
+   <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; width: 40%; background-color: #f5f5f5;"><strong>Deposit Amount:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px; font-size: 14pt; font-weight: bold;">Â£1200</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Date Paid:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">___________________</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Payment Method:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">___________________</td>
+     </tr>
+   </table>
+ <h2>5. Deposit Protection Scheme</h2>
+   <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; width: 40%; background-color: #f5f5f5;"><strong>Scheme Name:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px; font-weight: bold;"></td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Certificate Number:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">___________________</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Date Protected:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">___________________</td>
+     </tr>
+   </table>
+ <div style="background-color: #e3f2fd; border: 2px solid #1976d2; padding: 20px; margin: 30px 0;">
+     <h3 style="color: #1976d2; margin: 0 0 15px 0;">What Happens to Your Deposit</h3>
+     <p style="margin: 0; line-height: 1.8;">
+       Your deposit is protected in a government-approved scheme. At the end of the tenancy:
+     </p>
+     <ul style="margin: 10px 0 0 0; line-height: 1.8;">
+       <li>If there are no disputes, the deposit will be returned within 10 days</li>
+       <li>If there are deductions, we must provide evidence (photos, receipts, inventory reports)</li>
+       <li>If we cannot agree, the deposit scheme offers free Alternative Dispute Resolution (ADR)</li>
+       <li>The scheme holds the deposit until the dispute is resolved</li>
+     </ul>
+   </div>
+ <h2>6. How to Raise a Dispute</h2>
+   <p>If you disagree with any proposed deductions at the end of the tenancy:</p>
+   <ol>
+     <li>Contact the landlord/agent to discuss the deductions</li>
+     <li>If no agreement is reached, contact the deposit scheme directly</li>
+     <li>The scheme will offer free ADR to resolve the dispute</li>
+     <li>The ADR decision is binding on both parties</li>
+   </ol>
+ <h2>7. Scheme Contact Information</h2>
+   <div style="background-color: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 5px;">
+     <p style="margin: 0 0 10px 0;"><strong></strong></p>
+     <p style="margin: 0; font-size: 10pt; color: #666;">
+       For scheme contact details, certificate number, and dispute resolution, visit:<br/>
+       â€¢ Deposit Protection Service (DPS): www.depositprotection.com<br/>
+       â€¢ MyDeposits: www.mydeposits.co.uk<br/>
+       â€¢ Tenancy Deposit Scheme (TDS): www.tenancydepositscheme.com
+     </p>
+   </div>
+ <div style="margin-top: 60px; page-break-inside: avoid;">
+     <h2>8. Signatures</h2>
+     <table style="width: 100%; border: none; margin-top: 30px;">
+       <tr>
+         <td style="width: 50%; border: none; padding-right: 20px;">
+           <p style="margin: 0;"><strong>Landlord Signature:</strong></p>
+           <div style="border-bottom: 2px solid #000; margin: 40px 0 10px 0;"></div>
+           <p style="margin: 0; font-size: 10pt;">Alice Landlord</p>
+           <p style="margin: 5px 0; font-size: 10pt;">Date: _______________</p>
+         </td>
+         <td style="width: 50%; border: none; padding-left: 20px;">
+           <p style="margin: 0;"><strong>Tenant Signature:</strong></p>
+           <div style="border-bottom: 2px solid #000; margin: 40px 0 10px 0;"></div>
+           <p style="margin: 0; font-size: 10pt;"></p>
+           <p style="margin: 5px 0; font-size: 10pt;">Date: _______________</p>
+         </td>
+       </tr>
+     </table>
+   </div>
+ <p style="text-align: center; font-size: 9pt; color: #666; margin-top: 40px;">
+     Keep a signed copy of this certificate for your records<br/>
+     Generated by Landlord Heaven | Document ID: DOC-MJDI86YE-8CI9ZB
+   </p>
+ </div>
+ <div style="page-break-before: always; padding: 40px;">
+   <h1 style="text-align: center; color: #1976d2; border-bottom: 3px solid #1976d2; padding-bottom: 15px;">
+     Property Inventory & Condition Report
+   </h1>
+ <p style="text-align: center; font-size: 10pt; color: #666; margin: 20px 0;">
+     Complete before tenancy starts â€¢ Keep photos as evidence
+   </p>
+ <div style="background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 30px 0;">
+     <p style="margin: 0; font-weight: bold;">ðŸ“¸ Important: Take Photographs</p>
+     <p style="margin: 10px 0 0 0;">
+       Take clear, dated photographs of every room and item listed below. Store photos digitally and
+       reference them in this inventory. This protects both landlord and tenant.
+     </p>
+   </div>
+ <h2>Property Information</h2>
+   <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; width: 30%; background-color: #f5f5f5;"><strong>Address:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">
+         2 High Street, London, E1 2BB, London, E1 2BB
+       </td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Property Type:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">flat - unfurnished</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Date Completed:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">___________________</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Completed By:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">___________________</td>
+     </tr>
+   </table>
+ <h2>Condition Rating Guide</h2>
+   <table style="width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 10pt;">
+     <tr style="background-color: #f5f5f5;">
+       <th style="border: 1px solid #ddd; padding: 8px; width: 15%;">Rating</th>
+       <th style="border: 1px solid #ddd; padding: 8px;">Description</th>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 8px; text-align: center;"><strong>Excellent</strong></td>
+       <td style="border: 1px solid #ddd; padding: 8px;">As new, no marks or wear</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 8px; text-align: center;"><strong>Good</strong></td>
+       <td style="border: 1px solid #ddd; padding: 8px;">Clean, minor wear consistent with age</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 8px; text-align: center;"><strong>Fair</strong></td>
+       <td style="border: 1px solid #ddd; padding: 8px;">Showing signs of wear, functional but dated</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 8px; text-align: center;"><strong>Poor</strong></td>
+       <td style="border: 1px solid #ddd; padding: 8px;">Damaged, stained, or in need of repair/replacement</td>
+     </tr>
+   </table>
+ </div>
+ <p><!-- Living Room --><br /><div style="page-break-before: always; padding: 40px;"><br />  <h2 style="background-color: #1976d2; color: white; padding: 10px;">Living Room</h2></p>
+ <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <thead>
+       <tr style="background-color: #f5f5f5;">
+         <th style="border: 1px solid #ddd; padding: 8px; width: 30%;">Item</th>
+         <th style="border: 1px solid #ddd; padding: 8px; width: 15%;">Condition</th>
+         <th style="border: 1px solid #ddd; padding: 8px;">Notes / Defects</th>
+         <th style="border: 1px solid #ddd; padding: 8px; width: 10%;">Photo #</th>
+       </tr>
+     </thead>
+     <tbody>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Walls</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Ceiling</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Floor / Carpet</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Windows</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Doors</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Light Fittings</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Radiators / Heating</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Power Sockets</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+     </tbody>
+   </table>
+ </div>
+ <p><!-- Kitchen --><br /><div style="page-break-before: always; padding: 40px;"><br />  <h2 style="background-color: #1976d2; color: white; padding: 10px;">Kitchen</h2></p>
+ <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <thead>
+       <tr style="background-color: #f5f5f5;">
+         <th style="border: 1px solid #ddd; padding: 8px; width: 30%;">Item</th>
+         <th style="border: 1px solid #ddd; padding: 8px; width: 15%;">Condition</th>
+         <th style="border: 1px solid #ddd; padding: 8px;">Notes / Defects</th>
+         <th style="border: 1px solid #ddd; padding: 8px; width: 10%;">Photo #</th>
+       </tr>
+     </thead>
+     <tbody>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Walls & Ceiling</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Floor</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Kitchen Units</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Worktops</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Sink & Taps</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Oven/Hob</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Extractor Fan</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+ falsefalsefalsefalse    </tbody>
+   </table>
+ </div>
+ <p><!-- Bedroom(s) --><br /><div style="page-break-before: always; padding: 40px;"><br />  <h2 style="background-color: #1976d2; color: white; padding: 10px;">Bedroom 1</h2></p>
+ <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <thead>
+       <tr style="background-color: #f5f5f5;">
+         <th style="border: 1px solid #ddd; padding: 8px; width: 30%;">Item</th>
+         <th style="border: 1px solid #ddd; padding: 8px; width: 15%;">Condition</th>
+         <th style="border: 1px solid #ddd; padding: 8px;">Notes / Defects</th>
+         <th style="border: 1px solid #ddd; padding: 8px; width: 10%;">Photo #</th>
+       </tr>
+     </thead>
+     <tbody>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Walls & Ceiling</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Floor / Carpet</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Windows</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Built-in Wardrobes</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+     </tbody>
+   </table>
+ <p style="font-size: 10pt; color: #666; font-style: italic;">
+     Note: Repeat this section for each bedroom in the property
+   </p>
+ </div>
+ <p><!-- Bathroom --><br /><div style="page-break-before: always; padding: 40px;"><br />  <h2 style="background-color: #1976d2; color: white; padding: 10px;">Bathroom</h2></p>
+ <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <thead>
+       <tr style="background-color: #f5f5f5;">
+         <th style="border: 1px solid #ddd; padding: 8px; width: 30%;">Item</th>
+         <th style="border: 1px solid #ddd; padding: 8px; width: 15%;">Condition</th>
+         <th style="border: 1px solid #ddd; padding: 8px;">Notes / Defects</th>
+         <th style="border: 1px solid #ddd; padding: 8px; width: 10%;">Photo #</th>
+       </tr>
+     </thead>
+     <tbody>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Walls & Ceiling</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Floor / Tiles</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Bath</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Shower</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Toilet</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Sink & Taps</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Mirror / Cabinet</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+       <tr><td style="border: 1px solid #ddd; padding: 8px;">Extractor Fan</td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td><td style="border: 1px solid #ddd; padding: 8px;"></td></tr>
+     </tbody>
+   </table>
+ </div>
+ <p><!-- Meter Readings & Keys --><br /><div style="page-break-before: always; padding: 40px;"><br />  <h2 style="background-color: #1976d2; color: white; padding: 10px;">Meter Readings & Keys</h2></p>
+ <h3>Meter Readings (at start of tenancy)</h3>
+   <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; width: 30%; background-color: #f5f5f5;"><strong>Electricity:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">___________________</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Gas:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">___________________</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Water:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">___________________</td>
+     </tr>
+   </table>
+ <h3>Keys Provided</h3>
+   <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; width: 30%; background-color: #f5f5f5;"><strong>Front Door:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">_____ keys</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Back Door:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">_____ keys</td>
+     </tr>
+     <tr>
+       <td style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5;"><strong>Other:</strong></td>
+       <td style="border: 1px solid #ddd; padding: 10px;">_______________________</td>
+     </tr>
+   </table>
+ <div style="margin-top: 60px;">
+     <h2>Signatures</h2>
+     <p style="font-size: 11pt; color: #666;">
+       Both parties confirm this inventory is accurate at the start of the tenancy.
+     </p>
+ <table style="width: 100%; border: none; margin-top: 30px;">
+       <tr>
+         <td style="width: 50%; border: none; padding-right: 20px;">
+           <p style="margin: 0;"><strong>Landlord/Agent:</strong></p>
+           <div style="border-bottom: 2px solid #000; margin: 40px 0 10px 0;"></div>
+           <p style="margin: 0; font-size: 10pt;">Alice Landlord</p>
+           <p style="margin: 5px 0; font-size: 10pt;">Date: _______________</p>
+         </td>
+         <td style="width: 50%; border: none; padding-left: 20px;">
+           <p style="margin: 0;"><strong>Tenant:</strong></p>
+           <div style="border-bottom: 2px solid #000; margin: 40px 0 10px 0;"></div>
+           <p style="margin: 0; font-size: 10pt;"></p>
+           <p style="margin: 5px 0; font-size: 10pt;">Date: _______________</p>
+         </td>
+       </tr>
+     </table>
+   </div>
+ <p style="text-align: center; font-size: 9pt; color: #666; margin-top: 60px;">
+     Keep a signed copy and all photographs for the duration of the tenancy<br/>
+     Generated by Landlord Heaven | Document ID: DOC-MJDI86YH-H1AV5J
+   </p>
+ </div>

 â¯ tests/documents/ast-pack-standard.test.ts:78:28
     76|     expect(generated.pdf).toBeInstanceOf(Buffer);
     77|     expect(generated.html).toContain('CERTIFICATE OF CURATION');
     78|     expect(generated.html).toContain('Legal Validity Summary');
       |                            ^
     79|     expect(generated.html).not.toContain('HMO & Shared Facilities');
     80|   }, 20000);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[33/52]âŽ¯

 FAIL  tests/documents/eviction-pack-option-b.test.ts > Complete eviction pack - Option B coverage > produces England & Wales court forms and premium AI documents
Error: Official form "n5-eng.pdf" is missing. Add the PDF under public/official-forms (jurisdiction subfolder allowed) or update the manifest. Error: Error: ENOENT: no such file or directory, access '/home/user/landlord-heavenv3/public/official-forms/n5-eng.pdf'
 â¯ assertOfficialFormExists src/lib/documents/official-forms-filler.ts:35:11
     33|     return formPath;
     34|   } catch (error) {
     35|     throw new Error(
       |           ^
     36|       `Official form "${formName}" is missing. Add the PDF under publiâ€¦
     37|     );
 â¯ loadOfficialForm src/lib/documents/official-forms-filler.ts:119:20
 â¯ Module.fillN5Form src/lib/documents/official-forms-filler.ts:200:18
 â¯ generateEnglandOrWalesEvictionPack src/lib/documents/eviction-pack-generator.ts:651:17
 â¯ Module.generateCompleteEvictionPack src/lib/documents/eviction-pack-generator.ts:771:18
 â¯ tests/documents/eviction-pack-option-b.test.ts:109:18

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[34/52]âŽ¯

 FAIL  tests/documents/eviction-pack-option-b.test.ts > Complete eviction pack - Option B coverage > produces Scotland tribunal forms plus premium AI documents
Error: Failed to load official form "form_e_eviction.pdf". Make sure the PDF exists in /public/official-forms/scotland/. Error: Error: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/public/official-forms/scotland/form_e_eviction.pdf'
 â¯ loadOfficialForm src/lib/documents/scotland-forms-filler.ts:136:11
    134|     return pdfDoc;
    135|   } catch (error) {
    136|     throw new Error(`Failed to load official form "${formName}". Make â€¦
       |           ^
    137|   }
    138| }
 â¯ fillFormE src/lib/documents/scotland-forms-filler.ts:333:18
 â¯ fillScotlandOfficialForm src/lib/documents/scotland-forms-filler.ts:574:14
 â¯ generateScotlandEvictionPack src/lib/documents/eviction-pack-generator.ts:705:20
 â¯ Module.generateCompleteEvictionPack src/lib/documents/eviction-pack-generator.ts:775:18
 â¯ tests/documents/eviction-pack-option-b.test.ts:125:18

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[35/52]âŽ¯

 FAIL  tests/documents/pdf-field-mapping.test.ts > Official form assets > includes required England & Wales PDFs
AssertionError: promise rejected "Error: ENOENT: no such file or directory,â€¦ { â€¦(4) }" instead of resolving
 â¯ tests/documents/pdf-field-mapping.test.ts:30:61
     28| 
     29|     for (const formFile of requiredForms) {
     30|       await expect(fs.access(path.join(formsRoot, formFile))).resolvesâ€¦
       |                                                             ^
     31|     }
     32|   });

Caused by: Error: ENOENT: no such file or directory, access '/home/user/landlord-heavenv3/public/official-forms/n5-eng.pdf'
 â¯ tests/documents/pdf-field-mapping.test.ts:30:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { errno: -2, code: 'ENOENT', syscall: 'access', path: '/home/user/landlord-heavenv3/public/official-forms/n5-eng.pdf' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[36/52]âŽ¯

 FAIL  tests/documents/pdf-field-mapping.test.ts > Official form assets > has manifest entries present on disk across jurisdictions
Error: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/public/official-forms/forms-manifest.json'
 â¯ tests/documents/pdf-field-mapping.test.ts:35:25
     33| 
     34|   it('has manifest entries present on disk across jurisdictions', asynâ€¦
     35|     const manifestRaw = await fs.readFile(path.join(formsRoot, 'forms-â€¦
       |                         ^
     36|     const manifest = JSON.parse(manifestRaw);
     37| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[37/52]âŽ¯

 FAIL  tests/documents/pdf-field-mapping.test.ts > Scotland official forms > treats Notice to Leave as non-fillable when no AcroForm fields exist
Error: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/public/official-forms/scotland/notice_to_leave.pdf'
 â¯ logFieldCount tests/documents/pdf-field-mapping.test.ts:16:20
     14| 
     15| async function logFieldCount(formFile: string): Promise<number> {
     16|   const pdfBytes = await fs.readFile(path.join(formsRoot, formFile));
       |                    ^
     17|   const pdfDoc = await PDFDocument.load(pdfBytes);
     18|   const form = pdfDoc.getForm();
 â¯ tests/documents/pdf-field-mapping.test.ts:66:24

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[38/52]âŽ¯

 FAIL  tests/documents/pdf-field-mapping.test.ts > Scotland official forms > retains critical Form E fields for pdf-lib filling
Error: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/public/official-forms/scotland/form_e_eviction.pdf'
 â¯ loadFieldNames tests/documents/pdf-field-mapping.test.ts:9:20
      7| 
      8| async function loadFieldNames(formFile: string): Promise<Set<string>> {
      9|   const pdfBytes = await fs.readFile(path.join(formsRoot, formFile));
       |                    ^
     10|   const pdfDoc = await PDFDocument.load(pdfBytes);
     11|   const form = pdfDoc.getForm();
 â¯ tests/documents/pdf-field-mapping.test.ts:72:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39/52]âŽ¯

 FAIL  tests/documents/pdf-field-mapping.test.ts > PDF field mappings align with official forms > matches critical N5 fields
Error: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/public/official-forms/n5-eng.pdf'
 â¯ loadFieldNames tests/documents/pdf-field-mapping.test.ts:9:20
      7| 
      8| async function loadFieldNames(formFile: string): Promise<Set<string>> {
      9|   const pdfBytes = await fs.readFile(path.join(formsRoot, formFile));
       |                    ^
     10|   const pdfDoc = await PDFDocument.load(pdfBytes);
     11|   const form = pdfDoc.getForm();
 â¯ tests/documents/pdf-field-mapping.test.ts:81:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[40/52]âŽ¯

 FAIL  tests/documents/pdf-field-mapping.test.ts > PDF field mappings align with official forms > matches critical N5B fields
Error: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/public/official-forms/n5b-eng.pdf'
 â¯ loadFieldNames tests/documents/pdf-field-mapping.test.ts:9:20
      7| 
      8| async function loadFieldNames(formFile: string): Promise<Set<string>> {
      9|   const pdfBytes = await fs.readFile(path.join(formsRoot, formFile));
       |                    ^
     10|   const pdfDoc = await PDFDocument.load(pdfBytes);
     11|   const form = pdfDoc.getForm();
 â¯ tests/documents/pdf-field-mapping.test.ts:102:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[41/52]âŽ¯

 FAIL  tests/documents/pdf-field-mapping.test.ts > PDF field mappings align with official forms > matches critical N119 fields
Error: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/public/official-forms/n119-eng.pdf'
 â¯ loadFieldNames tests/documents/pdf-field-mapping.test.ts:9:20
      7| 
      8| async function loadFieldNames(formFile: string): Promise<Set<string>> {
      9|   const pdfBytes = await fs.readFile(path.join(formsRoot, formFile));
       |                    ^
     10|   const pdfDoc = await PDFDocument.load(pdfBytes);
     11|   const form = pdfDoc.getForm();
 â¯ tests/documents/pdf-field-mapping.test.ts:119:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[42/52]âŽ¯

 FAIL  tests/documents/pdf-field-mapping.test.ts > PDF field mappings align with official forms > matches critical N1 fields
Error: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/public/official-forms/N1_1224.pdf'
 â¯ loadFieldNames tests/documents/pdf-field-mapping.test.ts:9:20
      7| 
      8| async function loadFieldNames(formFile: string): Promise<Set<string>> {
      9|   const pdfBytes = await fs.readFile(path.join(formsRoot, formFile));
       |                    ^
     10|   const pdfDoc = await PDFDocument.load(pdfBytes);
     11|   const form = pdfDoc.getForm();
 â¯ tests/documents/pdf-field-mapping.test.ts:144:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[43/52]âŽ¯

 FAIL  tests/documents/pdf-field-mapping.test.ts > PDF field mappings align with official forms > matches critical Form 6A fields
Error: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/public/official-forms/form_6a.pdf'
 â¯ loadFieldNames tests/documents/pdf-field-mapping.test.ts:9:20
      7| 
      8| async function loadFieldNames(formFile: string): Promise<Set<string>> {
      9|   const pdfBytes = await fs.readFile(path.join(formsRoot, formFile));
       |                    ^
     10|   const pdfDoc = await PDFDocument.load(pdfBytes);
     11|   const form = pdfDoc.getForm();
 â¯ tests/documents/pdf-field-mapping.test.ts:187:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[44/52]âŽ¯

 FAIL  tests/documents/scotland-form-guards.test.ts > Scotland official form guards > ships placeholder PDFs for tribunal filings (eviction)
AssertionError: promise rejected "Error: ENOENT: no such file or directory,â€¦ { â€¦(4) }" instead of resolving
 â¯ tests/documents/scotland-form-guards.test.ts:9:67
      7|   it('ships placeholder PDFs for tribunal filings (eviction)', async (â€¦
      8|     const base = path.join(process.cwd(), 'public', 'official-forms', â€¦
      9|     await expect(fs.access(path.join(base, 'notice_to_leave.pdf'))).reâ€¦
       |                                                                   ^
     10|     await expect(fs.access(path.join(base, 'form_e_eviction.pdf'))).reâ€¦
     11|   });

Caused by: Error: ENOENT: no such file or directory, access '/home/user/landlord-heavenv3/public/official-forms/scotland/notice_to_leave.pdf'
 â¯ tests/documents/scotland-form-guards.test.ts:9:5

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { errno: -2, code: 'ENOENT', syscall: 'access', path: '/home/user/landlord-heavenv3/public/official-forms/scotland/notice_to_leave.pdf' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[45/52]âŽ¯

 FAIL  tests/documents/scotland-form-guards.test.ts > Scotland official form guards > ships placeholder PDFs for Simple Procedure (money claims)
AssertionError: promise rejected "Error: ENOENT: no such file or directory,â€¦ { â€¦(4) }" instead of resolving
 â¯ tests/documents/scotland-form-guards.test.ts:15:79
     13|   it('ships placeholder PDFs for Simple Procedure (money claims)', asyâ€¦
     14|     const base = path.join(process.cwd(), 'public', 'official-forms', â€¦
     15|     await expect(fs.access(path.join(base, 'simple_procedure_claim_forâ€¦
       |                                                                               ^
     16|     await expect(fs.access(path.join(base, 'simple_procedure_response_â€¦
     17|   });

Caused by: Error: ENOENT: no such file or directory, access '/home/user/landlord-heavenv3/public/official-forms/scotland/simple_procedure_claim_form.pdf'
 â¯ tests/documents/scotland-form-guards.test.ts:15:5

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { errno: -2, code: 'ENOENT', syscall: 'access', path: '/home/user/landlord-heavenv3/public/official-forms/scotland/simple_procedure_claim_form.pdf' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[46/52]âŽ¯

 FAIL  tests/documents/scotland-form-guards.test.ts > Scotland official form guards > Simple Procedure PDFs are valid and non-empty
Error: ENOENT: no such file or directory, open '/home/user/landlord-heavenv3/public/official-forms/scotland/simple_procedure_claim_form.pdf'
 â¯ tests/documents/scotland-form-guards.test.ts:22:24
     20|     const base = path.join(process.cwd(), 'public', 'official-forms', â€¦
     21| 
     22|     const claimBytes = await fs.readFile(path.join(base, 'simple_proceâ€¦
       |                        ^
     23|     expect(claimBytes.length).toBeGreaterThan(1000); // Ensure meaningâ€¦
     24| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[47/52]âŽ¯

 FAIL  tests/integration/ast-wizard-flow.test.ts > AST Wizard Flow - Integration Tests > Error Handling > should reject non-existent case_id in answer route
AssertionError: expected 500 to be 404 // Object.is equality

- Expected
+ Received

- 404
+ 500

 â¯ tests/integration/ast-wizard-flow.test.ts:412:31
    410| 
    411|       const response = await wizardAnswer(answerRequest);
    412|       expect(response.status).toBe(404);
       |                               ^
    413| 
    414|       const data = await response.json();

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[48/52]âŽ¯

 FAIL  tests/integration/money-claim-wizard-flow.test.ts > Money claim wizard integration > England & Wales money claim pack generation flow
AssertionError: expected 400 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 400

 â¯ answerQuestion tests/integration/money-claim-wizard-flow.test.ts:147:22
    145|     console.error('Answer error', question_id, body);
    146|   }
    147|   expect(res.status).toBe(200);
       |                      ^
    148| }
    149| 
 â¯ tests/integration/money-claim-wizard-flow.test.ts:172:5

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[49/52]âŽ¯

 FAIL  tests/integration/money-claim-wizard-flow.test.ts > Money claim wizard integration > Scotland money claim flow produces Simple Procedure pack
AssertionError: expected 422 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 422

 â¯ answerQuestion tests/integration/money-claim-wizard-flow.test.ts:147:22
    145|     console.error('Answer error', question_id, body);
    146|   }
    147|   expect(res.status).toBe(200);
       |                      ^
    148| }
    149| 
 â¯ tests/integration/money-claim-wizard-flow.test.ts:274:5

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[50/52]âŽ¯

 FAIL  tests/lib/jurisdictions/legal-enforcement.test.ts > jurisdiction gating enforcement > migrates legacy England & Wales cases to England rules during preview validation
AssertionError: expected 400 to be 422 // Object.is equality

- Expected
+ Received

- 422
+ 400

 â¯ tests/lib/jurisdictions/legal-enforcement.test.ts:282:29
    280|     });
    281| 
    282|     expect(response.status).toBe(422);
       |                             ^
    283|     const payload = await response.json();
    284|     expect(payload.blocking_issues).toBeDefined();

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[51/52]âŽ¯

 FAIL  src/lib/documents/__tests__/template-rendering.test.ts > Markdown Artifact Prevention > No raw markdown tokens in compiled Scotland Notice to Leave template
Error: The proposed leaving date is too early. The earliest legally valid date is 09 April 2025 (84 days from service date). Legal basis: Private Housing (Tenancies) (Scotland) Act 2016, Schedule 3
 â¯ Module.generateNoticeToLeave src/lib/documents/scotland/notice-to-leave-generator.ts:583:21
    581|     if (!validation.valid) {
    582|       // Return 422 error with precise explanation
    583|       const error = new Error(validation.errors.join(' '));
       |                     ^
    584|       (error as any).statusCode = 422;
    585|       (error as any).validationErrors = validation.errors;
 â¯ src/lib/documents/__tests__/template-rendering.test.ts:72:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[52/52]âŽ¯

 Test Files  22 failed | 31 passed | 1 skipped (54)
      Tests  51 failed | 351 passed | 17 skipped (419)
   Start at  23:32:24
   Duration  10.97s (transform 7.68s, setup 4.61s, collect 39.61s, tests 2.72s, environment 8.82s, prepare 19.21s)

